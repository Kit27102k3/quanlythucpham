"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.updateRolePermissions = exports.updateAdmin = exports.getAllAdmins = exports.getAdminProfile = exports.getAdminById = exports.deleteAdmin = exports.createAdmin = exports.adminLogin = void 0;
var _adminModel = _interopRequireDefault(require("../Model/adminModel.js"));
var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));
var _bcryptjs = _interopRequireDefault(require("bcryptjs")); // File: adminAuthController.js

const adminLogin = async (req, res) => {
  try {
    const { userName, password } = req.body;

    // Kiểm tra admin tồn tại
    const admin = await _adminModel.default.findOne({ userName });
    if (!admin) {
      return res.status(404).json({ message: "Tài khoản không tồn tại" });
    }

    // Kiểm tra mật khẩu
    const isMatch = await admin.comparePassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: "Mật khẩu không chính xác" });
    }

    // Kiểm tra tài khoản có active không
    if (!admin.isActive) {
      return res.status(403).json({ message: "Tài khoản đã bị vô hiệu hóa" });
    }

    // Tạo token
    const accessToken = _jsonwebtoken.default.sign(
      {
        id: admin._id,
        role: admin.role,
        permissions: admin.permissions
      },
      process.env.JWT_SECRET,
      { expiresIn: "1h" }
    );

    const refreshToken = _jsonwebtoken.default.sign(
      { id: admin._id },
      process.env.JWT_REFRESH_SECRET,
      { expiresIn: "7d" }
    );

    // Cập nhật last login
    admin.lastLogin = new Date();
    await admin.save();

    res.status(200).json({
      accessToken,
      refreshToken,
      userId: admin._id,
      role: admin.role,
      permissions: admin.permissions,
      fullName: admin.fullName,
      branchId: admin.branchId || null
    });
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};exports.adminLogin = adminLogin;

const getAdminProfile = async (req, res) => {
  try {
    const admin = await _adminModel.default.findById(req.user.id).select("-password");
    if (!admin) {
      return res.status(404).json({ message: "Admin không tồn tại" });
    }
    res.status(200).json(admin);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

// Hàm helper để lấy quyền mặc định theo role
exports.getAdminProfile = getAdminProfile;const getDefaultPermissions = (role) => {
  switch (role) {
    case "admin":
      return [
      "Thêm",
      "Xem",
      "Sửa",
      "Xóa",
      "Quản lý người dùng",
      "Quản lý sản phẩm",
      "Quản lý đơn hàng",
      "Quản lý danh mục",
      "Quản lý cài đặt"];

    case "manager":
      return [
      "Thêm",
      "Xem",
      "Sửa",
      "Quản lý sản phẩm",
      "Quản lý đơn hàng",
      "Quản lý danh mục"];

    case "staff":
      return [
      "Xem",
      "Thêm",
      "Sửa",
      "Quản lý sản phẩm"];

    default:
      return ["Xem"];
  }
};

const createAdmin = async (req, res) => {
  try {
    const { userName, password, fullName, email, phone, birthday, role, branchId } = req.body;

    // Kiểm tra email đã tồn tại
    const existingEmail = await _adminModel.default.findOne({ email });
    if (existingEmail) {
      return res.status(400).json({ message: "Email đã được sử dụng" });
    }

    // Kiểm tra username đã tồn tại
    const existingUsername = await _adminModel.default.findOne({ userName });
    if (existingUsername) {
      return res.status(400).json({ message: "Tên đăng nhập đã được sử dụng" });
    }

    // Tạo admin mới
    const newAdmin = new _adminModel.default({
      userName,
      password,
      fullName,
      email,
      phone,
      birthday,
      role,
      branchId: branchId || null,
      permissions: getDefaultPermissions(role)
    });

    const admin = await newAdmin.save();
    res.status(201).json(admin);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};exports.createAdmin = createAdmin;

const getAllAdmins = async (req, res) => {
  try {
    const admins = await _adminModel.default.find().
    select('-password').
    populate('branchId', 'name address phone');
    res.status(200).json(admins);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};exports.getAllAdmins = getAllAdmins;

const updateAdmin = async (req, res) => {
  try {
    const { id } = req.params;
    const {
      userName,
      fullName,
      phone,
      email,
      birthday,
      role,
      permissions,
      branchId,
      isActive,
      password
    } = req.body;

    // Kiểm tra xem admin có tồn tại không
    const admin = await _adminModel.default.findById(id);
    if (!admin) {
      return res.status(404).json({
        success: false,
        message: "Không tìm thấy admin"
      });
    }

    // Cập nhật thông tin cơ bản
    if (userName) admin.userName = userName;
    if (fullName) admin.fullName = fullName;
    if (phone) admin.phone = phone;
    if (email) admin.email = email;
    if (birthday) admin.birthday = birthday;
    if (role) admin.role = role;
    if (permissions) admin.permissions = permissions;
    if (branchId !== undefined) admin.branchId = branchId;
    if (isActive !== undefined) admin.isActive = isActive;

    // Cập nhật mật khẩu nếu có
    if (password && password.trim() !== '') {
      const salt = await _bcryptjs.default.genSalt(10);
      admin.password = await _bcryptjs.default.hash(password, salt);
    }

    // Sử dụng validateModifiedOnly để chỉ validate các trường đã sửa
    const updatedAdmin = await admin.save({ validateModifiedOnly: true });

    return res.status(200).json({
      success: true,
      message: "Cập nhật thông tin admin thành công",
      data: updatedAdmin
    });
  } catch (error) {
    console.error("Lỗi khi cập nhật thông tin admin:", error);
    return res.status(500).json({
      success: false,
      message: "Lỗi khi cập nhật thông tin admin",
      error: error.message
    });
  }
};exports.updateAdmin = updateAdmin;

const deleteAdmin = async (req, res) => {
  try {
    const { id } = req.params;
    const admin = await _adminModel.default.findByIdAndDelete(id);

    if (!admin) {
      return res.status(404).json({ message: "Không tìm thấy admin" });
    }

    res.status(200).json({ message: "Xóa admin thành công" });
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};exports.deleteAdmin = deleteAdmin;

const getAdminById = async (req, res) => {
  try {
    const admin = await _adminModel.default.findById(req.params.id).
    select('-password').
    populate('branchId', 'name address phone');

    if (!admin) {
      return res.status(404).json({ message: "Admin không tồn tại" });
    }

    res.status(200).json(admin);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};exports.getAdminById = getAdminById;

const updateRolePermissions = async (req, res) => {
  try {
    const { roleKey } = req.params;
    const { permissions } = req.body;

    // Kiểm tra xem mảng permissions có hợp lệ không
    if (!Array.isArray(permissions)) {
      return res.status(400).json({ message: "Permissions phải là một mảng" });
    }

    // Tìm tất cả admin/manager/employee với roleKey và cập nhật quyền
    const result = await _adminModel.default.updateMany(
      { role: roleKey },
      { $set: { permissions: permissions } }
    );

    // Optional: Log số lượng documents đã được cập nhật
    console.log(`Updated permissions for ${result.modifiedCount} users with role ${roleKey}`);

    res.status(200).json({
      success: true,
      message: `Cập nhật quyền cho vai trò ${roleKey} thành công.`, // Message tiếng Việt
      modifiedCount: result.modifiedCount
    });
  } catch (error) {
    console.error("Error updating role permissions:", error);
    res.status(500).json({ message: "Lỗi server khi cập nhật quyền vai trò" });
  }
};exports.updateRolePermissions = updateRolePermissions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYWRtaW5Nb2RlbCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2pzb253ZWJ0b2tlbiIsIl9iY3J5cHRqcyIsImFkbWluTG9naW4iLCJyZXEiLCJyZXMiLCJ1c2VyTmFtZSIsInBhc3N3b3JkIiwiYm9keSIsImFkbWluIiwiQWRtaW4iLCJmaW5kT25lIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJpc01hdGNoIiwiY29tcGFyZVBhc3N3b3JkIiwiaXNBY3RpdmUiLCJhY2Nlc3NUb2tlbiIsImp3dCIsInNpZ24iLCJpZCIsIl9pZCIsInJvbGUiLCJwZXJtaXNzaW9ucyIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiZXhwaXJlc0luIiwicmVmcmVzaFRva2VuIiwiSldUX1JFRlJFU0hfU0VDUkVUIiwibGFzdExvZ2luIiwiRGF0ZSIsInNhdmUiLCJ1c2VySWQiLCJmdWxsTmFtZSIsImJyYW5jaElkIiwiZXJyb3IiLCJleHBvcnRzIiwiZ2V0QWRtaW5Qcm9maWxlIiwiZmluZEJ5SWQiLCJ1c2VyIiwic2VsZWN0IiwiZ2V0RGVmYXVsdFBlcm1pc3Npb25zIiwiY3JlYXRlQWRtaW4iLCJlbWFpbCIsInBob25lIiwiYmlydGhkYXkiLCJleGlzdGluZ0VtYWlsIiwiZXhpc3RpbmdVc2VybmFtZSIsIm5ld0FkbWluIiwiZ2V0QWxsQWRtaW5zIiwiYWRtaW5zIiwiZmluZCIsInBvcHVsYXRlIiwidXBkYXRlQWRtaW4iLCJwYXJhbXMiLCJzdWNjZXNzIiwidW5kZWZpbmVkIiwidHJpbSIsInNhbHQiLCJiY3J5cHQiLCJnZW5TYWx0IiwiaGFzaCIsInVwZGF0ZWRBZG1pbiIsInZhbGlkYXRlTW9kaWZpZWRPbmx5IiwiZGF0YSIsImNvbnNvbGUiLCJkZWxldGVBZG1pbiIsImZpbmRCeUlkQW5kRGVsZXRlIiwiZ2V0QWRtaW5CeUlkIiwidXBkYXRlUm9sZVBlcm1pc3Npb25zIiwicm9sZUtleSIsIkFycmF5IiwiaXNBcnJheSIsInJlc3VsdCIsInVwZGF0ZU1hbnkiLCIkc2V0IiwibG9nIiwibW9kaWZpZWRDb3VudCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9Db250cm9sbGVyL2FkbWluQ29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBhZG1pbkF1dGhDb250cm9sbGVyLmpzXG5pbXBvcnQgQWRtaW4gZnJvbSBcIi4uL01vZGVsL2FkbWluTW9kZWwuanNcIjtcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIjtcblxuZXhwb3J0IGNvbnN0IGFkbWluTG9naW4gPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHVzZXJOYW1lLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBLaeG7g20gdHJhIGFkbWluIHThu5NuIHThuqFpXG4gICAgY29uc3QgYWRtaW4gPSBhd2FpdCBBZG1pbi5maW5kT25lKHsgdXNlck5hbWUgfSk7XG4gICAgaWYgKCFhZG1pbikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogXCJUw6BpIGtob+G6o24ga2jDtG5nIHThu5NuIHThuqFpXCIgfSk7XG4gICAgfVxuXG4gICAgLy8gS2nhu4NtIHRyYSBt4bqtdCBraOG6qXVcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgYWRtaW4uY29tcGFyZVBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICBpZiAoIWlzTWF0Y2gpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IFwiTeG6rXQga2jhuql1IGtow7RuZyBjaMOtbmggeMOhY1wiIH0pO1xuICAgIH1cblxuICAgIC8vIEtp4buDbSB0cmEgdMOgaSBraG/huqNuIGPDsyBhY3RpdmUga2jDtG5nXG4gICAgaWYgKCFhZG1pbi5pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogXCJUw6BpIGtob+G6o24gxJHDoyBi4buLIHbDtCBoaeG7h3UgaMOzYVwiIH0pO1xuICAgIH1cblxuICAgIC8vIFThuqFvIHRva2VuXG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSBqd3Quc2lnbihcbiAgICAgIHtcbiAgICAgICAgaWQ6IGFkbWluLl9pZCxcbiAgICAgICAgcm9sZTogYWRtaW4ucm9sZSxcbiAgICAgICAgcGVybWlzc2lvbnM6IGFkbWluLnBlcm1pc3Npb25zLFxuICAgICAgfSxcbiAgICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsXG4gICAgICB7IGV4cGlyZXNJbjogXCIxaFwiIH1cbiAgICApO1xuXG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gand0LnNpZ24oXG4gICAgICB7IGlkOiBhZG1pbi5faWQgfSxcbiAgICAgIHByb2Nlc3MuZW52LkpXVF9SRUZSRVNIX1NFQ1JFVCxcbiAgICAgIHsgZXhwaXJlc0luOiBcIjdkXCIgfVxuICAgICk7XG5cbiAgICAvLyBD4bqtcCBuaOG6rXQgbGFzdCBsb2dpblxuICAgIGFkbWluLmxhc3RMb2dpbiA9IG5ldyBEYXRlKCk7XG4gICAgYXdhaXQgYWRtaW4uc2F2ZSgpO1xuXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgYWNjZXNzVG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW4sXG4gICAgICB1c2VySWQ6IGFkbWluLl9pZCxcbiAgICAgIHJvbGU6IGFkbWluLnJvbGUsXG4gICAgICBwZXJtaXNzaW9uczogYWRtaW4ucGVybWlzc2lvbnMsXG4gICAgICBmdWxsTmFtZTogYWRtaW4uZnVsbE5hbWUsXG4gICAgICBicmFuY2hJZDogYWRtaW4uYnJhbmNoSWQgfHwgbnVsbCxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfSk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRBZG1pblByb2ZpbGUgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhZG1pbiA9IGF3YWl0IEFkbWluLmZpbmRCeUlkKHJlcS51c2VyLmlkKS5zZWxlY3QoXCItcGFzc3dvcmRcIik7XG4gICAgaWYgKCFhZG1pbikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogXCJBZG1pbiBraMO0bmcgdOG7k24gdOG6oWlcIiB9KTtcbiAgICB9XG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oYWRtaW4pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgfVxufTtcblxuLy8gSMOgbSBoZWxwZXIgxJHhu4MgbOG6pXkgcXV54buBbiBt4bq3YyDEkeG7i25oIHRoZW8gcm9sZVxuY29uc3QgZ2V0RGVmYXVsdFBlcm1pc3Npb25zID0gKHJvbGUpID0+IHtcbiAgICBzd2l0Y2ggKHJvbGUpIHtcbiAgICAgICAgY2FzZSBcImFkbWluXCI6XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIFwiVGjDqm1cIixcbiAgICAgICAgICAgICAgICBcIlhlbVwiLFxuICAgICAgICAgICAgICAgIFwiU+G7rWFcIixcbiAgICAgICAgICAgICAgICBcIljDs2FcIixcbiAgICAgICAgICAgICAgICBcIlF14bqjbiBsw70gbmfGsOG7nWkgZMO5bmdcIixcbiAgICAgICAgICAgICAgICBcIlF14bqjbiBsw70gc+G6o24gcGjhuqltXCIsXG4gICAgICAgICAgICAgICAgXCJRdeG6o24gbMO9IMSRxqFuIGjDoG5nXCIsXG4gICAgICAgICAgICAgICAgXCJRdeG6o24gbMO9IGRhbmggbeG7pWNcIixcbiAgICAgICAgICAgICAgICBcIlF14bqjbiBsw70gY8OgaSDEkeG6t3RcIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgY2FzZSBcIm1hbmFnZXJcIjpcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgXCJUaMOqbVwiLFxuICAgICAgICAgICAgICAgIFwiWGVtXCIsXG4gICAgICAgICAgICAgICAgXCJT4butYVwiLFxuICAgICAgICAgICAgICAgIFwiUXXhuqNuIGzDvSBz4bqjbiBwaOG6qW1cIixcbiAgICAgICAgICAgICAgICBcIlF14bqjbiBsw70gxJHGoW4gaMOgbmdcIixcbiAgICAgICAgICAgICAgICBcIlF14bqjbiBsw70gZGFuaCBt4bulY1wiXG4gICAgICAgICAgICBdO1xuICAgICAgICBjYXNlIFwic3RhZmZcIjpcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgXCJYZW1cIixcbiAgICAgICAgICAgICAgICBcIlRow6ptXCIsXG4gICAgICAgICAgICAgICAgXCJT4butYVwiLFxuICAgICAgICAgICAgICAgIFwiUXXhuqNuIGzDvSBz4bqjbiBwaOG6qW1cIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBbXCJYZW1cIl07XG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUFkbWluID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyB1c2VyTmFtZSwgcGFzc3dvcmQsIGZ1bGxOYW1lLCBlbWFpbCwgcGhvbmUsIGJpcnRoZGF5LCByb2xlLCBicmFuY2hJZCB9ID0gcmVxLmJvZHk7XG4gICAgICAgIFxuICAgICAgICAvLyBLaeG7g20gdHJhIGVtYWlsIMSRw6MgdOG7k24gdOG6oWlcbiAgICAgICAgY29uc3QgZXhpc3RpbmdFbWFpbCA9IGF3YWl0IEFkbWluLmZpbmRPbmUoeyBlbWFpbCB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nRW1haWwpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IFwiRW1haWwgxJHDoyDEkcaw4bujYyBz4butIGThu6VuZ1wiIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gS2nhu4NtIHRyYSB1c2VybmFtZSDEkcOjIHThu5NuIHThuqFpXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlcm5hbWUgPSBhd2FpdCBBZG1pbi5maW5kT25lKHsgdXNlck5hbWUgfSk7XG4gICAgICAgIGlmIChleGlzdGluZ1VzZXJuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBcIlTDqm4gxJHEg25nIG5o4bqtcCDEkcOjIMSRxrDhu6NjIHPhu60gZOG7pW5nXCIgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBU4bqhbyBhZG1pbiBt4bubaVxuICAgICAgICBjb25zdCBuZXdBZG1pbiA9IG5ldyBBZG1pbih7XG4gICAgICAgICAgICB1c2VyTmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkLFxuICAgICAgICAgICAgZnVsbE5hbWUsXG4gICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYmlydGhkYXksXG4gICAgICAgICAgICByb2xlLFxuICAgICAgICAgICAgYnJhbmNoSWQ6IGJyYW5jaElkIHx8IG51bGwsXG4gICAgICAgICAgICBwZXJtaXNzaW9uczogZ2V0RGVmYXVsdFBlcm1pc3Npb25zKHJvbGUpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGFkbWluID0gYXdhaXQgbmV3QWRtaW4uc2F2ZSgpO1xuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbihhZG1pbik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRBbGxBZG1pbnMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZG1pbnMgPSBhd2FpdCBBZG1pbi5maW5kKClcbiAgICAgICAgICAgIC5zZWxlY3QoJy1wYXNzd29yZCcpXG4gICAgICAgICAgICAucG9wdWxhdGUoJ2JyYW5jaElkJywgJ25hbWUgYWRkcmVzcyBwaG9uZScpO1xuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihhZG1pbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgdXBkYXRlQWRtaW4gPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgIGNvbnN0IHsgXG4gICAgICB1c2VyTmFtZSwgXG4gICAgICBmdWxsTmFtZSwgXG4gICAgICBwaG9uZSwgXG4gICAgICBlbWFpbCwgXG4gICAgICBiaXJ0aGRheSwgXG4gICAgICByb2xlLCBcbiAgICAgIHBlcm1pc3Npb25zLFxuICAgICAgYnJhbmNoSWQsXG4gICAgICBpc0FjdGl2ZSxcbiAgICAgIHBhc3N3b3JkIFxuICAgIH0gPSByZXEuYm9keTtcblxuICAgIC8vIEtp4buDbSB0cmEgeGVtIGFkbWluIGPDsyB04buTbiB04bqhaSBraMO0bmdcbiAgICBjb25zdCBhZG1pbiA9IGF3YWl0IEFkbWluLmZpbmRCeUlkKGlkKTtcbiAgICBpZiAoIWFkbWluKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogXCJLaMO0bmcgdMOsbSB0aOG6pXkgYWRtaW5cIlxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ+G6rXAgbmjhuq10IHRow7RuZyB0aW4gY8ahIGLhuqNuXG4gICAgaWYgKHVzZXJOYW1lKSBhZG1pbi51c2VyTmFtZSA9IHVzZXJOYW1lO1xuICAgIGlmIChmdWxsTmFtZSkgYWRtaW4uZnVsbE5hbWUgPSBmdWxsTmFtZTtcbiAgICBpZiAocGhvbmUpIGFkbWluLnBob25lID0gcGhvbmU7XG4gICAgaWYgKGVtYWlsKSBhZG1pbi5lbWFpbCA9IGVtYWlsO1xuICAgIGlmIChiaXJ0aGRheSkgYWRtaW4uYmlydGhkYXkgPSBiaXJ0aGRheTtcbiAgICBpZiAocm9sZSkgYWRtaW4ucm9sZSA9IHJvbGU7XG4gICAgaWYgKHBlcm1pc3Npb25zKSBhZG1pbi5wZXJtaXNzaW9ucyA9IHBlcm1pc3Npb25zO1xuICAgIGlmIChicmFuY2hJZCAhPT0gdW5kZWZpbmVkKSBhZG1pbi5icmFuY2hJZCA9IGJyYW5jaElkO1xuICAgIGlmIChpc0FjdGl2ZSAhPT0gdW5kZWZpbmVkKSBhZG1pbi5pc0FjdGl2ZSA9IGlzQWN0aXZlO1xuICAgIFxuICAgIC8vIEPhuq1wIG5o4bqtdCBt4bqtdCBraOG6qXUgbuG6v3UgY8OzXG4gICAgaWYgKHBhc3N3b3JkICYmIHBhc3N3b3JkLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMCk7XG4gICAgICBhZG1pbi5wYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCBzYWx0KTtcbiAgICB9XG5cbiAgICAvLyBT4butIGThu6VuZyB2YWxpZGF0ZU1vZGlmaWVkT25seSDEkeG7gyBjaOG7iSB2YWxpZGF0ZSBjw6FjIHRyxrDhu51uZyDEkcOjIHPhu61hXG4gICAgY29uc3QgdXBkYXRlZEFkbWluID0gYXdhaXQgYWRtaW4uc2F2ZSh7IHZhbGlkYXRlTW9kaWZpZWRPbmx5OiB0cnVlIH0pO1xuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiBcIkPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIGFkbWluIHRow6BuaCBjw7RuZ1wiLFxuICAgICAgZGF0YTogdXBkYXRlZEFkbWluXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkzhu5dpIGtoaSBj4bqtcCBuaOG6rXQgdGjDtG5nIHRpbiBhZG1pbjpcIiwgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6IFwiTOG7l2kga2hpIGPhuq1wIG5o4bqtdCB0aMO0bmcgdGluIGFkbWluXCIsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgIH0pO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlQWRtaW4gPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgICBjb25zdCBhZG1pbiA9IGF3YWl0IEFkbWluLmZpbmRCeUlkQW5kRGVsZXRlKGlkKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghYWRtaW4pIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6IFwiS2jDtG5nIHTDrG0gdGjhuqV5IGFkbWluXCIgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6IFwiWMOzYSBhZG1pbiB0aMOgbmggY8O0bmdcIiB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGdldEFkbWluQnlJZCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFkbWluID0gYXdhaXQgQWRtaW4uZmluZEJ5SWQocmVxLnBhcmFtcy5pZClcbiAgICAgICAgICAgIC5zZWxlY3QoJy1wYXNzd29yZCcpXG4gICAgICAgICAgICAucG9wdWxhdGUoJ2JyYW5jaElkJywgJ25hbWUgYWRkcmVzcyBwaG9uZScpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFhZG1pbikge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogXCJBZG1pbiBraMO0bmcgdOG7k24gdOG6oWlcIiB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oYWRtaW4pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgdXBkYXRlUm9sZVBlcm1pc3Npb25zID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyByb2xlS2V5IH0gPSByZXEucGFyYW1zO1xuICAgIGNvbnN0IHsgcGVybWlzc2lvbnMgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gS2nhu4NtIHRyYSB4ZW0gbeG6o25nIHBlcm1pc3Npb25zIGPDsyBo4bujcCBs4buHIGtow7RuZ1xuICAgIGlmICghQXJyYXkuaXNBcnJheShwZXJtaXNzaW9ucykpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IFwiUGVybWlzc2lvbnMgcGjhuqNpIGzDoCBt4buZdCBt4bqjbmdcIiB9KTtcbiAgICB9XG5cbiAgICAvLyBUw6xtIHThuqV0IGPhuqMgYWRtaW4vbWFuYWdlci9lbXBsb3llZSB24bubaSByb2xlS2V5IHbDoCBj4bqtcCBuaOG6rXQgcXV54buBblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEFkbWluLnVwZGF0ZU1hbnkoXG4gICAgICB7IHJvbGU6IHJvbGVLZXkgfSxcbiAgICAgIHsgJHNldDogeyBwZXJtaXNzaW9uczogcGVybWlzc2lvbnMgfSB9XG4gICAgKTtcblxuICAgIC8vIE9wdGlvbmFsOiBMb2cgc+G7kSBsxrDhu6NuZyBkb2N1bWVudHMgxJHDoyDEkcaw4bujYyBj4bqtcCBuaOG6rXRcbiAgICBjb25zb2xlLmxvZyhgVXBkYXRlZCBwZXJtaXNzaW9ucyBmb3IgJHtyZXN1bHQubW9kaWZpZWRDb3VudH0gdXNlcnMgd2l0aCByb2xlICR7cm9sZUtleX1gKTtcblxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiBgQ+G6rXAgbmjhuq10IHF1eeG7gW4gY2hvIHZhaSB0csOyICR7cm9sZUtleX0gdGjDoG5oIGPDtG5nLmAsIC8vIE1lc3NhZ2UgdGnhur9uZyBWaeG7h3RcbiAgICAgIG1vZGlmaWVkQ291bnQ6IHJlc3VsdC5tb2RpZmllZENvdW50LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyByb2xlIHBlcm1pc3Npb25zOlwiLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlciBraGkgY+G6rXAgbmjhuq10IHF1eeG7gW4gdmFpIHRyw7JcIiB9KTtcbiAgfVxufTsiXSwibWFwcGluZ3MiOiI7QUFDQSxJQUFBQSxXQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxhQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxTQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUEsY0FBOEIsQ0FIOUI7O0FBS08sTUFBTUcsVUFBVSxHQUFHLE1BQUFBLENBQU9DLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQzVDLElBQUk7SUFDRixNQUFNLEVBQUVDLFFBQVEsRUFBRUMsUUFBUSxDQUFDLENBQUMsR0FBR0gsR0FBRyxDQUFDSSxJQUFJOztJQUV2QztJQUNBLE1BQU1DLEtBQUssR0FBRyxNQUFNQyxtQkFBSyxDQUFDQyxPQUFPLENBQUMsRUFBRUwsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUMvQyxJQUFJLENBQUNHLEtBQUssRUFBRTtNQUNWLE9BQU9KLEdBQUcsQ0FBQ08sTUFBTSxDQUFDLEdBQUcsQ0FB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