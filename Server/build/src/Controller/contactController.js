"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.updateContact = exports.testEmailConfig = exports.replyToContact = exports.getContacts = exports.getContactById = exports.deleteContact = exports.createContact = void 0;
var _Contact = _interopRequireDefault(require("../Model/Contact.js"));
var _nodemailer = _interopRequireDefault(require("nodemailer"));
var _dotenv = _interopRequireDefault(require("dotenv"));
var _notificationService = require("../Services/notificationService.js");
var _adminModel = _interopRequireDefault(require("../Model/adminModel.js")); /* eslint-disable no-undef */

_dotenv.default.config();

// Get all contacts
const getContacts = async (req, res) => {
  try {
    const contacts = await _Contact.default.find().sort({ createdAt: -1 }); // Sắp xếp theo thời gian mới nhất
    res.status(200).json(contacts);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

// Get a specific contact by ID
exports.getContacts = getContacts;const getContactById = async (req, res) => {
  try {
    const contact = await _Contact.default.findById(req.params.id);
    if (!contact) {
      return res.status(404).json({ message: "Contact not found" });
    }
    res.status(200).json(contact);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

// Create a new contact
exports.getContactById = getContactById;const createContact = async (req, res) => {
  try {
    const { name, email, message, phone } = req.body;

    if (!name || !email || !message) {
      return res.status(400).json({ message: "Please provide name, email and message" });
    }

    const newContact = new _Contact.default({
      name,
      email,
      message,
      phone,
      isRead: false,
      isReplied: false
    });

    const savedContact = await newContact.save();

    // Gửi thông báo cho admin về liên hệ mới
    try {
      // Tìm tất cả admin có đăng ký nhận thông báo
      const adminsToNotify = await _adminModel.default.find({
        'pushSubscriptions.0': { $exists: true }
      });

      if (adminsToNotify && adminsToNotify.length > 0) {
        const notificationPayload = {
          title: 'Liên hệ mới',
          body: `${name} đã gửi một liên hệ mới qua website.`,
          data: {
            url: '/admin/contacts',
            type: 'new_contact'
          }
        };

        // Gửi thông báo đến từng admin
        for (const admin of adminsToNotify) {
          for (const subscription of admin.pushSubscriptions) {
            (0, _notificationService.sendPushNotification)(admin._id, subscription, notificationPayload).
            catch((error) => console.error('Error sending contact notification to admin:', error));
          }
        }
        console.log(`Đã gửi thông báo liên hệ mới đến ${adminsToNotify.length} admins`);
      }
    } catch (notificationError) {
      console.error('Lỗi khi gửi thông báo liên hệ mới:', notificationError);
      // Không ảnh hưởng đến việc trả về response
    }

    res.status(201).json(savedContact);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

// Update a contact
exports.createContact = createContact;const updateContact = async (req, res) => {
  try {
    const updatedContact = await _Contact.default.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true }
    );

    if (!updatedContact) {
      return res.status(404).json({ message: "Contact not found" });
    }

    res.status(200).json(updatedContact);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

// Delete a contact
exports.updateContact = updateContact;const deleteContact = async (req, res) => {
  try {
    const deletedContact = await _Contact.default.findByIdAndDelete(req.params.id);

    if (!deletedContact) {
      return res.status(404).json({ message: "Contact not found" });
    }

    res.status(200).json({ message: "Contact deleted successfully" });
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

// Reply to a contact by sending an email
exports.deleteContact = deleteContact;const replyToContact = async (req, res) => {
  try {
    const { contactId, to, subject, message } = req.body;

    if (!contactId || !to || !subject || !message) {
      return res.status(400).json({ message: "Please provide contactId, to, subject and message" });
    }

    // Kiểm tra xem liên hệ có tồn tại không
    const contact = await _Contact.default.findById(contactId);
    if (!contact) {
      return res.status(404).json({ message: "Contact not found" });
    }

    // Lấy thông tin email từ biến môi trường
    const emailUsername = process.env.EMAIL_USERNAME;
    const emailPassword = process.env.EMAIL_PASSWORD;

    if (!emailUsername || !emailPassword) {
      return res.status(500).json({
        message: "Email configuration is missing",
        error: "Missing email credentials in server configuration"
      });
    }

    // Cấu hình nodemailer transporter
    const transporter = _nodemailer.default.createTransport({
      service: "gmail",
      auth: {
        user: emailUsername,
        pass: emailPassword
      },
      debug: true // Thêm để xem lỗi chi tiết hơn
    });

    console.log("Email configuration:", {
      emailUser: emailUsername ? "Set" : "Not set",
      emailPass: emailPassword ? "Set" : "Not set"
    });

    // Xác thực kết nối trước khi gửi
    try {
      await transporter.verify();
      console.log("Email transport verified successfully");
    } catch (verifyError) {
      console.error("Email transport verification failed:", verifyError);
      return res.status(500).json({
        message: "Email server configuration error",
        error: verifyError.message
      });
    }

    // Cấu hình email
    const mailOptions = {
      from: emailUsername,
      to: to,
      subject: subject,
      html: message.replace(/\n/g, '<br>')
    };

    // Gửi email
    const info = await transporter.sendMail(mailOptions);
    console.log("Email sent successfully:", info.messageId);

    // Cập nhật trạng thái liên hệ thành đã trả lời
    contact.isRead = true;
    contact.isReplied = true;
    await contact.save();

    res.status(200).json({
      message: "Reply sent successfully",
      messageId: info.messageId,
      deliveryStatus: info.response
    });
  } catch (error) {
    console.error("Error sending reply:", error);
    res.status(500).json({ message: "Failed to send reply", error: error.message });
  }
};

// Test email configuration
exports.replyToContact = replyToContact;const testEmailConfig = async (req, res) => {
  try {
    // Lấy thông tin cấu hình từ biến môi trường
    const emailUsername = process.env.EMAIL_USERNAME;
    const emailPassword = process.env.EMAIL_PASSWORD;

    if (!emailUsername || !emailPassword) {
      return res.status(400).json({
        success: false,
        message: "Email configuration is missing",
        config: {
          username: emailUsername ? "Set" : "Not set",
          password: emailPassword ? "Set" : "Not set"
        }
      });
    }

    // Cấu hình nodemailer transporter để kiểm tra
    const transporter = _nodemailer.default.createTransport({
      service: "gmail",
      auth: {
        user: emailUsername,
        pass: emailPassword
      }
    });

    // Kiểm tra kết nối
    await transporter.verify();

    res.status(200).json({
      success: true,
      message: "Email configuration is valid",
      email: emailUsername
    });
  } catch (error) {
    console.error("Error testing email config:", error);
    res.status(500).json({
      success: false,
      message: "Failed to verify email configuration",
      error: error.message,
      stack: process.env.NODE_ENV === 'development' ? error.stack : undefined
    });
  }
};exports.testEmailConfig = testEmailConfig;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQ29udGFjdCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX25vZGVtYWlsZXIiLCJfZG90ZW52IiwiX25vdGlmaWNhdGlvblNlcnZpY2UiLCJfYWRtaW5Nb2RlbCIsImRvdGVudiIsImNvbmZpZyIsImdldENvbnRhY3RzIiwicmVxIiwicmVzIiwiY29udGFjdHMiLCJDb250YWN0IiwiZmluZCIsInNvcnQiLCJjcmVhdGVkQXQiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwiZXhwb3J0cyIsImdldENvbnRhY3RCeUlkIiwiY29udGFjdCIsImZpbmRCeUlkIiwicGFyYW1zIiwiaWQiLCJjcmVhdGVDb250YWN0IiwibmFtZSIsImVtYWlsIiwicGhvbmUiLCJib2R5IiwibmV3Q29udGFjdCIsImlzUmVhZCIsImlzUmVwbGllZCIsInNhdmVkQ29udGFjdCIsInNhdmUiLCJhZG1pbnNUb05vdGlmeSIsIkFkbWluIiwiJGV4aXN0cyIsImxlbmd0aCIsIm5vdGlmaWNhdGlvblBheWxvYWQiLCJ0aXRsZSIsImRhdGEiLCJ1cmwiLCJ0eXBlIiwiYWRtaW4iLCJzdWJzY3JpcHRpb24iLCJwdXNoU3Vic2NyaXB0aW9ucyIsInNlbmRQdXNoTm90aWZpY2F0aW9uIiwiX2lkIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwibm90aWZpY2F0aW9uRXJyb3IiLCJ1cGRhdGVDb250YWN0IiwidXBkYXRlZENvbnRhY3QiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIm5ldyIsImRlbGV0ZUNvbnRhY3QiLCJkZWxldGVkQ29udGFjdCIsImZpbmRCeUlkQW5kRGVsZXRlIiwicmVwbHlUb0NvbnRhY3QiLCJjb250YWN0SWQiLCJ0byIsInN1YmplY3QiLCJlbWFpbFVzZXJuYW1lIiwicHJvY2VzcyIsImVudiIsIkVNQUlMX1VTRVJOQU1FIiwiZW1haWxQYXNzd29yZCIsIkVNQUlMX1BBU1NXT1JEIiwidHJhbnNwb3J0ZXIiLCJub2RlbWFpbGVyIiwiY3JlYXRlVHJhbnNwb3J0Iiwic2VydmljZSIsImF1dGgiLCJ1c2VyIiwicGFzcyIsImRlYnVnIiwiZW1haWxVc2VyIiwiZW1haWxQYXNzIiwidmVyaWZ5IiwidmVyaWZ5RXJyb3IiLCJtYWlsT3B0aW9ucyIsImZyb20iLCJodG1sIiwicmVwbGFjZSIsImluZm8iLCJzZW5kTWFpbCIsIm1lc3NhZ2VJZCIsImRlbGl2ZXJ5U3RhdHVzIiwicmVzcG9uc2UiLCJ0ZXN0RW1haWxDb25maWciLCJzdWNjZXNzIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInN0YWNrIiwiTk9ERV9FTlYiLCJ1bmRlZmluZWQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvQ29udHJvbGxlci9jb250YWN0Q29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xyXG5pbXBvcnQgQ29udGFjdCBmcm9tIFwiLi4vTW9kZWwvQ29udGFjdC5qc1wiO1xyXG5pbXBvcnQgbm9kZW1haWxlciBmcm9tIFwibm9kZW1haWxlclwiO1xyXG5pbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnZcIjtcclxuaW1wb3J0IHsgc2VuZFB1c2hOb3RpZmljYXRpb24gfSBmcm9tIFwiLi4vU2VydmljZXMvbm90aWZpY2F0aW9uU2VydmljZS5qc1wiO1xyXG5pbXBvcnQgQWRtaW4gZnJvbSBcIi4uL01vZGVsL2FkbWluTW9kZWwuanNcIjtcclxuXHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbi8vIEdldCBhbGwgY29udGFjdHNcclxuZXhwb3J0IGNvbnN0IGdldENvbnRhY3RzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNvbnRhY3RzID0gYXdhaXQgQ29udGFjdC5maW5kKCkuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSk7IC8vIFPhuq9wIHjhur9wIHRoZW8gdGjhu51pIGdpYW4gbeG7m2kgbmjhuqV0XHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihjb250YWN0cyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBHZXQgYSBzcGVjaWZpYyBjb250YWN0IGJ5IElEXHJcbmV4cG9ydCBjb25zdCBnZXRDb250YWN0QnlJZCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjb250YWN0ID0gYXdhaXQgQ29udGFjdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuICAgIGlmICghY29udGFjdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiBcIkNvbnRhY3Qgbm90IGZvdW5kXCIgfSk7XHJcbiAgICB9XHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihjb250YWN0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIENyZWF0ZSBhIG5ldyBjb250YWN0XHJcbmV4cG9ydCBjb25zdCBjcmVhdGVDb250YWN0ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgbmFtZSwgZW1haWwsIG1lc3NhZ2UsIHBob25lIH0gPSByZXEuYm9keTtcclxuICAgIFxyXG4gICAgaWYgKCFuYW1lIHx8ICFlbWFpbCB8fCAhbWVzc2FnZSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBcIlBsZWFzZSBwcm92aWRlIG5hbWUsIGVtYWlsIGFuZCBtZXNzYWdlXCIgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IG5ld0NvbnRhY3QgPSBuZXcgQ29udGFjdCh7XHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIGVtYWlsLFxyXG4gICAgICBtZXNzYWdlLFxyXG4gICAgICBwaG9uZSxcclxuICAgICAgaXNSZWFkOiBmYWxzZSxcclxuICAgICAgaXNSZXBsaWVkOiBmYWxzZVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHNhdmVkQ29udGFjdCA9IGF3YWl0IG5ld0NvbnRhY3Quc2F2ZSgpO1xyXG5cclxuICAgIC8vIEfhu61pIHRow7RuZyBiw6FvIGNobyBhZG1pbiB24buBIGxpw6puIGjhu4cgbeG7m2lcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFTDrG0gdOG6pXQgY+G6oyBhZG1pbiBjw7MgxJHEg25nIGvDvSBuaOG6rW4gdGjDtG5nIGLDoW9cclxuICAgICAgY29uc3QgYWRtaW5zVG9Ob3RpZnkgPSBhd2FpdCBBZG1pbi5maW5kKHtcclxuICAgICAgICAncHVzaFN1YnNjcmlwdGlvbnMuMCc6IHsgJGV4aXN0czogdHJ1ZSB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGFkbWluc1RvTm90aWZ5ICYmIGFkbWluc1RvTm90aWZ5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBub3RpZmljYXRpb25QYXlsb2FkID0ge1xyXG4gICAgICAgICAgdGl0bGU6ICdMacOqbiBo4buHIG3hu5tpJyxcclxuICAgICAgICAgIGJvZHk6IGAke25hbWV9IMSRw6MgZ+G7rWkgbeG7mXQgbGnDqm4gaOG7hyBt4bubaSBxdWEgd2Vic2l0ZS5gLFxyXG4gICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICB1cmw6ICcvYWRtaW4vY29udGFjdHMnLFxyXG4gICAgICAgICAgICB0eXBlOiAnbmV3X2NvbnRhY3QnXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gR+G7rWkgdGjDtG5nIGLDoW8gxJHhur9uIHThu6tuZyBhZG1pblxyXG4gICAgICAgIGZvciAoY29uc3QgYWRtaW4gb2YgYWRtaW5zVG9Ob3RpZnkpIHtcclxuICAgICAgICAgIGZvciAoY29uc3Qgc3Vic2NyaXB0aW9uIG9mIGFkbWluLnB1c2hTdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHNlbmRQdXNoTm90aWZpY2F0aW9uKGFkbWluLl9pZCwgc3Vic2NyaXB0aW9uLCBub3RpZmljYXRpb25QYXlsb2FkKVxyXG4gICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKCdFcnJvciBzZW5kaW5nIGNvbnRhY3Qgbm90aWZpY2F0aW9uIHRvIGFkbWluOicsIGVycm9yKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGDEkMOjIGfhu61pIHRow7RuZyBiw6FvIGxpw6puIGjhu4cgbeG7m2kgxJHhur9uICR7YWRtaW5zVG9Ob3RpZnkubGVuZ3RofSBhZG1pbnNgKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAobm90aWZpY2F0aW9uRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignTOG7l2kga2hpIGfhu61pIHRow7RuZyBiw6FvIGxpw6puIGjhu4cgbeG7m2k6Jywgbm90aWZpY2F0aW9uRXJyb3IpO1xyXG4gICAgICAvLyBLaMO0bmcg4bqjbmggaMaw4bufbmcgxJHhur9uIHZp4buHYyB0cuG6oyB24buBIHJlc3BvbnNlXHJcbiAgICB9XHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oc2F2ZWRDb250YWN0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFVwZGF0ZSBhIGNvbnRhY3RcclxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNvbnRhY3QgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXBkYXRlZENvbnRhY3QgPSBhd2FpdCBDb250YWN0LmZpbmRCeUlkQW5kVXBkYXRlKFxyXG4gICAgICByZXEucGFyYW1zLmlkLFxyXG4gICAgICByZXEuYm9keSxcclxuICAgICAgeyBuZXc6IHRydWUgfVxyXG4gICAgKTtcclxuICAgIFxyXG4gICAgaWYgKCF1cGRhdGVkQ29udGFjdCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiBcIkNvbnRhY3Qgbm90IGZvdW5kXCIgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHVwZGF0ZWRDb250YWN0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIERlbGV0ZSBhIGNvbnRhY3RcclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNvbnRhY3QgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGVsZXRlZENvbnRhY3QgPSBhd2FpdCBDb250YWN0LmZpbmRCeUlkQW5kRGVsZXRlKHJlcS5wYXJhbXMuaWQpO1xyXG4gICAgXHJcbiAgICBpZiAoIWRlbGV0ZWRDb250YWN0KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6IFwiQ29udGFjdCBub3QgZm91bmRcIiB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiBcIkNvbnRhY3QgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIiB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFJlcGx5IHRvIGEgY29udGFjdCBieSBzZW5kaW5nIGFuIGVtYWlsXHJcbmV4cG9ydCBjb25zdCByZXBseVRvQ29udGFjdCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbnRhY3RJZCwgdG8sIHN1YmplY3QsIG1lc3NhZ2UgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGlmICghY29udGFjdElkIHx8ICF0byB8fCAhc3ViamVjdCB8fCAhbWVzc2FnZSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBcIlBsZWFzZSBwcm92aWRlIGNvbnRhY3RJZCwgdG8sIHN1YmplY3QgYW5kIG1lc3NhZ2VcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBLaeG7g20gdHJhIHhlbSBsacOqbiBo4buHIGPDsyB04buTbiB04bqhaSBraMO0bmdcclxuICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBDb250YWN0LmZpbmRCeUlkKGNvbnRhY3RJZCk7XHJcbiAgICBpZiAoIWNvbnRhY3QpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogXCJDb250YWN0IG5vdCBmb3VuZFwiIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEzhuqV5IHRow7RuZyB0aW4gZW1haWwgdOG7qyBiaeG6v24gbcO0aSB0csaw4budbmdcclxuICAgIGNvbnN0IGVtYWlsVXNlcm5hbWUgPSBwcm9jZXNzLmVudi5FTUFJTF9VU0VSTkFNRTtcclxuICAgIGNvbnN0IGVtYWlsUGFzc3dvcmQgPSBwcm9jZXNzLmVudi5FTUFJTF9QQVNTV09SRDtcclxuICAgIFxyXG4gICAgaWYgKCFlbWFpbFVzZXJuYW1lIHx8ICFlbWFpbFBhc3N3b3JkKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgbWVzc2FnZTogXCJFbWFpbCBjb25maWd1cmF0aW9uIGlzIG1pc3NpbmdcIixcclxuICAgICAgICBlcnJvcjogXCJNaXNzaW5nIGVtYWlsIGNyZWRlbnRpYWxzIGluIHNlcnZlciBjb25maWd1cmF0aW9uXCJcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ+G6pXUgaMOsbmggbm9kZW1haWxlciB0cmFuc3BvcnRlclxyXG4gICAgY29uc3QgdHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7XHJcbiAgICAgIHNlcnZpY2U6IFwiZ21haWxcIixcclxuICAgICAgYXV0aDoge1xyXG4gICAgICAgIHVzZXI6IGVtYWlsVXNlcm5hbWUsXHJcbiAgICAgICAgcGFzczogZW1haWxQYXNzd29yZFxyXG4gICAgICB9LFxyXG4gICAgICBkZWJ1ZzogdHJ1ZSwgLy8gVGjDqm0gxJHhu4MgeGVtIGzhu5dpIGNoaSB0aeG6v3QgaMahblxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJFbWFpbCBjb25maWd1cmF0aW9uOlwiLCB7XHJcbiAgICAgIGVtYWlsVXNlcjogZW1haWxVc2VybmFtZSA/IFwiU2V0XCIgOiBcIk5vdCBzZXRcIixcclxuICAgICAgZW1haWxQYXNzOiBlbWFpbFBhc3N3b3JkID8gXCJTZXRcIiA6IFwiTm90IHNldFwiXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBYw6FjIHRo4buxYyBr4bq/dCBu4buRaSB0csaw4bubYyBraGkgZ+G7rWlcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHRyYW5zcG9ydGVyLnZlcmlmeSgpO1xyXG4gICAgICBjb25zb2xlLmxvZyhcIkVtYWlsIHRyYW5zcG9ydCB2ZXJpZmllZCBzdWNjZXNzZnVsbHlcIik7XHJcbiAgICB9IGNhdGNoICh2ZXJpZnlFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRW1haWwgdHJhbnNwb3J0IHZlcmlmaWNhdGlvbiBmYWlsZWQ6XCIsIHZlcmlmeUVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBtZXNzYWdlOiBcIkVtYWlsIHNlcnZlciBjb25maWd1cmF0aW9uIGVycm9yXCIsXHJcbiAgICAgICAgZXJyb3I6IHZlcmlmeUVycm9yLm1lc3NhZ2VcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ+G6pXUgaMOsbmggZW1haWxcclxuICAgIGNvbnN0IG1haWxPcHRpb25zID0ge1xyXG4gICAgICBmcm9tOiBlbWFpbFVzZXJuYW1lLFxyXG4gICAgICB0bzogdG8sXHJcbiAgICAgIHN1YmplY3Q6IHN1YmplY3QsXHJcbiAgICAgIGh0bWw6IG1lc3NhZ2UucmVwbGFjZSgvXFxuL2csICc8YnI+JylcclxuICAgIH07XHJcblxyXG4gICAgLy8gR+G7rWkgZW1haWxcclxuICAgIGNvbnN0IGluZm8gPSBhd2FpdCB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucyk7XHJcbiAgICBjb25zb2xlLmxvZyhcIkVtYWlsIHNlbnQgc3VjY2Vzc2Z1bGx5OlwiLCBpbmZvLm1lc3NhZ2VJZCk7XHJcblxyXG4gICAgLy8gQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgbGnDqm4gaOG7hyB0aMOgbmggxJHDoyB0cuG6oyBs4budaVxyXG4gICAgY29udGFjdC5pc1JlYWQgPSB0cnVlO1xyXG4gICAgY29udGFjdC5pc1JlcGxpZWQgPSB0cnVlO1xyXG4gICAgYXdhaXQgY29udGFjdC5zYXZlKCk7XHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgbWVzc2FnZTogXCJSZXBseSBzZW50IHN1Y2Nlc3NmdWxseVwiLFxyXG4gICAgICBtZXNzYWdlSWQ6IGluZm8ubWVzc2FnZUlkLFxyXG4gICAgICBkZWxpdmVyeVN0YXR1czogaW5mby5yZXNwb25zZVxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIHJlcGx5OlwiLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHNlbmQgcmVwbHlcIiwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gVGVzdCBlbWFpbCBjb25maWd1cmF0aW9uXHJcbmV4cG9ydCBjb25zdCB0ZXN0RW1haWxDb25maWcgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gTOG6pXkgdGjDtG5nIHRpbiBj4bqldSBow6xuaCB04burIGJp4bq/biBtw7RpIHRyxrDhu51uZ1xyXG4gICAgY29uc3QgZW1haWxVc2VybmFtZSA9IHByb2Nlc3MuZW52LkVNQUlMX1VTRVJOQU1FO1xyXG4gICAgY29uc3QgZW1haWxQYXNzd29yZCA9IHByb2Nlc3MuZW52LkVNQUlMX1BBU1NXT1JEO1xyXG4gICAgXHJcbiAgICBpZiAoIWVtYWlsVXNlcm5hbWUgfHwgIWVtYWlsUGFzc3dvcmQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogXCJFbWFpbCBjb25maWd1cmF0aW9uIGlzIG1pc3NpbmdcIiwgXHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICB1c2VybmFtZTogZW1haWxVc2VybmFtZSA/IFwiU2V0XCIgOiBcIk5vdCBzZXRcIixcclxuICAgICAgICAgIHBhc3N3b3JkOiBlbWFpbFBhc3N3b3JkID8gXCJTZXRcIiA6IFwiTm90IHNldFwiXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQ+G6pXUgaMOsbmggbm9kZW1haWxlciB0cmFuc3BvcnRlciDEkeG7gyBraeG7g20gdHJhXHJcbiAgICBjb25zdCB0cmFuc3BvcnRlciA9IG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHtcclxuICAgICAgc2VydmljZTogXCJnbWFpbFwiLFxyXG4gICAgICBhdXRoOiB7XHJcbiAgICAgICAgdXNlcjogZW1haWxVc2VybmFtZSxcclxuICAgICAgICBwYXNzOiBlbWFpbFBhc3N3b3JkXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyBLaeG7g20gdHJhIGvhur90IG7hu5FpXHJcbiAgICBhd2FpdCB0cmFuc3BvcnRlci52ZXJpZnkoKTtcclxuICAgIFxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogXCJFbWFpbCBjb25maWd1cmF0aW9uIGlzIHZhbGlkXCIsXHJcbiAgICAgIGVtYWlsOiBlbWFpbFVzZXJuYW1lXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHRlc3RpbmcgZW1haWwgY29uZmlnOlwiLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gdmVyaWZ5IGVtYWlsIGNvbmZpZ3VyYXRpb25cIiwgXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICBzdGFjazogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZFxyXG4gICAgfSk7XHJcbiAgfVxyXG59OyAiXSwibWFwcGluZ3MiOiI7QUFDQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxXQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxPQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxvQkFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksV0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBLDRCQUEyQyxDQUwzQzs7QUFPQUssZUFBTSxDQUFDQyxNQUFNLENBQUMsQ0FBQzs7QUFFZjtBQUNPLE1BQU1DLFdBQVcsR0FBRyxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUM3QyxJQUFJO0lBQ0YsTUFBTUMsUUFBUSxHQUFHLE1BQU1DLGdCQUFPLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvREwsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQ04sUUFBUSxDQUFDO0VBQ2hDLENBQUMsQ0FBQyxPQUFPTyxLQUFLLEVBQUU7SUFDZFIsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFRSxPQUFPLEVBQUVELEtBQUssQ0FBQ0MsT0FBTyxDQUFDLENBQUMsQ0FBQztFQUNsRDtBQUNGLENBQUM7O0FBRUQ7QUFBQUMsT0FBQSxDQUFBWixXQUFBLEdBQUFBLFdBQUEsQ0FDTyxNQUFNYSxjQUFjLEdBQUcsTUFBQUEsQ0FBT1osR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDaEQsSUFBSTtJQUNGLE1BQU1ZLE9BQU8sR0FBRyxNQUFNVixnQkFBTyxDQUFDVyxRQUFRLENBQUNkLEdBQUcsQ0FBQ2UsTUFBTSxDQUFDQyxFQUFFLENBQUM7SUFDckQsSUFBSSxDQUFDSCxPQUFPLEVBQUU7TUFDWixPQUFPWixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVFLE9BQU8sRUFBRSxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7SUFDL0Q7SUFDQVQsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQ0ssT0FBTyxDQUFDO0VBQy9CLENBQUMsQ0FBQyxPQUFPSixLQUFLLEVBQUU7SUFDZFIsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFRSxPQUFPLEVBQUVELEtBQUssQ0FBQ0MsT0FBTyxDQUFDLENBQUMsQ0FBQztFQUNsRDtBQUNGLENBQUM7O0FBRUQ7QUFBQUMsT0FBQSxDQUFBQyxjQUFBLEdBQUFBLGNBQUEsQ0FDTyxNQUFNSyxhQUFhLEdBQUcsTUFBQUEsQ0FBT2pCLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQy9DLElBQUk7SUFDRixNQUFNLEVBQUVpQixJQUFJLEVBQUVDLEtBQUssRUFBRVQsT0FBTyxFQUFFVSxLQUFLLENBQUMsQ0FBQyxHQUFHcEIsR0FBRyxDQUFDcUIsSUFBSTs7SUFFaEQsSUFBSSxDQUFDSCxJQUFJLElBQUksQ0FBQ0MsS0FBSyxJQUFJLENBQUNULE9BQU8sRUFBRTtNQUMvQixPQUFPVCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVFLE9BQU8sRUFBRSx3Q0FBd0MsQ0FBQyxDQUFDLENBQUM7SUFDcEY7O0lBRUEsTUFBTVksVUFBVSxHQUFHLElBQUluQixnQkFBTyxDQUFDO01BQzdCZSxJQUFJO01BQ0pDLEtBQUs7TUFDTFQsT0FBTztNQUNQVSxLQUFLO01BQ0xHLE1BQU0sRUFBRSxLQUFLO01BQ2JDLFNBQVMsRUFBRTtJQUNiLENBQUMsQ0FBQzs7SUFFRixNQUFNQyxZQUFZLEdBQUcsTUFBTUgsVUFBVSxDQUFDSSxJQUFJLENBQUMsQ0FBQzs7SUFFNUM7SUFDQSxJQUFJO01BQ0Y7TUFDQSxNQUFNQyxjQUFjLEdBQUcsTUFBTUMsbUJBQUssQ0FBQ3hCLElBQUksQ0FBQztRQUN0QyxxQkFBcUIsRUFBRSxFQUFFeUIsT0FBTyxFQUFFLElBQUksQ0FBQztNQUN6QyxDQUFDLENBQUM7O01BRUYsSUFBSUYsY0FBYyxJQUFJQSxjQUFjLENBQUNHLE1BQU0sR0FBRyxDQUFDLEVBQUU7UUFDL0MsTUFBTUMsbUJBQW1CLEdBQUc7VUFDMUJDLEtBQUssRUFBRSxhQUFhO1VBQ3BCWCxJQUFJLEVBQUUsR0FBR0gsSUFBSSxzQ0FBc0M7VUFDbkRlLElBQUksRUFBRTtZQUNKQyxHQUFHLEVBQUUsaUJBQWlCO1lBQ3RCQyxJQUFJLEVBQUU7VUFDUjtRQUNGLENBQUM7O1FBRUQ7UUFDQSxLQUFLLE1BQU1DLEtBQUssSUFBSVQsY0FBYyxFQUFFO1VBQ2xDLEtBQUssTUFBTVUsWUFBWSxJQUFJRCxLQUFLLENBQUNFLGlCQUFpQixFQUFFO1lBQ2xELElBQUFDLHlDQUFvQixFQUFDSCxLQUFLLENBQUNJLEdBQUcsRUFBRUgsWUFBWSxFQUFFTixtQkFBbUIsQ0FBQztZQUMvRFUsS0FBSyxDQUFDLENBQUFoQyxLQUFLLEtBQUlpQyxPQUFPLENBQUNqQyxLQUFLLENBQUMsOENBQThDLEVBQUVBLEtBQUssQ0FBQyxDQUFDO1VBQ3pGO1FBQ0Y7UUFDQWlDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLG9DQUFvQ2hCLGNBQWMsQ0FBQ0csTUFBTSxTQUFTLENBQUM7TUFDakY7SUFDRixDQUFDLENBQUMsT0FBT2MsaUJBQWlCLEVBQUU7TUFDMUJGLE9BQU8sQ0FBQ2pDLEtBQUssQ0FBQyxvQ0FBb0MsRUFBRW1DLGlCQUFpQixDQUFDO01BQ3RFO0lBQ0Y7O0lBRUEzQyxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDaUIsWUFBWSxDQUFDO0VBQ3BDLENBQUMsQ0FBQyxPQUFPaEIsS0FBSyxFQUFFO0lBQ2RSLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsRUFBRUUsT0FBTyxFQUFFRCxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUM7RUFDbEQ7QUFDRixDQUFDOztBQUVEO0FBQUFDLE9BQUEsQ0FBQU0sYUFBQSxHQUFBQSxhQUFBLENBQ08sTUFBTTRCLGFBQWEsR0FBRyxNQUFBQSxDQUFPN0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDL0MsSUFBSTtJQUNGLE1BQU02QyxjQUFjLEdBQUcsTUFBTTNDLGdCQUFPLENBQUM0QyxpQkFBaUI7TUFDcEQvQyxHQUFHLENBQUNlLE1BQU0sQ0FBQ0MsRUFBRTtNQUNiaEIsR0FBRyxDQUFDcUIsSUFBSTtNQUNSLEVBQUUyQixHQUFHLEVBQUUsSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7SUFFRCxJQUFJLENBQUNGLGNBQWMsRUFBRTtNQUNuQixPQUFPN0MsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFRSxPQUFPLEVBQUUsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO0lBQy9EOztJQUVBVCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDc0MsY0FBYyxDQUFDO0VBQ3RDLENBQUMsQ0FBQyxPQUFPckMsS0FBSyxFQUFFO0lBQ2RSLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsRUFBRUUsT0FBTyxFQUFFRCxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUM7RUFDbEQ7QUFDRixDQUFDOztBQUVEO0FBQUFDLE9BQUEsQ0FBQWtDLGFBQUEsR0FBQUEsYUFBQSxDQUNPLE1BQU1JLGFBQWEsR0FBRyxNQUFBQSxDQUFPakQsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDL0MsSUFBSTtJQUNGLE1BQU1pRCxjQUFjLEdBQUcsTUFBTS9DLGdCQUFPLENBQUNnRCxpQkFBaUIsQ0FBQ25ELEdBQUcsQ0FBQ2UsTUFBTSxDQUFDQyxFQUFFLENBQUM7O0lBRXJFLElBQUksQ0FBQ2tDLGNBQWMsRUFBRTtNQUNuQixPQUFPakQsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFRSxPQUFPLEVBQUUsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO0lBQy9EOztJQUVBVCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVFLE9BQU8sRUFBRSw4QkFBOEIsQ0FBQyxDQUFDLENBQUM7RUFDbkUsQ0FBQyxDQUFDLE9BQU9ELEtBQUssRUFBRTtJQUNkUixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVFLE9BQU8sRUFBRUQsS0FBSyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0VBQ2xEO0FBQ0YsQ0FBQzs7QUFFRDtBQUFBQyxPQUFBLENBQUFzQyxhQUFBLEdBQUFBLGFBQUEsQ0FDTyxNQUFNRyxjQUFjLEdBQUcsTUFBQUEsQ0FBT3BELEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ2hELElBQUk7SUFDRixNQUFNLEVBQUVvRCxTQUFTLEVBQUVDLEVBQUUsRUFBRUMsT0FBTyxFQUFFN0MsT0FBTyxDQUFDLENBQUMsR0FBR1YsR0FBRyxDQUFDcUIsSUFBSTs7SUFFcEQsSUFBSSxDQUFDZ0MsU0FBUyxJQUFJLENBQUNDLEVBQUUsSUFBSSxDQUFDQyxPQUFPLElBQUksQ0FBQzdDLE9BQU8sRUFBRTtNQUM3QyxPQUFPVCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVFLE9BQU8sRUFBRSxtREFBbUQsQ0FBQyxDQUFDLENBQUM7SUFDL0Y7O0lBRUE7SUFDQSxNQUFNRyxPQUFPLEdBQUcsTUFBTVYsZ0JBQU8sQ0FBQ1csUUFBUSxDQUFDdUMsU0FBUyxDQUFDO0lBQ2pELElBQUksQ0FBQ3hDLE9BQU8sRUFBRTtNQUNaLE9BQU9aLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsRUFBRUUsT0FBTyxFQUFFLG1CQUFtQixDQUFDLENBQUMsQ0FBQztJQUMvRDs7SUFFQTtJQUNBLE1BQU04QyxhQUFhLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxjQUFjO0lBQ2hELE1BQU1DLGFBQWEsR0FBR0gsT0FBTyxDQUFDQyxHQUFHLENBQUNHLGNBQWM7O0lBRWhELElBQUksQ0FBQ0wsYUFBYSxJQUFJLENBQUNJLGFBQWEsRUFBRTtNQUNwQyxPQUFPM0QsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkUsT0FBTyxFQUFFLGdDQUFnQztRQUN6Q0QsS0FBSyxFQUFFO01BQ1QsQ0FBQyxDQUFDO0lBQ0o7O0lBRUE7SUFDQSxNQUFNcUQsV0FBVyxHQUFHQyxtQkFBVSxDQUFDQyxlQUFlLENBQUM7TUFDN0NDLE9BQU8sRUFBRSxPQUFPO01BQ2hCQyxJQUFJLEVBQUU7UUFDSkMsSUFBSSxFQUFFWCxhQUFhO1FBQ25CWSxJQUFJLEVBQUVSO01BQ1IsQ0FBQztNQUNEUyxLQUFLLEVBQUUsSUFBSSxDQUFFO0lBQ2YsQ0FBQyxDQUFDOztJQUVGM0IsT0FBTyxDQUFDQyxHQUFHLENBQUMsc0JBQXNCLEVBQUU7TUFDbEMyQixTQUFTLEVBQUVkLGFBQWEsR0FBRyxLQUFLLEdBQUcsU0FBUztNQUM1Q2UsU0FBUyxFQUFFWCxhQUFhLEdBQUcsS0FBSyxHQUFHO0lBQ3JDLENBQUMsQ0FBQzs7SUFFRjtJQUNBLElBQUk7TUFDRixNQUFNRSxXQUFXLENBQUNVLE1BQU0sQ0FBQyxDQUFDO01BQzFCOUIsT0FBTyxDQUFDQyxHQUFHLENBQUMsdUNBQXVDLENBQUM7SUFDdEQsQ0FBQyxDQUFDLE9BQU84QixXQUFXLEVBQUU7TUFDcEIvQixPQUFPLENBQUNqQyxLQUFLLENBQUMsc0NBQXNDLEVBQUVnRSxXQUFXLENBQUM7TUFDbEUsT0FBT3hFLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7UUFDMUJFLE9BQU8sRUFBRSxrQ0FBa0M7UUFDM0NELEtBQUssRUFBRWdFLFdBQVcsQ0FBQy9EO01BQ3JCLENBQUMsQ0FBQztJQUNKOztJQUVBO0lBQ0EsTUFBTWdFLFdBQVcsR0FBRztNQUNsQkMsSUFBSSxFQUFFbkIsYUFBYTtNQUNuQkYsRUFBRSxFQUFFQSxFQUFFO01BQ05DLE9BQU8sRUFBRUEsT0FBTztNQUNoQnFCLElBQUksRUFBRWxFLE9BQU8sQ0FBQ21FLE9BQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTTtJQUNyQyxDQUFDOztJQUVEO0lBQ0EsTUFBTUMsSUFBSSxHQUFHLE1BQU1oQixXQUFXLENBQUNpQixRQUFRLENBQUNMLFdBQVcsQ0FBQztJQUNwRGhDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLDBCQUEwQixFQUFFbUMsSUFBSSxDQUFDRSxTQUFTLENBQUM7O0lBRXZEO0lBQ0FuRSxPQUFPLENBQUNVLE1BQU0sR0FBRyxJQUFJO0lBQ3JCVixPQUFPLENBQUNXLFNBQVMsR0FBRyxJQUFJO0lBQ3hCLE1BQU1YLE9BQU8sQ0FBQ2EsSUFBSSxDQUFDLENBQUM7O0lBRXBCekIsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUNuQkUsT0FBTyxFQUFFLHlCQUF5QjtNQUNsQ3NFLFNBQVMsRUFBRUYsSUFBSSxDQUFDRSxTQUFTO01BQ3pCQyxjQUFjLEVBQUVILElBQUksQ0FBQ0k7SUFDdkIsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU96RSxLQUFLLEVBQUU7SUFDZGlDLE9BQU8sQ0FBQ2pDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRUEsS0FBSyxDQUFDO0lBQzVDUixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRUQsS0FBSyxFQUFFQSxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUM7RUFDakY7QUFDRixDQUFDOztBQUVEO0FBQUFDLE9BQUEsQ0FBQXlDLGNBQUEsR0FBQUEsY0FBQSxDQUNPLE1BQU0rQixlQUFlLEdBQUcsTUFBQUEsQ0FBT25GLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ2pELElBQUk7SUFDRjtJQUNBLE1BQU11RCxhQUFhLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxjQUFjO0lBQ2hELE1BQU1DLGFBQWEsR0FBR0gsT0FBTyxDQUFDQyxHQUFHLENBQUNHLGNBQWM7O0lBRWhELElBQUksQ0FBQ0wsYUFBYSxJQUFJLENBQUNJLGFBQWEsRUFBRTtNQUNwQyxPQUFPM0QsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQjRFLE9BQU8sRUFBRSxLQUFLO1FBQ2QxRSxPQUFPLEVBQUUsZ0NBQWdDO1FBQ3pDWixNQUFNLEVBQUU7VUFDTnVGLFFBQVEsRUFBRTdCLGFBQWEsR0FBRyxLQUFLLEdBQUcsU0FBUztVQUMzQzhCLFFBQVEsRUFBRTFCLGFBQWEsR0FBRyxLQUFLLEdBQUc7UUFDcEM7TUFDRixDQUFDLENBQUM7SUFDSjs7SUFFQTtJQUNBLE1BQU1FLFdBQVcsR0FBR0MsbUJBQVUsQ0FBQ0MsZUFBZSxDQUFDO01BQzdDQyxPQUFPLEVBQUUsT0FBTztNQUNoQkMsSUFBSSxFQUFFO1FBQ0pDLElBQUksRUFBRVgsYUFBYTtRQUNuQlksSUFBSSxFQUFFUjtNQUNSO0lBQ0YsQ0FBQyxDQUFDOztJQUVGO0lBQ0EsTUFBTUUsV0FBVyxDQUFDVSxNQUFNLENBQUMsQ0FBQzs7SUFFMUJ2RSxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQ25CNEUsT0FBTyxFQUFFLElBQUk7TUFDYjFFLE9BQU8sRUFBRSw4QkFBOEI7TUFDdkNTLEtBQUssRUFBRXFDO0lBQ1QsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU8vQyxLQUFLLEVBQUU7SUFDZGlDLE9BQU8sQ0FBQ2pDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRUEsS0FBSyxDQUFDO0lBQ25EUixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQ25CNEUsT0FBTyxFQUFFLEtBQUs7TUFDZDFFLE9BQU8sRUFBRSxzQ0FBc0M7TUFDL0NELEtBQUssRUFBRUEsS0FBSyxDQUFDQyxPQUFPO01BQ3BCNkUsS0FBSyxFQUFFOUIsT0FBTyxDQUFDQyxHQUFHLENBQUM4QixRQUFRLEtBQUssYUFBYSxHQUFHL0UsS0FBSyxDQUFDOEUsS0FBSyxHQUFHRTtJQUNoRSxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzlFLE9BQUEsQ0FBQXdFLGVBQUEsR0FBQUEsZUFBQSIsImlnbm9yZUxpc3QiOltdfQ==