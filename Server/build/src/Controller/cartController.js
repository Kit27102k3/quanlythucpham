"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.updateCartItem = exports.removeFromCart = exports.getCart = exports.clearCart = exports.addToCart = void 0;var _Cart = _interopRequireDefault(require("../Model/Cart.js"));
var _Products = _interopRequireDefault(require("../Model/Products.js"));

const getCart = async (req, res) => {
  const { userId } = req.params;

  try {
    const cart = await _Cart.default.findOne({ userId }).populate("items.productId");
    if (!cart) {
      return res.
      status(404).
      json({ message: "Giỏ hàng không tồn tại" });
    }

    cart.items.sort((a, b) => b.createdAt - a.createdAt);

    res.status(200).json({ success: true, cart });
  } catch (error) {
    console.error("Lỗi khi lấy giỏ hàng:", error);
    res.status(500).json({ success: false, message: "Lỗi server" });
  }
};exports.getCart = getCart;

const clearCart = async (req, res) => {
  const { userId } = req.body;

  try {
    const cart = await _Cart.default.findOne({ userId });

    if (!cart) {
      return res.
      status(404).
      json({ success: false, message: "Giỏ hàng không tồn tại" });
    }

    // Xóa tất cả các item trong giỏ hàng
    cart.items = [];
    await cart.save();

    res.status(200).json({
      success: true,
      message: "Đã xóa tất cả sản phẩm khỏi giỏ hàng",
      cart
    });
  } catch (error) {
    console.error("Lỗi khi xóa toàn bộ giỏ hàng:", error);
    res.status(500).json({ success: false, message: "Lỗi server" });
  }
};exports.clearCart = clearCart;

const addToCart = async (req, res) => {
  const { userId, productId, quantity, unit, unitPrice, conversionRate } = req.body;

  // Kiểm tra userId
  if (!userId) {
    return res.status(400).json({
      success: false,
      message: "userId là bắt buộc"
    });
  }

  // Kiểm tra productId
  if (!productId) {
    return res.status(400).json({
      success: false,
      message: "productId là bắt buộc"
    });
  }

  try {
    let cart = await _Cart.default.findOne({ userId });

    // Lấy thông tin sản phẩm để có giá chính xác
    const product = await _Products.default.findById(productId);

    if (!product) {
      return res.status(404).json({
        success: false,
        message: "Sản phẩm không tồn tại"
      });
    }

    // Xác định đơn vị và giá
    let selectedUnit = unit || product.productUnit;
    let selectedPrice = unitPrice;
    let selectedConversionRate = conversionRate || 1;

    // Nếu không có giá được chỉ định, sử dụng giá mặc định từ sản phẩm
    if (!selectedPrice) {
      // Kiểm tra đơn vị trong unitOptions
      if (product.unitOptions && product.unitOptions.length > 0) {
        const unitOption = product.unitOptions.find((opt) => opt.unit === selectedUnit);
        if (unitOption) {
          selectedPrice = unitOption.price;
          selectedConversionRate = unitOption.conversionRate;
        }
      }

      // Nếu không tìm thấy, sử dụng giá sản phẩm mặc định
      if (!selectedPrice) {
        selectedPrice = product.productDiscount > 0 ?
        product.productPromoPrice :
        product.productPrice;
      }
    }

    // Tính giá có tính đến giảm giá
    const finalPrice = product.productDiscount > 0 ?
    selectedPrice - selectedPrice * product.productDiscount / 100 :
    selectedPrice;

    if (!cart) {
      cart = new _Cart.default({ userId, items: [] });
    }

    // Tìm item đã tồn tại với cùng sản phẩm VÀ cùng đơn vị đo
    const existingItem = cart.items.find(
      (item) => item.productId.toString() === productId && item.unit === selectedUnit
    );

    if (existingItem) {
      existingItem.quantity += quantity;
      existingItem.price = finalPrice;
      existingItem.unitPrice = selectedPrice;
      existingItem.conversionRate = selectedConversionRate;
      existingItem.createdAt = new Date();
    } else {
      cart.items.push({
        productId,
        quantity,
        price: finalPrice,
        unit: selectedUnit,
        unitPrice: selectedPrice,
        conversionRate: selectedConversionRate,
        createdAt: new Date()
      });
    }

    await cart.save();

    res.status(200).json({
      success: true,
      message: "Sản phẩm đã được thêm vào giỏ hàng",
      cart
    });
  } catch (error) {
    console.error("Lỗi khi thêm vào giỏ hàng:", error);
    res.status(500).json({ success: false, message: "Lỗi server" });
  }
};exports.addToCart = addToCart;

const removeFromCart = async (req, res) => {
  const { userId, productId } = req.body;

  try {
    const cart = await _Cart.default.findOne({ userId });

    if (!cart) {
      return res.
      status(404).
      json({ success: false, message: "Giỏ hàng không tồn tại" });
    }

    cart.items = cart.items.filter(
      (item) => item.productId.toString() !== productId
    );

    await cart.save();

    res.status(200).json({
      success: true,
      message: "Sản phẩm đã được xóa khỏi giỏ hàng",
      cart
    });
  } catch (error) {
    console.error("Lỗi khi xóa sản phẩm khỏi giỏ hàng:", error);
    res.status(500).json({ success: false, message: "Lỗi server" });
  }
};exports.removeFromCart = removeFromCart;

const updateCartItem = async (req, res) => {
  const { userId, productId, quantity, unit, unitPrice, conversionRate } = req.body;

  try {
    const cart = await _Cart.default.findOne({ userId });

    if (!cart) {
      return res.
      status(404).
      json({ success: false, message: "Giỏ hàng không tồn tại" });
    }

    // Tìm sản phẩm trong giỏ hàng theo ID và đơn vị (nếu được chỉ định)
    let existingItem;

    if (unit) {
      // Tìm theo productId và unit
      existingItem = cart.items.find(
        (item) => item.productId.toString() === productId && item.unit === unit
      );
    } else {
      // Tìm chỉ theo productId
      existingItem = cart.items.find(
        (item) => item.productId.toString() === productId
      );
    }

    if (!existingItem) {
      return res.
      status(404).
      json({
        success: false,
        message: "Sản phẩm không tồn tại trong giỏ hàng"
      });
    }

    // Cập nhật số lượng
    if (quantity) {
      existingItem.quantity = quantity;
    }

    // Cập nhật đơn vị đo nếu được chỉ định
    if (unit) {
      existingItem.unit = unit;
    }

    // Cập nhật giá đơn vị nếu được chỉ định
    if (unitPrice) {
      existingItem.unitPrice = unitPrice;
      // Cập nhật giá tổng
      const product = await _Products.default.findById(productId);
      const finalPrice = product.productDiscount > 0 ?
      unitPrice - unitPrice * product.productDiscount / 100 :
      unitPrice;
      existingItem.price = finalPrice;
    }

    // Cập nhật tỷ lệ chuyển đổi nếu được chỉ định
    if (conversionRate) {
      existingItem.conversionRate = conversionRate;
    }

    existingItem.createdAt = new Date();
    await cart.save();

    res.status(200).json({
      success: true,
      message: "Sản phẩm đã được cập nhật",
      cart
    });
  } catch (error) {
    console.error("Lỗi khi cập nhật sản phẩm:", error);
    res.status(500).json({ success: false, message: "Lỗi server" });
  }
};exports.updateCartItem = updateCartItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQ2FydCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX1Byb2R1Y3RzIiwiZ2V0Q2FydCIsInJlcSIsInJlcyIsInVzZXJJZCIsInBhcmFtcyIsImNhcnQiLCJDYXJ0IiwiZmluZE9uZSIsInBvcHVsYXRlIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJpdGVtcyIsInNvcnQiLCJhIiwiYiIsImNyZWF0ZWRBdCIsInN1Y2Nlc3MiLCJlcnJvciIsImNvbnNvbGUiLCJleHBvcnRzIiwiY2xlYXJDYXJ0IiwiYm9keSIsInNhdmUiLCJhZGRUb0NhcnQiLCJwcm9kdWN0SWQiLCJxdWFudGl0eSIsInVuaXQiLCJ1bml0UHJpY2UiLCJjb252ZXJzaW9uUmF0ZSIsInByb2R1Y3QiLCJQcm9kdWN0IiwiZmluZEJ5SWQiLCJzZWxlY3RlZFVuaXQiLCJwcm9kdWN0VW5pdCIsInNlbGVjdGVkUHJpY2UiLCJzZWxlY3RlZENvbnZlcnNpb25SYXRlIiwidW5pdE9wdGlvbnMiLCJsZW5ndGgiLCJ1bml0T3B0aW9uIiwiZmluZCIsIm9wdCIsInByaWNlIiwicHJvZHVjdERpc2NvdW50IiwicHJvZHVjdFByb21vUHJpY2UiLCJwcm9kdWN0UHJpY2UiLCJmaW5hbFByaWNlIiwiZXhpc3RpbmdJdGVtIiwiaXRlbSIsInRvU3RyaW5nIiwiRGF0ZSIsInB1c2giLCJyZW1vdmVGcm9tQ2FydCIsImZpbHRlciIsInVwZGF0ZUNhcnRJdGVtIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0NvbnRyb2xsZXIvY2FydENvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcnQgZnJvbSBcIi4uL01vZGVsL0NhcnQuanNcIjtcclxuaW1wb3J0IFByb2R1Y3QgZnJvbSBcIi4uL01vZGVsL1Byb2R1Y3RzLmpzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q2FydCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgY2FydCA9IGF3YWl0IENhcnQuZmluZE9uZSh7IHVzZXJJZCB9KS5wb3B1bGF0ZShcIml0ZW1zLnByb2R1Y3RJZFwiKTtcclxuICAgIGlmICghY2FydCkge1xyXG4gICAgICByZXR1cm4gcmVzXHJcbiAgICAgICAgLnN0YXR1cyg0MDQpXHJcbiAgICAgICAgLmpzb24oeyAgbWVzc2FnZTogXCJHaeG7jyBow6BuZyBraMO0bmcgdOG7k24gdOG6oWlcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjYXJ0Lml0ZW1zLnNvcnQoKGEsIGIpID0+IGIuY3JlYXRlZEF0IC0gYS5jcmVhdGVkQXQpO1xyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgY2FydCB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkzhu5dpIGtoaSBs4bqleSBnaeG7jyBow6BuZzpcIiwgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJM4buXaSBzZXJ2ZXJcIiB9KTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY2xlYXJDYXJ0ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyB1c2VySWQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgY2FydCA9IGF3YWl0IENhcnQuZmluZE9uZSh7IHVzZXJJZCB9KTtcclxuXHJcbiAgICBpZiAoIWNhcnQpIHtcclxuICAgICAgcmV0dXJuIHJlc1xyXG4gICAgICAgIC5zdGF0dXMoNDA0KVxyXG4gICAgICAgIC5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiR2nhu48gaMOgbmcga2jDtG5nIHThu5NuIHThuqFpXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gWMOzYSB04bqldCBj4bqjIGPDoWMgaXRlbSB0cm9uZyBnaeG7jyBow6BuZ1xyXG4gICAgY2FydC5pdGVtcyA9IFtdO1xyXG4gICAgYXdhaXQgY2FydC5zYXZlKCk7XHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBtZXNzYWdlOiBcIsSQw6MgeMOzYSB04bqldCBj4bqjIHPhuqNuIHBo4bqpbSBraOG7j2kgZ2nhu48gaMOgbmdcIixcclxuICAgICAgY2FydCxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiTOG7l2kga2hpIHjDs2EgdG/DoG4gYuG7mSBnaeG7jyBow6BuZzpcIiwgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJM4buXaSBzZXJ2ZXJcIiB9KTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgYWRkVG9DYXJ0ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyB1c2VySWQsIHByb2R1Y3RJZCwgcXVhbnRpdHksIHVuaXQsIHVuaXRQcmljZSwgY29udmVyc2lvblJhdGUgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAvLyBLaeG7g20gdHJhIHVzZXJJZFxyXG4gIGlmICghdXNlcklkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgbWVzc2FnZTogXCJ1c2VySWQgbMOgIGLhuq90IGJ14buZY1wiXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIEtp4buDbSB0cmEgcHJvZHVjdElkXHJcbiAgaWYgKCFwcm9kdWN0SWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBtZXNzYWdlOiBcInByb2R1Y3RJZCBsw6AgYuG6r3QgYnXhu5ljXCJcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGxldCBjYXJ0ID0gYXdhaXQgQ2FydC5maW5kT25lKHsgdXNlcklkIH0pO1xyXG4gICAgXHJcbiAgICAvLyBM4bqleSB0aMO0bmcgdGluIHPhuqNuIHBo4bqpbSDEkeG7gyBjw7MgZ2nDoSBjaMOtbmggeMOhY1xyXG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQocHJvZHVjdElkKTtcclxuICAgIFxyXG4gICAgaWYgKCFwcm9kdWN0KSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogXCJT4bqjbiBwaOG6qW0ga2jDtG5nIHThu5NuIHThuqFpXCJcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFjDoWMgxJHhu4tuaCDEkcahbiB24buLIHbDoCBnacOhXHJcbiAgICBsZXQgc2VsZWN0ZWRVbml0ID0gdW5pdCB8fCBwcm9kdWN0LnByb2R1Y3RVbml0O1xyXG4gICAgbGV0IHNlbGVjdGVkUHJpY2UgPSB1bml0UHJpY2U7XHJcbiAgICBsZXQgc2VsZWN0ZWRDb252ZXJzaW9uUmF0ZSA9IGNvbnZlcnNpb25SYXRlIHx8IDE7XHJcbiAgICBcclxuICAgIC8vIE7hur91IGtow7RuZyBjw7MgZ2nDoSDEkcaw4bujYyBjaOG7iSDEkeG7i25oLCBz4butIGThu6VuZyBnacOhIG3hurdjIMSR4buLbmggdOG7qyBz4bqjbiBwaOG6qW1cclxuICAgIGlmICghc2VsZWN0ZWRQcmljZSkge1xyXG4gICAgICAvLyBLaeG7g20gdHJhIMSRxqFuIHbhu4sgdHJvbmcgdW5pdE9wdGlvbnNcclxuICAgICAgaWYgKHByb2R1Y3QudW5pdE9wdGlvbnMgJiYgcHJvZHVjdC51bml0T3B0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgdW5pdE9wdGlvbiA9IHByb2R1Y3QudW5pdE9wdGlvbnMuZmluZChvcHQgPT4gb3B0LnVuaXQgPT09IHNlbGVjdGVkVW5pdCk7XHJcbiAgICAgICAgaWYgKHVuaXRPcHRpb24pIHtcclxuICAgICAgICAgIHNlbGVjdGVkUHJpY2UgPSB1bml0T3B0aW9uLnByaWNlO1xyXG4gICAgICAgICAgc2VsZWN0ZWRDb252ZXJzaW9uUmF0ZSA9IHVuaXRPcHRpb24uY29udmVyc2lvblJhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXksIHPhu60gZOG7pW5nIGdpw6Egc+G6o24gcGjhuqltIG3hurdjIMSR4buLbmhcclxuICAgICAgaWYgKCFzZWxlY3RlZFByaWNlKSB7XHJcbiAgICAgICAgc2VsZWN0ZWRQcmljZSA9IHByb2R1Y3QucHJvZHVjdERpc2NvdW50ID4gMFxyXG4gICAgICAgICAgPyBwcm9kdWN0LnByb2R1Y3RQcm9tb1ByaWNlXHJcbiAgICAgICAgICA6IHByb2R1Y3QucHJvZHVjdFByaWNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFTDrW5oIGdpw6EgY8OzIHTDrW5oIMSR4bq/biBnaeG6o20gZ2nDoVxyXG4gICAgY29uc3QgZmluYWxQcmljZSA9IHByb2R1Y3QucHJvZHVjdERpc2NvdW50ID4gMFxyXG4gICAgICA/IHNlbGVjdGVkUHJpY2UgLSAoc2VsZWN0ZWRQcmljZSAqIHByb2R1Y3QucHJvZHVjdERpc2NvdW50IC8gMTAwKVxyXG4gICAgICA6IHNlbGVjdGVkUHJpY2U7XHJcblxyXG4gICAgaWYgKCFjYXJ0KSB7XHJcbiAgICAgIGNhcnQgPSBuZXcgQ2FydCh7IHVzZXJJZCwgaXRlbXM6IFtdIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFTDrG0gaXRlbSDEkcOjIHThu5NuIHThuqFpIHbhu5tpIGPDuW5nIHPhuqNuIHBo4bqpbSBWw4AgY8O5bmcgxJHGoW4gduG7iyDEkW9cclxuICAgIGNvbnN0IGV4aXN0aW5nSXRlbSA9IGNhcnQuaXRlbXMuZmluZChcclxuICAgICAgKGl0ZW0pID0+IGl0ZW0ucHJvZHVjdElkLnRvU3RyaW5nKCkgPT09IHByb2R1Y3RJZCAmJiBpdGVtLnVuaXQgPT09IHNlbGVjdGVkVW5pdFxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XHJcbiAgICAgIGV4aXN0aW5nSXRlbS5xdWFudGl0eSArPSBxdWFudGl0eTtcclxuICAgICAgZXhpc3RpbmdJdGVtLnByaWNlID0gZmluYWxQcmljZTtcclxuICAgICAgZXhpc3RpbmdJdGVtLnVuaXRQcmljZSA9IHNlbGVjdGVkUHJpY2U7XHJcbiAgICAgIGV4aXN0aW5nSXRlbS5jb252ZXJzaW9uUmF0ZSA9IHNlbGVjdGVkQ29udmVyc2lvblJhdGU7XHJcbiAgICAgIGV4aXN0aW5nSXRlbS5jcmVhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2FydC5pdGVtcy5wdXNoKHtcclxuICAgICAgICBwcm9kdWN0SWQsXHJcbiAgICAgICAgcXVhbnRpdHksXHJcbiAgICAgICAgcHJpY2U6IGZpbmFsUHJpY2UsXHJcbiAgICAgICAgdW5pdDogc2VsZWN0ZWRVbml0LFxyXG4gICAgICAgIHVuaXRQcmljZTogc2VsZWN0ZWRQcmljZSxcclxuICAgICAgICBjb252ZXJzaW9uUmF0ZTogc2VsZWN0ZWRDb252ZXJzaW9uUmF0ZSxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IGNhcnQuc2F2ZSgpO1xyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogXCJT4bqjbiBwaOG6qW0gxJHDoyDEkcaw4bujYyB0aMOqbSB2w6BvIGdp4buPIGjDoG5nXCIsXHJcbiAgICAgIGNhcnQsXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkzhu5dpIGtoaSB0aMOqbSB2w6BvIGdp4buPIGjDoG5nOlwiLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlclwiIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZW1vdmVGcm9tQ2FydCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGNvbnN0IHsgdXNlcklkLCBwcm9kdWN0SWQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgY2FydCA9IGF3YWl0IENhcnQuZmluZE9uZSh7IHVzZXJJZCB9KTtcclxuXHJcbiAgICBpZiAoIWNhcnQpIHtcclxuICAgICAgcmV0dXJuIHJlc1xyXG4gICAgICAgIC5zdGF0dXMoNDA0KVxyXG4gICAgICAgIC5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiR2nhu48gaMOgbmcga2jDtG5nIHThu5NuIHThuqFpXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FydC5pdGVtcyA9IGNhcnQuaXRlbXMuZmlsdGVyKFxyXG4gICAgICAoaXRlbSkgPT4gaXRlbS5wcm9kdWN0SWQudG9TdHJpbmcoKSAhPT0gcHJvZHVjdElkXHJcbiAgICApO1xyXG5cclxuICAgIGF3YWl0IGNhcnQuc2F2ZSgpO1xyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogXCJT4bqjbiBwaOG6qW0gxJHDoyDEkcaw4bujYyB4w7NhIGto4buPaSBnaeG7jyBow6BuZ1wiLFxyXG4gICAgICBjYXJ0LFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJM4buXaSBraGkgeMOzYSBz4bqjbiBwaOG6qW0ga2jhu49pIGdp4buPIGjDoG5nOlwiLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlclwiIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB1cGRhdGVDYXJ0SXRlbSA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGNvbnN0IHsgdXNlcklkLCBwcm9kdWN0SWQsIHF1YW50aXR5LCB1bml0LCB1bml0UHJpY2UsIGNvbnZlcnNpb25SYXRlIH0gPSByZXEuYm9keTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNhcnQgPSBhd2FpdCBDYXJ0LmZpbmRPbmUoeyB1c2VySWQgfSk7XHJcblxyXG4gICAgaWYgKCFjYXJ0KSB7XHJcbiAgICAgIHJldHVybiByZXNcclxuICAgICAgICAuc3RhdHVzKDQwNClcclxuICAgICAgICAuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkdp4buPIGjDoG5nIGtow7RuZyB04buTbiB04bqhaVwiIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFTDrG0gc+G6o24gcGjhuqltIHRyb25nIGdp4buPIGjDoG5nIHRoZW8gSUQgdsOgIMSRxqFuIHbhu4sgKG7hur91IMSRxrDhu6NjIGNo4buJIMSR4buLbmgpXHJcbiAgICBsZXQgZXhpc3RpbmdJdGVtO1xyXG4gICAgXHJcbiAgICBpZiAodW5pdCkge1xyXG4gICAgICAvLyBUw6xtIHRoZW8gcHJvZHVjdElkIHbDoCB1bml0XHJcbiAgICAgIGV4aXN0aW5nSXRlbSA9IGNhcnQuaXRlbXMuZmluZChcclxuICAgICAgICAoaXRlbSkgPT4gaXRlbS5wcm9kdWN0SWQudG9TdHJpbmcoKSA9PT0gcHJvZHVjdElkICYmIGl0ZW0udW5pdCA9PT0gdW5pdFxyXG4gICAgICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gVMOsbSBjaOG7iSB0aGVvIHByb2R1Y3RJZFxyXG4gICAgICBleGlzdGluZ0l0ZW0gPSBjYXJ0Lml0ZW1zLmZpbmQoXHJcbiAgICAgICAgKGl0ZW0pID0+IGl0ZW0ucHJvZHVjdElkLnRvU3RyaW5nKCkgPT09IHByb2R1Y3RJZFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZXhpc3RpbmdJdGVtKSB7XHJcbiAgICAgIHJldHVybiByZXNcclxuICAgICAgICAuc3RhdHVzKDQwNClcclxuICAgICAgICAuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIG1lc3NhZ2U6IFwiU+G6o24gcGjhuqltIGtow7RuZyB04buTbiB04bqhaSB0cm9uZyBnaeG7jyBow6BuZ1wiLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEPhuq1wIG5o4bqtdCBz4buRIGzGsOG7o25nXHJcbiAgICBpZiAocXVhbnRpdHkpIHtcclxuICAgICAgZXhpc3RpbmdJdGVtLnF1YW50aXR5ID0gcXVhbnRpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ+G6rXAgbmjhuq10IMSRxqFuIHbhu4sgxJFvIG7hur91IMSRxrDhu6NjIGNo4buJIMSR4buLbmhcclxuICAgIGlmICh1bml0KSB7XHJcbiAgICAgIGV4aXN0aW5nSXRlbS51bml0ID0gdW5pdDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBD4bqtcCBuaOG6rXQgZ2nDoSDEkcahbiB24buLIG7hur91IMSRxrDhu6NjIGNo4buJIMSR4buLbmhcclxuICAgIGlmICh1bml0UHJpY2UpIHtcclxuICAgICAgZXhpc3RpbmdJdGVtLnVuaXRQcmljZSA9IHVuaXRQcmljZTtcclxuICAgICAgLy8gQ+G6rXAgbmjhuq10IGdpw6EgdOG7lW5nXHJcbiAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHByb2R1Y3RJZCk7XHJcbiAgICAgIGNvbnN0IGZpbmFsUHJpY2UgPSBwcm9kdWN0LnByb2R1Y3REaXNjb3VudCA+IDBcclxuICAgICAgICA/IHVuaXRQcmljZSAtICh1bml0UHJpY2UgKiBwcm9kdWN0LnByb2R1Y3REaXNjb3VudCAvIDEwMClcclxuICAgICAgICA6IHVuaXRQcmljZTtcclxuICAgICAgZXhpc3RpbmdJdGVtLnByaWNlID0gZmluYWxQcmljZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBD4bqtcCBuaOG6rXQgdOG7tyBs4buHIGNodXnhu4NuIMSR4buVaSBu4bq/dSDEkcaw4bujYyBjaOG7iSDEkeG7i25oXHJcbiAgICBpZiAoY29udmVyc2lvblJhdGUpIHtcclxuICAgICAgZXhpc3RpbmdJdGVtLmNvbnZlcnNpb25SYXRlID0gY29udmVyc2lvblJhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgZXhpc3RpbmdJdGVtLmNyZWF0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICBhd2FpdCBjYXJ0LnNhdmUoKTtcclxuXHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIG1lc3NhZ2U6IFwiU+G6o24gcGjhuqltIMSRw6MgxJHGsOG7o2MgY+G6rXAgbmjhuq10XCIsXHJcbiAgICAgIGNhcnQsXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkzhu5dpIGtoaSBj4bqtcCBuaOG6rXQgc+G6o24gcGjhuqltOlwiLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlclwiIH0pO1xyXG4gIH1cclxufTtcclxuIl0sIm1hcHBpbmdzIjoibVJBQUEsSUFBQUEsS0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBOztBQUVPLE1BQU1FLE9BQU8sR0FBRyxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUN6QyxNQUFNLEVBQUVDLE1BQU0sQ0FBQyxDQUFDLEdBQUdGLEdBQUcsQ0FBQ0csTUFBTTs7RUFFN0IsSUFBSTtJQUNGLE1BQU1DLElBQUksR0FBRyxNQUFNQyxh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