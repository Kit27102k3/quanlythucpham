"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.sendMessage = exports.markAllAsRead = exports.getUnreadCount = exports.getMessagesByUserId = exports.getAllContacts = void 0;var _Message = _interopRequireDefault(require("../Model/Message.js"));
var _Register = _interopRequireDefault(require("../Model/Register.js"));
var _adminModel = _interopRequireDefault(require("../Model/adminModel.js"));
var _admin = require("../config/admin.js");
var _dotenv = _interopRequireDefault(require("dotenv"));
var _notificationService = require("../Services/notificationService.js");

_dotenv.default.config();

const ADMIN_SECRET_TOKEN = "admin-token-for-TKhiem";

const getAllContacts = async (req, res) => {
  try {
    const conversations = await _Message.default.find().sort({ lastUpdated: -1 });
    const userIds = conversations.map((conv) => conv.userId);
    const users = await _Register.default.find({ _id: { $in: userIds } });
    const adminIds = conversations.
    map((conv) => conv.adminId).
    filter((id) => id !== null);
    const admins = await _adminModel.default.find({ _id: { $in: adminIds } });

    const contacts = conversations.map((conv) => {
      const user = users.find(
        (u) => u._id.toString() === conv.userId.toString()
      );
      const admin = admins.find(
        (a) => a && conv.adminId && a._id.toString() === conv.adminId.toString()
      );
      const lastMessage =
      conv.messages.length > 0 ?
      conv.messages[conv.messages.length - 1] :
      null;

      return {
        id: user && user._id ? user._id.toString() : conv.userId.toString(),
        name:
        user && user.firstName ?
        `${user.firstName} ${user.lastName}` :
        "Người dùng",
        avatar: user?.userImage || null,
        online: false,
        lastSeen: lastMessage ? formatTimeAgo(lastMessage.timestamp) : null,
        lastMessage: lastMessage?.text || "",
        unread: conv.messages.filter(
          (msg) => msg.sender === "user" && !msg.read
        ).length,
        adminName: admin?.fullName || "Admin",
        adminId: conv.adminId?.toString()
      };
    });

    return res.status(200).json(contacts);
  } catch (error) {
    return res.status(500).json({ message: "Lỗi server: " + error.message });
  }
};exports.getAllContacts = getAllContacts;

const getMessagesByUserId = async (req, res) => {
  try {
    const { userId } = req.params;

    const isAdmin =
    req.headers["admin-token"] === ADMIN_SECRET_TOKEN ||
    req.user && (req.user.role === "admin" || req.user.role === "manager");

    let actualUserId = userId;
    if (userId === "admin") {
      actualUserId = await (0, _admin.getAdminId)();
    }

    let conversation;
    if (isAdmin) {
      conversation = await _Message.default.findOne({ userId: actualUserId });
    } else {
      const currentUserId = req.user ? req.user.id : actualUserId;
      conversation = await _Message.default.findOne({ userId: currentUserId });
    }

    if (!conversation) {
      return res.status(200).json([]);
    }

    const formattedMessages = conversation.messages.map((msg) => ({
      id: msg._id.toString(),
      text: msg.text,
      sender: msg.sender,
      read: msg.read,
      createdAt: msg.timestamp
    }));

    return res.status(200).json(formattedMessages);
  } catch (error) {
    return res.status(500).json({ message: "Lỗi server: " + error.message });
  }
};exports.getMessagesByUserId = getMessagesByUserId;

const sendMessage = async (req, res) => {
  try {
    const { text, sender, receiverId, userId: requestUserId } = req.body;

    if (!text || !sender) {
      return res.status(400).json({ message: "Thiếu thông tin tin nhắn" });
    }

    const isAdmin =
    req.headers["admin-token"] === ADMIN_SECRET_TOKEN ||
    req.user && (req.user.role === "admin" || req.user.role === "manager");

    if (sender === "admin" && !isAdmin) {
      return res.
      status(403).
      json({ message: "Không có quyền gửi tin nhắn với tư cách admin" });
    }

    let userId =
    sender === "admin" ? receiverId : requestUserId || req.user?.id;
    if (!userId) {
      return res.
      status(400).
      json({ message: "Không xác định được người nhận tin nhắn" });
    }

    const adminId = await (0, _admin.getAdminId)();
    let conversation = await _Message.default.findOne({ userId });

    if (!conversation) {
      conversation = new _Message.default({
        userId,
        adminId,
        messages: [],
        unreadCount: 0
      });
    }

    const newMessage = {
      text,
      sender,
      read: false,
      timestamp: new Date()
    };

    conversation.messages.push(newMessage);

    if (sender === "user") {
      conversation.unreadCount = (conversation.unreadCount || 0) + 1;
    }

    await conversation.save();

    const addedMessage =
    conversation.messages[conversation.messages.length - 1];

    const formattedMessage = {
      id: addedMessage._id.toString(),
      text: addedMessage.text,
      sender: addedMessage.sender,
      read: addedMessage.read,
      createdAt: addedMessage.timestamp
    };

    if (sender === "admin") {
      try {
        const user = await _Register.default.findById(userId);
        if (user) {
          (0, _notificationService.sendMessageNotification)(userId, "Admin", text).catch(() => {});
        }
      } catch (error) {
        console.error("Error sending notification:", error);
      }
    }

    return res.status(201).json(formattedMessage);
  } catch (error) {
    return res.status(500).json({ message: "Lỗi server: " + error.message });
  }
};exports.sendMessage = sendMessage;

const markAllAsRead = async (req, res) => {
  try {
    const { userId } = req.params;
    const conversation = await _Message.default.findOne({ userId });

    if (!conversation) {
      return res.status(404).json({ message: "Không tìm thấy cuộc hội thoại" });
    }

    let updated = false;
    conversation.messages = conversation.messages.map((msg) => {
      if (msg.sender === "admin" && !msg.read) {
        updated = true;
        return { ...msg.toObject(), read: true };
      }
      return msg;
    });

    if (updated) {
      conversation.unreadCount = 0;
      await conversation.save();
    }

    return res.status(200).json({ success: true });
  } catch (error) {
    return res.status(500).json({ message: "Lỗi server: " + error.message });
  }
};exports.markAllAsRead = markAllAsRead;

const getUnreadCount = async (req, res) => {
  try {
    const isAdmin = req.headers["admin-token"] === ADMIN_SECRET_TOKEN;
    if (!isAdmin) {
      return res.status(403).json({ message: "Không có quyền truy cập" });
    }

    const conversations = await _Message.default.find();
    const totalUnread = conversations.reduce(
      (sum, conv) => sum + (conv.unreadCount || 0),
      0
    );

    return res.status(200).json({ count: totalUnread });
  } catch (error) {
    return res.status(500).json({ message: "Lỗi server: " + error.message });
  }
};exports.getUnreadCount = getUnreadCount;

function formatTimeAgo(date) {
  const now = new Date();
  const diff = Math.floor((now - date) / 1000);

  if (diff < 60) return "Vừa xong";
  if (diff < 3600) return `${Math.floor(diff / 60)} phút trước`;
  if (diff < 86400) return `${Math.floor(diff / 3600)} giờ trước`;

  return new Date(date).toLocaleDateString("vi-VN");
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfTWVzc2FnZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX1JlZ2lzdGVyIiwiX2FkbWluTW9kZWwiLCJfYWRtaW4iLCJfZG90ZW52IiwiX25vdGlmaWNhdGlvblNlcnZpY2UiLCJkb3RlbnYiLCJjb25maWciLCJBRE1JTl9TRUNSRVRfVE9LRU4iLCJnZXRBbGxDb250YWN0cyIsInJlcSIsInJlcyIsImNvbnZlcnNhdGlvbnMiLCJDb252ZXJzYXRpb24iLCJmaW5kIiwic29ydCIsImxhc3RVcGRhdGVkIiwidXNlcklkcyIsIm1hcCIsImNvbnYiLCJ1c2VySWQiLCJ1c2VycyIsIlVzZXIiLCJfaWQiLCIkaW4iLCJhZG1pbklkcyIsImFkbWluSWQiLCJmaWx0ZXIiLCJpZCIsImFkbWlucyIsIkFkbWluIiwiY29udGFjdHMiLCJ1c2VyIiwidSIsInRvU3RyaW5nIiwiYWRtaW4iLCJhIiwibGFzdE1lc3NhZ2UiLCJtZXNzYWdlcyIsImxlbmd0aCIsIm5hbWUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImF2YXRhciIsInVzZXJJbWFnZSIsIm9ubGluZSIsImxhc3RTZWVuIiwiZm9ybWF0VGltZUFnbyIsInRpbWVzdGFtcCIsInRleHQiLCJ1bnJlYWQiLCJtc2ciLCJzZW5kZXIiLCJyZWFkIiwiYWRtaW5OYW1lIiwiZnVsbE5hbWUiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwiZXhwb3J0cyIsImdldE1lc3NhZ2VzQnlVc2VySWQiLCJwYXJhbXMiLCJpc0FkbWluIiwiaGVhZGVycyIsInJvbGUiLCJhY3R1YWxVc2VySWQiLCJnZXRBZG1pbklkIiwiY29udmVyc2F0aW9uIiwiZmluZE9uZSIsImN1cnJlbnRVc2VySWQiLCJmb3JtYXR0ZWRNZXNzYWdlcyIsImNyZWF0ZWRBdCIsInNlbmRNZXNzYWdlIiwicmVjZWl2ZXJJZCIsInJlcXVlc3RVc2VySWQiLCJib2R5IiwidW5yZWFkQ291bnQiLCJuZXdNZXNzYWdlIiwiRGF0ZSIsInB1c2giLCJzYXZlIiwiYWRkZWRNZXNzYWdlIiwiZm9ybWF0dGVkTWVzc2FnZSIsImZpbmRCeUlkIiwic2VuZE1lc3NhZ2VOb3RpZmljYXRpb24iLCJjYXRjaCIsImNvbnNvbGUiLCJtYXJrQWxsQXNSZWFkIiwidXBkYXRlZCIsInRvT2JqZWN0Iiwic3VjY2VzcyIsImdldFVucmVhZENvdW50IiwidG90YWxVbnJlYWQiLCJyZWR1Y2UiLCJzdW0iLCJjb3VudCIsImRhdGUiLCJub3ciLCJkaWZmIiwiTWF0aCIsImZsb29yIiwidG9Mb2NhbGVEYXRlU3RyaW5nIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0NvbnRyb2xsZXIvbWVzc2FnZUNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbnZlcnNhdGlvbiBmcm9tIFwiLi4vTW9kZWwvTWVzc2FnZS5qc1wiO1xyXG5pbXBvcnQgVXNlciBmcm9tIFwiLi4vTW9kZWwvUmVnaXN0ZXIuanNcIjtcclxuaW1wb3J0IEFkbWluIGZyb20gXCIuLi9Nb2RlbC9hZG1pbk1vZGVsLmpzXCI7XHJcbmltcG9ydCB7IGdldEFkbWluSWQgfSBmcm9tIFwiLi4vY29uZmlnL2FkbWluLmpzXCI7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5pbXBvcnQgeyBzZW5kTWVzc2FnZU5vdGlmaWNhdGlvbiB9IGZyb20gXCIuLi9TZXJ2aWNlcy9ub3RpZmljYXRpb25TZXJ2aWNlLmpzXCI7XHJcblxyXG5kb3RlbnYuY29uZmlnKCk7XHJcblxyXG5jb25zdCBBRE1JTl9TRUNSRVRfVE9LRU4gPSBcImFkbWluLXRva2VuLWZvci1US2hpZW1cIjtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRBbGxDb250YWN0cyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjb252ZXJzYXRpb25zID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmQoKS5zb3J0KHsgbGFzdFVwZGF0ZWQ6IC0xIH0pO1xyXG4gICAgY29uc3QgdXNlcklkcyA9IGNvbnZlcnNhdGlvbnMubWFwKChjb252KSA9PiBjb252LnVzZXJJZCk7XHJcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IFVzZXIuZmluZCh7IF9pZDogeyAkaW46IHVzZXJJZHMgfSB9KTtcclxuICAgIGNvbnN0IGFkbWluSWRzID0gY29udmVyc2F0aW9uc1xyXG4gICAgICAubWFwKChjb252KSA9PiBjb252LmFkbWluSWQpXHJcbiAgICAgIC5maWx0ZXIoKGlkKSA9PiBpZCAhPT0gbnVsbCk7XHJcbiAgICBjb25zdCBhZG1pbnMgPSBhd2FpdCBBZG1pbi5maW5kKHsgX2lkOiB7ICRpbjogYWRtaW5JZHMgfSB9KTtcclxuXHJcbiAgICBjb25zdCBjb250YWN0cyA9IGNvbnZlcnNhdGlvbnMubWFwKChjb252KSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSB1c2Vycy5maW5kKFxyXG4gICAgICAgICh1KSA9PiB1Ll9pZC50b1N0cmluZygpID09PSBjb252LnVzZXJJZC50b1N0cmluZygpXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IGFkbWluID0gYWRtaW5zLmZpbmQoXHJcbiAgICAgICAgKGEpID0+IGEgJiYgY29udi5hZG1pbklkICYmIGEuX2lkLnRvU3RyaW5nKCkgPT09IGNvbnYuYWRtaW5JZC50b1N0cmluZygpXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID1cclxuICAgICAgICBjb252Lm1lc3NhZ2VzLmxlbmd0aCA+IDBcclxuICAgICAgICAgID8gY29udi5tZXNzYWdlc1tjb252Lm1lc3NhZ2VzLmxlbmd0aCAtIDFdXHJcbiAgICAgICAgICA6IG51bGw7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlkOiB1c2VyICYmIHVzZXIuX2lkID8gdXNlci5faWQudG9TdHJpbmcoKSA6IGNvbnYudXNlcklkLnRvU3RyaW5nKCksXHJcbiAgICAgICAgbmFtZTpcclxuICAgICAgICAgIHVzZXIgJiYgdXNlci5maXJzdE5hbWVcclxuICAgICAgICAgICAgPyBgJHt1c2VyLmZpcnN0TmFtZX0gJHt1c2VyLmxhc3ROYW1lfWBcclxuICAgICAgICAgICAgOiBcIk5nxrDhu51pIGTDuW5nXCIsXHJcbiAgICAgICAgYXZhdGFyOiB1c2VyPy51c2VySW1hZ2UgfHwgbnVsbCxcclxuICAgICAgICBvbmxpbmU6IGZhbHNlLFxyXG4gICAgICAgIGxhc3RTZWVuOiBsYXN0TWVzc2FnZSA/IGZvcm1hdFRpbWVBZ28obGFzdE1lc3NhZ2UudGltZXN0YW1wKSA6IG51bGwsXHJcbiAgICAgICAgbGFzdE1lc3NhZ2U6IGxhc3RNZXNzYWdlPy50ZXh0IHx8IFwiXCIsXHJcbiAgICAgICAgdW5yZWFkOiBjb252Lm1lc3NhZ2VzLmZpbHRlcihcclxuICAgICAgICAgIChtc2cpID0+IG1zZy5zZW5kZXIgPT09IFwidXNlclwiICYmICFtc2cucmVhZFxyXG4gICAgICAgICkubGVuZ3RoLFxyXG4gICAgICAgIGFkbWluTmFtZTogYWRtaW4/LmZ1bGxOYW1lIHx8IFwiQWRtaW5cIixcclxuICAgICAgICBhZG1pbklkOiBjb252LmFkbWluSWQ/LnRvU3RyaW5nKCksXHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oY29udGFjdHMpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlcjogXCIgKyBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRNZXNzYWdlc0J5VXNlcklkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgIGNvbnN0IGlzQWRtaW4gPVxyXG4gICAgICByZXEuaGVhZGVyc1tcImFkbWluLXRva2VuXCJdID09PSBBRE1JTl9TRUNSRVRfVE9LRU4gfHxcclxuICAgICAgKHJlcS51c2VyICYmIChyZXEudXNlci5yb2xlID09PSBcImFkbWluXCIgfHwgcmVxLnVzZXIucm9sZSA9PT0gXCJtYW5hZ2VyXCIpKTtcclxuXHJcbiAgICBsZXQgYWN0dWFsVXNlcklkID0gdXNlcklkO1xyXG4gICAgaWYgKHVzZXJJZCA9PT0gXCJhZG1pblwiKSB7XHJcbiAgICAgIGFjdHVhbFVzZXJJZCA9IGF3YWl0IGdldEFkbWluSWQoKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29udmVyc2F0aW9uO1xyXG4gICAgaWYgKGlzQWRtaW4pIHtcclxuICAgICAgY29udmVyc2F0aW9uID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmRPbmUoeyB1c2VySWQ6IGFjdHVhbFVzZXJJZCB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VySWQgPSByZXEudXNlciA/IHJlcS51c2VyLmlkIDogYWN0dWFsVXNlcklkO1xyXG4gICAgICBjb252ZXJzYXRpb24gPSBhd2FpdCBDb252ZXJzYXRpb24uZmluZE9uZSh7IHVzZXJJZDogY3VycmVudFVzZXJJZCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWNvbnZlcnNhdGlvbikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oW10pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2VzID0gY29udmVyc2F0aW9uLm1lc3NhZ2VzLm1hcCgobXNnKSA9PiAoe1xyXG4gICAgICBpZDogbXNnLl9pZC50b1N0cmluZygpLFxyXG4gICAgICB0ZXh0OiBtc2cudGV4dCxcclxuICAgICAgc2VuZGVyOiBtc2cuc2VuZGVyLFxyXG4gICAgICByZWFkOiBtc2cucmVhZCxcclxuICAgICAgY3JlYXRlZEF0OiBtc2cudGltZXN0YW1wLFxyXG4gICAgfSkpO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihmb3JtYXR0ZWRNZXNzYWdlcyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IFwiTOG7l2kgc2VydmVyOiBcIiArIGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdGV4dCwgc2VuZGVyLCByZWNlaXZlcklkLCB1c2VySWQ6IHJlcXVlc3RVc2VySWQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGlmICghdGV4dCB8fCAhc2VuZGVyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IFwiVGhp4bq/dSB0aMO0bmcgdGluIHRpbiBuaOG6r25cIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpc0FkbWluID1cclxuICAgICAgcmVxLmhlYWRlcnNbXCJhZG1pbi10b2tlblwiXSA9PT0gQURNSU5fU0VDUkVUX1RPS0VOIHx8XHJcbiAgICAgIChyZXEudXNlciAmJiAocmVxLnVzZXIucm9sZSA9PT0gXCJhZG1pblwiIHx8IHJlcS51c2VyLnJvbGUgPT09IFwibWFuYWdlclwiKSk7XHJcblxyXG4gICAgaWYgKHNlbmRlciA9PT0gXCJhZG1pblwiICYmICFpc0FkbWluKSB7XHJcbiAgICAgIHJldHVybiByZXNcclxuICAgICAgICAuc3RhdHVzKDQwMylcclxuICAgICAgICAuanNvbih7IG1lc3NhZ2U6IFwiS2jDtG5nIGPDsyBxdXnhu4FuIGfhu61pIHRpbiBuaOG6r24gduG7m2kgdMawIGPDoWNoIGFkbWluXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHVzZXJJZCA9XHJcbiAgICAgIHNlbmRlciA9PT0gXCJhZG1pblwiID8gcmVjZWl2ZXJJZCA6IHJlcXVlc3RVc2VySWQgfHwgcmVxLnVzZXI/LmlkO1xyXG4gICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgcmV0dXJuIHJlc1xyXG4gICAgICAgIC5zdGF0dXMoNDAwKVxyXG4gICAgICAgIC5qc29uKHsgbWVzc2FnZTogXCJLaMO0bmcgeMOhYyDEkeG7i25oIMSRxrDhu6NjIG5nxrDhu51pIG5o4bqtbiB0aW4gbmjhuq9uXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWRtaW5JZCA9IGF3YWl0IGdldEFkbWluSWQoKTtcclxuICAgIGxldCBjb252ZXJzYXRpb24gPSBhd2FpdCBDb252ZXJzYXRpb24uZmluZE9uZSh7IHVzZXJJZCB9KTtcclxuXHJcbiAgICBpZiAoIWNvbnZlcnNhdGlvbikge1xyXG4gICAgICBjb252ZXJzYXRpb24gPSBuZXcgQ29udmVyc2F0aW9uKHtcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgYWRtaW5JZCxcclxuICAgICAgICBtZXNzYWdlczogW10sXHJcbiAgICAgICAgdW5yZWFkQ291bnQ6IDAsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5ld01lc3NhZ2UgPSB7XHJcbiAgICAgIHRleHQsXHJcbiAgICAgIHNlbmRlcixcclxuICAgICAgcmVhZDogZmFsc2UsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgIH07XHJcblxyXG4gICAgY29udmVyc2F0aW9uLm1lc3NhZ2VzLnB1c2gobmV3TWVzc2FnZSk7XHJcblxyXG4gICAgaWYgKHNlbmRlciA9PT0gXCJ1c2VyXCIpIHtcclxuICAgICAgY29udmVyc2F0aW9uLnVucmVhZENvdW50ID0gKGNvbnZlcnNhdGlvbi51bnJlYWRDb3VudCB8fCAwKSArIDE7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgY29udmVyc2F0aW9uLnNhdmUoKTtcclxuXHJcbiAgICBjb25zdCBhZGRlZE1lc3NhZ2UgPVxyXG4gICAgICBjb252ZXJzYXRpb24ubWVzc2FnZXNbY29udmVyc2F0aW9uLm1lc3NhZ2VzLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB7XHJcbiAgICAgIGlkOiBhZGRlZE1lc3NhZ2UuX2lkLnRvU3RyaW5nKCksXHJcbiAgICAgIHRleHQ6IGFkZGVkTWVzc2FnZS50ZXh0LFxyXG4gICAgICBzZW5kZXI6IGFkZGVkTWVzc2FnZS5zZW5kZXIsXHJcbiAgICAgIHJlYWQ6IGFkZGVkTWVzc2FnZS5yZWFkLFxyXG4gICAgICBjcmVhdGVkQXQ6IGFkZGVkTWVzc2FnZS50aW1lc3RhbXAsXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChzZW5kZXIgPT09IFwiYWRtaW5cIikge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCk7XHJcbiAgICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAgIHNlbmRNZXNzYWdlTm90aWZpY2F0aW9uKHVzZXJJZCwgXCJBZG1pblwiLCB0ZXh0KS5jYXRjaCgoKSA9PiB7fSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG5vdGlmaWNhdGlvbjpcIiwgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKGZvcm1hdHRlZE1lc3NhZ2UpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlcjogXCIgKyBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBtYXJrQWxsQXNSZWFkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgY29udmVyc2F0aW9uID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmRPbmUoeyB1c2VySWQgfSk7XHJcblxyXG4gICAgaWYgKCFjb252ZXJzYXRpb24pIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogXCJLaMO0bmcgdMOsbSB0aOG6pXkgY3Xhu5ljIGjhu5lpIHRob+G6oWlcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgdXBkYXRlZCA9IGZhbHNlO1xyXG4gICAgY29udmVyc2F0aW9uLm1lc3NhZ2VzID0gY29udmVyc2F0aW9uLm1lc3NhZ2VzLm1hcCgobXNnKSA9PiB7XHJcbiAgICAgIGlmIChtc2cuc2VuZGVyID09PSBcImFkbWluXCIgJiYgIW1zZy5yZWFkKSB7XHJcbiAgICAgICAgdXBkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHsgLi4ubXNnLnRvT2JqZWN0KCksIHJlYWQ6IHRydWUgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbXNnO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZWQpIHtcclxuICAgICAgY29udmVyc2F0aW9uLnVucmVhZENvdW50ID0gMDtcclxuICAgICAgYXdhaXQgY29udmVyc2F0aW9uLnNhdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBcIkzhu5dpIHNlcnZlcjogXCIgKyBlcnJvci5tZXNzYWdlIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRVbnJlYWRDb3VudCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBpc0FkbWluID0gcmVxLmhlYWRlcnNbXCJhZG1pbi10b2tlblwiXSA9PT0gQURNSU5fU0VDUkVUX1RPS0VOO1xyXG4gICAgaWYgKCFpc0FkbWluKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6IFwiS2jDtG5nIGPDsyBxdXnhu4FuIHRydXkgY+G6rXBcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb252ZXJzYXRpb25zID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmQoKTtcclxuICAgIGNvbnN0IHRvdGFsVW5yZWFkID0gY29udmVyc2F0aW9ucy5yZWR1Y2UoXHJcbiAgICAgIChzdW0sIGNvbnYpID0+IHN1bSArIChjb252LnVucmVhZENvdW50IHx8IDApLFxyXG4gICAgICAwXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IGNvdW50OiB0b3RhbFVucmVhZCB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogXCJM4buXaSBzZXJ2ZXI6IFwiICsgZXJyb3IubWVzc2FnZSB9KTtcclxuICB9XHJcbn07XHJcblxyXG5mdW5jdGlvbiBmb3JtYXRUaW1lQWdvKGRhdGUpIHtcclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IGRpZmYgPSBNYXRoLmZsb29yKChub3cgLSBkYXRlKSAvIDEwMDApO1xyXG5cclxuICBpZiAoZGlmZiA8IDYwKSByZXR1cm4gXCJW4burYSB4b25nXCI7XHJcbiAgaWYgKGRpZmYgPCAzNjAwKSByZXR1cm4gYCR7TWF0aC5mbG9vcihkaWZmIC8gNjApfSBwaMO6dCB0csaw4bubY2A7XHJcbiAgaWYgKGRpZmYgPCA4NjQwMCkgcmV0dXJuIGAke01hdGguZmxvb3IoZGlmZiAvIDM2MDApfSBnaeG7nSB0csaw4bubY2A7XHJcblxyXG4gIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoXCJ2aS1WTlwiKTtcclxufVxyXG4iXSwibWFwcGluZ3MiOiJxU0FBQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFG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