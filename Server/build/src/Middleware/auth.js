"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.verifyToken = exports.checkRole = void 0;

var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };} /* eslint-disable no-unused-vars */ /* eslint-disable no-undef */

const verifyToken = (req, res, next) => {
  try {var _req$headers$authoriz;
    const token = (_req$headers$authoriz = req.headers.authorization) === null || _req$headers$authoriz === void 0 ? void 0 : _req$headers$authoriz.split(" ")[1];

    if (!token) {
      return res.status(401).json({ message: "Không tìm thấy token" });
    }

    const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ message: "Token không hợp lệ" });
  }
};exports.verifyToken = verifyToken;

const checkRole = (roles) => {
  return (req, res, next) => {
    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ message: "Bạn không có quyền truy cập" });
    }
    next();
  };
};exports.checkRole = checkRole;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfanNvbndlYnRva2VuIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJ2ZXJpZnlUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJfcmVxJGhlYWRlcnMkYXV0aG9yaXoiLCJ0b2tlbiIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3BsaXQiLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsImRlY29kZWQiLCJqd3QiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsInVzZXIiLCJlcnJvciIsImV4cG9ydHMiLCJjaGVja1JvbGUiLCJyb2xlcyIsImluY2x1ZGVzIiwicm9sZSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NaWRkbGV3YXJlL2F1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cclxuLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cclxuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcblxyXG5leHBvcnQgY29uc3QgdmVyaWZ5VG9rZW4gPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5zcGxpdChcIiBcIilbMV07XHJcbiAgICBcclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogXCJLaMO0bmcgdMOsbSB0aOG6pXkgdG9rZW5cIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcbiAgICByZXEudXNlciA9IGRlY29kZWQ7XHJcbiAgICBuZXh0KCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6IFwiVG9rZW4ga2jDtG5nIGjhu6NwIGzhu4dcIiB9KTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tSb2xlID0gKHJvbGVzKSA9PiB7XHJcbiAgcmV0dXJuIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgaWYgKCFyb2xlcy5pbmNsdWRlcyhyZXEudXNlci5yb2xlKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiBcIkLhuqFuIGtow7RuZyBjw7MgcXV54buBbiB0cnV5IGPhuq1wXCIgfSk7XHJcbiAgICB9XHJcbiAgICBuZXh0KCk7XHJcbiAgfTtcclxufTsgIl0sIm1hcHBpbmdzIjoiOztBQUVBLElBQUFBLGFBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQSxrQkFBK0IsU0FBQUQsdUJBQUFFLENBQUEsVUFBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUEsS0FGL0Isb0NBQ0E7O0FBR08sTUFBTUcsV0FBVyxHQUFHQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQzdDLElBQUksS0FBQUMscUJBQUE7SUFDRixNQUFNQyxLQUFLLElBQUFELHFCQUFBLEdBQUdILEdBQUcsQ0FBQ0ssT0FBTyxDQUFDQyxhQUFhLGNBQUFILHFCQUFBLHVCQUF6QkEscUJBQUEsQ0FBMkJJLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7O0lBRXRELElBQUksQ0FBQ0gsS0FBSyxFQUFFO01BQ1YsT0FBT0gsR0FBRyxDQUFDTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFQyxPQUFPLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO0lBQ2xFOztJQUVBLE1BQU1DLE9BQU8sR0FBR0MscUJBQUcsQ0FBQ0MsTUFBTSxDQUFDVCxLQUFLLEVBQUVVLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLENBQUM7SUFDekRoQixHQUFHLENBQUNpQixJQUFJLEdBQUdOLE9BQU87SUFDbEJULElBQUksQ0FBQyxDQUFDO0VBQ1IsQ0FBQyxDQUFDLE9BQU9nQixLQUFLLEVBQUU7SUFDZCxPQUFPakIsR0FBRyxDQUFDTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFQyxPQUFPLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0VBQ2hFO0FBQ0YsQ0FBQyxDQUFDUyxPQUFBLENBQUFwQixXQUFBLEdBQUFBLFdBQUE7O0FBRUssTUFBTXFCLFNBQVMsR0FBR0EsQ0FBQ0MsS0FBSyxLQUFLO0VBQ2xDLE9BQU8sQ0FBQ3JCLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7SUFDekIsSUFBSSxDQUFDbUIsS0FBSyxDQUFDQyxRQUFRLENBQUN0QixHQUFHLENBQUNpQixJQUFJLENBQUNNLElBQUksQ0FBQyxFQUFFO01BQ2xDLE9BQU90QixHQUFHLENBQUNPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUVDLE9BQU8sRUFBRSw2QkFBNkIsQ0FBQyxDQUFDLENBQUM7SUFDekU7SUFDQVIsSUFBSSxDQUFDLENBQUM7RUFDUixDQUFDO0FBQ0gsQ0FBQyxDQUFDaUIsT0FBQSxDQUFBQyxTQUFBLEdBQUFBLFNBQUEiLCJpZ25vcmVMaXN0IjpbXX0=