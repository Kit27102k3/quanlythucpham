"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.verifyToken = exports.checkRole = void 0;

var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken")); /* eslint-disable no-unused-vars */ /* eslint-disable no-undef */

const verifyToken = (req, res, next) => {
  try {
    const authHeader = req.headers.authorization;
    const token = authHeader && authHeader.split(" ")[1];

    if (!token) {
      return res.status(401).json({ message: "Không tìm thấy token" });
    }

    const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ message: "Token không hợp lệ" });
  }
};exports.verifyToken = verifyToken;

const checkRole = (roles) => {
  return (req, res, next) => {
    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ message: "Bạn không có quyền truy cập" });
    }
    next();
  };
};exports.checkRole = checkRole;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfanNvbndlYnRva2VuIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJ2ZXJpZnlUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJ0b2tlbiIsInNwbGl0Iiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJkZWNvZGVkIiwiand0IiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ1c2VyIiwiZXJyb3IiLCJleHBvcnRzIiwiY2hlY2tSb2xlIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvTWlkZGxld2FyZS9hdXRoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovXHJcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IHZlcmlmeVRva2VuID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyICYmIGF1dGhIZWFkZXIuc3BsaXQoXCIgXCIpWzFdO1xyXG4gICAgXHJcbiAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6IFwiS2jDtG5nIHTDrG0gdGjhuqV5IHRva2VuXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG4gICAgcmVxLnVzZXIgPSBkZWNvZGVkO1xyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiBcIlRva2VuIGtow7RuZyBo4bujcCBs4buHXCIgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNoZWNrUm9sZSA9IChyb2xlcykgPT4ge1xyXG4gIHJldHVybiAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGlmICghcm9sZXMuaW5jbHVkZXMocmVxLnVzZXIucm9sZSkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogXCJC4bqhbiBraMO0bmcgY8OzIHF1eeG7gW4gdHJ1eSBj4bqtcFwiIH0pO1xyXG4gICAgfVxyXG4gICAgbmV4dCgpO1xyXG4gIH07XHJcbn07ICJdLCJtYXBwaW5ncyI6Ijs7QUFFQSxJQUFBQSxhQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUEsa0JBQStCLENBRi9CLG9DQUNBOztBQUdPLE1BQU1DLFdBQVcsR0FBR0EsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUM3QyxJQUFJO0lBQ0YsTUFBTUMsVUFBVSxHQUFHSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYTtJQUM1QyxNQUFNQyxLQUFLLEdBQUdILFVBQVUsSUFBSUEsVUFBVSxDQUFDSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDOztJQUVwRCxJQUFJLENBQUNELEtBQUssRUFBRTtNQUNWLE9BQU9MLEdBQUcsQ0FBQ08sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsRUFBRUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsQ0FBQztJQUNsRTs7SUFFQSxNQUFNQyxPQUFPLEdBQUdDLHFCQUFHLENBQUNDLE1BQU0sQ0FBQ1AsS0FBSyxFQUFFUSxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxDQUFDO0lBQ3pEaEIsR0FBRyxDQUFDaUIsSUFBSSxHQUFHTixPQUFPO0lBQ2xCVCxJQUFJLENBQUMsQ0FBQztFQUNSLENBQUMsQ0FBQyxPQUFPZ0IsS0FBSyxFQUFFO0lBQ2QsT0FBT2pCLEdBQUcsQ0FBQ08sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsRUFBRUMsT0FBTyxFQUFFLG9CQUFvQixDQUFDLENBQUMsQ0FBQztFQUNoRTtBQUNGLENBQUMsQ0FBQ1MsT0FBQSxDQUFBcEIsV0FBQSxHQUFBQSxXQUFBOztBQUVLLE1BQU1xQixTQUFTLEdBQUdBLENBQUNDLEtBQUssS0FBSztFQUNsQyxPQUFPLENBQUNyQixHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0lBQ3pCLElBQUksQ0FBQ21CLEtBQUssQ0FBQ0MsUUFBUSxDQUFDdEIsR0FBRyxDQUFDaUIsSUFBSSxDQUFDTSxJQUFJLENBQUMsRUFBRTtNQUNsQyxPQUFPdEIsR0FBRyxDQUFDTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxFQUFFQyxPQUFPLEVBQUUsNkJBQTZCLENBQUMsQ0FBQyxDQUFDO0lBQ3pFO0lBQ0FSLElBQUksQ0FBQyxDQUFDO0VBQ1IsQ0FBQztBQUNILENBQUMsQ0FBQ2lCLE9BQUEsQ0FBQUMsU0FBQSxHQUFBQSxTQUFBIiwiaWdub3JlTGlzdCI6W119