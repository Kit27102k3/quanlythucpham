"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.verifyToken = exports.verifyAdmin = exports.isAdmin = void 0;
var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));
var _dotenv = _interopRequireDefault(require("dotenv")); // File: authMiddleware.js

// Khởi tạo biến môi trường
_dotenv.default.config();

/* eslint-disable no-undef */
// Khóa bí mật từ biến môi trường hoặc giá trị mặc định
const JWT_SECRET =
process.env.JWT_SECRET ||
process.env.JWT_SECRET_ACCESS ||
"QUANLYTHUCPHAM_MERN";
const ADMIN_SECRET_TOKEN = "admin-token-for-TKhiem";
/* eslint-enable no-undef */

const verifyToken = (req, res, next) => {
  // Kiểm tra nếu là một route không yêu cầu xác thực
  const publicRoutes = [
  '/api/products/best-sellers',
  '/api/products',
  '/api/categories'];


  // Kiểm tra nếu đây là route công khai
  if (publicRoutes.some((route) => req.originalUrl.includes(route) && req.method === 'GET')) {
    console.log(`[verifyToken] Bỏ qua xác thực cho route công khai: ${req.originalUrl}`);
    return next();
  }

  try {
    // Lấy token từ header hoặc cookie
    const authHeader = req.headers.authorization;
    const token = authHeader && authHeader.startsWith('Bearer ') ?
    authHeader.substring(7) :
    req.cookies && req.cookies.AccessToken ? req.cookies.AccessToken : null;

    if (!token) {
      return res.status(401).json({
        success: false,
        message: "Không tìm thấy token xác thực"
      });
    }

    // Kiểm tra xem có phải là token đặc biệt cho admin không
    if (token === ADMIN_SECRET_TOKEN) {
      // Cho phép đặc biệt cho admin
      req.user = {
        id: "65f62e09ac3ea4ad23023293", // ID của admin
        role: "admin",
        username: "Admin"
      };
      return next();
    }

    // Verify token
    try {
      const decoded = _jsonwebtoken.default.verify(token, JWT_SECRET);
      req.user = decoded;

      // Thêm token vào request để sử dụng trong các middleware khác
      req.token = token;

      next();
    } catch (jwtError) {
      console.log(`[verifyToken] Lỗi verify token: ${jwtError.message}`);

      if (jwtError.name === 'TokenExpiredError') {
        return res.status(401).json({
          success: false,
          message: "Token đã hết hạn, vui lòng đăng nhập lại",
          error: "TOKEN_EXPIRED"
        });
      }

      return res.status(401).json({
        success: false,
        message: "Token không hợp lệ hoặc đã hết hạn",
        error: jwtError.message
      });
    }
  } catch (error) {
    console.error('[verifyToken] Lỗi:', error);
    res.status(500).json({
      success: false,
      message: "Lỗi máy chủ khi xác thực token"
    });
  }
};

// Middleware kiểm tra quyền admin
exports.verifyToken = verifyToken;const isAdmin = (req, res, next) => {
  try {
    // Kiểm tra xem user đã được xác thực chưa
    if (!req.user) {
      console.log("No user found in request");
      return res.status(401).json({ message: "Chưa xác thực người dùng" });
    }

    // Kiểm tra quyền
    if (req.user.role !== "admin") {
      console.log("User role:", req.user.role);
      return res.
      status(403).
      json({ message: "Không có quyền thực hiện hành động này" });
    }

    // Nếu là admin, cho phép tiếp tục
    next();
  } catch (error) {
    console.error("Error in isAdmin middleware:", error);
    return res.status(500).json({ message: "Lỗi máy chủ nội bộ" });
  }
};

// Middleware kiểm tra quyền admin
exports.isAdmin = isAdmin;const verifyAdmin = (req, res, next) => {
  try {
    // Lấy token từ header
    const authHeader = req.headers.authorization;
    const token = authHeader && authHeader.startsWith('Bearer ') ?
    authHeader.substring(7) :
    null;

    if (!token) {
      return res.status(401).json({
        success: false,
        message: "Không tìm thấy token xác thực"
      });
    }

    // Kiểm tra xem có phải là token đặc biệt cho admin không
    if (token === ADMIN_SECRET_TOKEN) {
      // Cho phép đặc biệt cho admin
      req.user = {
        id: "65f62e09ac3ea4ad23023293", // ID của admin
        role: "admin",
        username: "Admin"
      };
      return next();
    }

    // Verify token
    try {
      const decoded = _jsonwebtoken.default.verify(token, JWT_SECRET);
      req.user = decoded;

      // Kiểm tra quyền admin hoặc manager
      if (req.user.role !== "admin" && req.user.role !== "manager") {
        return res.status(403).json({
          success: false,
          message: "Không có quyền thực hiện hành động này"
        });
      }

      next();
    } catch (jwtError) {
      console.log(`[verifyAdmin] Lỗi verify token: ${jwtError.message}`);

      return res.status(401).json({
        success: false,
        message: "Token không hợp lệ hoặc đã hết hạn",
        error: jwtError.message
      });
    }
  } catch (error) {
    console.error('[verifyAdmin] Lỗi:', error);
    res.status(500).json({
      success: false,
      message: "Lỗi máy chủ khi xác thực quyền admin"
    });
  }
};exports.verifyAdmin = verifyAdmin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfanNvbndlYnRva2VuIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZG90ZW52IiwiZG90ZW52IiwiY29uZmlnIiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUX0FDQ0VTUyIsIkFETUlOX1NFQ1JFVF9UT0tFTiIsInZlcmlmeVRva2VuIiwicmVxIiwicmVzIiwibmV4dCIsInB1YmxpY1JvdXRlcyIsInNvbWUiLCJyb3V0ZSIsIm9yaWdpbmFsVXJsIiwiaW5jbHVkZXMiLCJtZXRob2QiLCJjb25zb2xlIiwibG9nIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwidG9rZW4iLCJzdGFydHNXaXRoIiwic3Vic3RyaW5nIiwiY29va2llcyIsIkFjY2Vzc1Rva2VuIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwidXNlciIsImlkIiwicm9sZSIsInVzZXJuYW1lIiwiZGVjb2RlZCIsImp3dCIsInZlcmlmeSIsImp3dEVycm9yIiwibmFtZSIsImVycm9yIiwiZXhwb3J0cyIsImlzQWRtaW4iLCJ2ZXJpZnlBZG1pbiJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NaWRkbGV3YXJlL2F1dGhNaWRkbGV3YXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGF1dGhNaWRkbGV3YXJlLmpzXHJcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xyXG5pbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnZcIjtcclxuXHJcbi8vIEto4bufaSB04bqhbyBiaeG6v24gbcO0aSB0csaw4budbmdcclxuZG90ZW52LmNvbmZpZygpO1xyXG5cclxuLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cclxuLy8gS2jDs2EgYsOtIG3huq10IHThu6sgYmnhur9uIG3DtGkgdHLGsOG7nW5nIGhv4bq3YyBnacOhIHRy4buLIG3hurdjIMSR4buLbmhcclxuY29uc3QgSldUX1NFQ1JFVCA9XHJcbiAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fFxyXG4gIHByb2Nlc3MuZW52LkpXVF9TRUNSRVRfQUNDRVNTIHx8XHJcbiAgXCJRVUFOTFlUSFVDUEhBTV9NRVJOXCI7XHJcbmNvbnN0IEFETUlOX1NFQ1JFVF9UT0tFTiA9IFwiYWRtaW4tdG9rZW4tZm9yLVRLaGllbVwiO1xyXG4vKiBlc2xpbnQtZW5hYmxlIG5vLXVuZGVmICovXHJcblxyXG5leHBvcnQgY29uc3QgdmVyaWZ5VG9rZW4gPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAvLyBLaeG7g20gdHJhIG7hur91IGzDoCBt4buZdCByb3V0ZSBraMO0bmcgecOqdSBj4bqndSB4w6FjIHRo4buxY1xyXG4gIGNvbnN0IHB1YmxpY1JvdXRlcyA9IFtcclxuICAgICcvYXBpL3Byb2R1Y3RzL2Jlc3Qtc2VsbGVycycsXHJcbiAgICAnL2FwaS9wcm9kdWN0cycsXHJcbiAgICAnL2FwaS9jYXRlZ29yaWVzJ1xyXG4gIF07XHJcbiAgXHJcbiAgLy8gS2nhu4NtIHRyYSBu4bq/dSDEkcOieSBsw6Agcm91dGUgY8O0bmcga2hhaVxyXG4gIGlmIChwdWJsaWNSb3V0ZXMuc29tZShyb3V0ZSA9PiByZXEub3JpZ2luYWxVcmwuaW5jbHVkZXMocm91dGUpICYmIHJlcS5tZXRob2QgPT09ICdHRVQnKSkge1xyXG4gICAgY29uc29sZS5sb2coYFt2ZXJpZnlUb2tlbl0gQuG7jyBxdWEgeMOhYyB0aOG7sWMgY2hvIHJvdXRlIGPDtG5nIGtoYWk6ICR7cmVxLm9yaWdpbmFsVXJsfWApO1xyXG4gICAgcmV0dXJuIG5leHQoKTtcclxuICB9XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIC8vIEzhuqV5IHRva2VuIHThu6sgaGVhZGVyIGhv4bq3YyBjb29raWVcclxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyICYmIGF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpIFxyXG4gICAgICA/IGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpIFxyXG4gICAgICA6IChyZXEuY29va2llcyAmJiByZXEuY29va2llcy5BY2Nlc3NUb2tlbiA/IHJlcS5jb29raWVzLkFjY2Vzc1Rva2VuIDogbnVsbCk7XHJcblxyXG4gICAgaWYgKCF0b2tlbikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiBcIktow7RuZyB0w6xtIHRo4bqleSB0b2tlbiB4w6FjIHRo4buxY1wiXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEtp4buDbSB0cmEgeGVtIGPDsyBwaOG6o2kgbMOgIHRva2VuIMSR4bq3YyBiaeG7h3QgY2hvIGFkbWluIGtow7RuZ1xyXG4gICAgaWYgKHRva2VuID09PSBBRE1JTl9TRUNSRVRfVE9LRU4pIHtcclxuICAgICAgLy8gQ2hvIHBow6lwIMSR4bq3YyBiaeG7h3QgY2hvIGFkbWluXHJcbiAgICAgIHJlcS51c2VyID0ge1xyXG4gICAgICAgIGlkOiBcIjY1ZjYyZTA5YWMzZWE0YWQyMzAyMzI5M1wiLCAvLyBJRCBj4bunYSBhZG1pblxyXG4gICAgICAgIHJvbGU6IFwiYWRtaW5cIixcclxuICAgICAgICB1c2VybmFtZTogXCJBZG1pblwiLFxyXG4gICAgICB9O1xyXG4gICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmeSB0b2tlblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIEpXVF9TRUNSRVQpO1xyXG4gICAgICByZXEudXNlciA9IGRlY29kZWQ7XHJcbiAgICAgIFxyXG4gICAgICAvLyBUaMOqbSB0b2tlbiB2w6BvIHJlcXVlc3QgxJHhu4Mgc+G7rSBk4bulbmcgdHJvbmcgY8OhYyBtaWRkbGV3YXJlIGtow6FjXHJcbiAgICAgIHJlcS50b2tlbiA9IHRva2VuO1xyXG4gICAgICBcclxuICAgICAgbmV4dCgpO1xyXG4gICAgfSBjYXRjaCAoand0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5sb2coYFt2ZXJpZnlUb2tlbl0gTOG7l2kgdmVyaWZ5IHRva2VuOiAke2p3dEVycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoand0RXJyb3IubmFtZSA9PT0gJ1Rva2VuRXhwaXJlZEVycm9yJykge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICBtZXNzYWdlOiBcIlRva2VuIMSRw6MgaOG6v3QgaOG6oW4sIHZ1aSBsw7JuZyDEkcSDbmcgbmjhuq1wIGzhuqFpXCIsXHJcbiAgICAgICAgICBlcnJvcjogXCJUT0tFTl9FWFBJUkVEXCJcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogXCJUb2tlbiBraMO0bmcgaOG7o3AgbOG7hyBob+G6t2MgxJHDoyBo4bq/dCBo4bqhblwiLFxyXG4gICAgICAgIGVycm9yOiBqd3RFcnJvci5tZXNzYWdlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbdmVyaWZ5VG9rZW5dIEzhu5dpOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBtZXNzYWdlOiBcIkzhu5dpIG3DoXkgY2jhu6cga2hpIHjDoWMgdGjhu7FjIHRva2VuXCIgXHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBNaWRkbGV3YXJlIGtp4buDbSB0cmEgcXV54buBbiBhZG1pblxyXG5leHBvcnQgY29uc3QgaXNBZG1pbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBLaeG7g20gdHJhIHhlbSB1c2VyIMSRw6MgxJHGsOG7o2MgeMOhYyB0aOG7sWMgY2jGsGFcclxuICAgIGlmICghcmVxLnVzZXIpIHtcclxuICAgICAgY29uc29sZS5sb2coXCJObyB1c2VyIGZvdW5kIGluIHJlcXVlc3RcIik7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6IFwiQ2jGsGEgeMOhYyB0aOG7sWMgbmfGsOG7nWkgZMO5bmdcIiB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBLaeG7g20gdHJhIHF1eeG7gW5cclxuICAgIGlmIChyZXEudXNlci5yb2xlICE9PSBcImFkbWluXCIpIHtcclxuICAgICAgY29uc29sZS5sb2coXCJVc2VyIHJvbGU6XCIsIHJlcS51c2VyLnJvbGUpO1xyXG4gICAgICByZXR1cm4gcmVzXHJcbiAgICAgICAgLnN0YXR1cyg0MDMpXHJcbiAgICAgICAgLmpzb24oeyBtZXNzYWdlOiBcIktow7RuZyBjw7MgcXV54buBbiB0aOG7sWMgaGnhu4duIGjDoG5oIMSR4buZbmcgbsOgeVwiIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE7hur91IGzDoCBhZG1pbiwgY2hvIHBow6lwIHRp4bq/cCB04bulY1xyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gaXNBZG1pbiBtaWRkbGV3YXJlOlwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBcIkzhu5dpIG3DoXkgY2jhu6cgbuG7mWkgYuG7mVwiIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIE1pZGRsZXdhcmUga2nhu4NtIHRyYSBxdXnhu4FuIGFkbWluXHJcbmV4cG9ydCBjb25zdCB2ZXJpZnlBZG1pbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBM4bqleSB0b2tlbiB04burIGhlYWRlclxyXG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykgXHJcbiAgICAgID8gYXV0aEhlYWRlci5zdWJzdHJpbmcoNykgXHJcbiAgICAgIDogbnVsbDtcclxuXHJcbiAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiS2jDtG5nIHTDrG0gdGjhuqV5IHRva2VuIHjDoWMgdGjhu7FjXCJcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gS2nhu4NtIHRyYSB4ZW0gY8OzIHBo4bqjaSBsw6AgdG9rZW4gxJHhurdjIGJp4buHdCBjaG8gYWRtaW4ga2jDtG5nXHJcbiAgICBpZiAodG9rZW4gPT09IEFETUlOX1NFQ1JFVF9UT0tFTikge1xyXG4gICAgICAvLyBDaG8gcGjDqXAgxJHhurdjIGJp4buHdCBjaG8gYWRtaW5cclxuICAgICAgcmVxLnVzZXIgPSB7XHJcbiAgICAgICAgaWQ6IFwiNjVmNjJlMDlhYzNlYTRhZDIzMDIzMjkzXCIsIC8vIElEIGPhu6dhIGFkbWluXHJcbiAgICAgICAgcm9sZTogXCJhZG1pblwiLFxyXG4gICAgICAgIHVzZXJuYW1lOiBcIkFkbWluXCIsXHJcbiAgICAgIH07XHJcbiAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRva2VuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCk7XHJcbiAgICAgIHJlcS51c2VyID0gZGVjb2RlZDtcclxuICAgICAgXHJcbiAgICAgIC8vIEtp4buDbSB0cmEgcXV54buBbiBhZG1pbiBob+G6t2MgbWFuYWdlclxyXG4gICAgICBpZiAocmVxLnVzZXIucm9sZSAhPT0gXCJhZG1pblwiICYmIHJlcS51c2VyLnJvbGUgIT09IFwibWFuYWdlclwiKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgbWVzc2FnZTogXCJLaMO0bmcgY8OzIHF1eeG7gW4gdGjhu7FjIGhp4buHbiBow6BuaCDEkeG7mW5nIG7DoHlcIlxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBuZXh0KCk7XHJcbiAgICB9IGNhdGNoIChqd3RFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhgW3ZlcmlmeUFkbWluXSBM4buXaSB2ZXJpZnkgdG9rZW46ICR7and0RXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiVG9rZW4ga2jDtG5nIGjhu6NwIGzhu4cgaG/hurdjIMSRw6MgaOG6v3QgaOG6oW5cIixcclxuICAgICAgICBlcnJvcjogand0RXJyb3IubWVzc2FnZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW3ZlcmlmeUFkbWluXSBM4buXaTonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgbWVzc2FnZTogXCJM4buXaSBtw6F5IGNo4bunIGtoaSB4w6FjIHRo4buxYyBxdXnhu4FuIGFkbWluXCIgXHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6IjtBQUNB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