"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.sendReviewReplyNotification = exports.sendPushNotification = exports.sendOrderStatusNotification = exports.sendNotificationToUser = exports.sendNewProductNotification = exports.sendNewCouponNotification = exports.sendMessageNotification = void 0;

var _webPush = _interopRequireDefault(require("web-push"));
var _dotenv = _interopRequireDefault(require("dotenv"));
var _Register = _interopRequireDefault(require("../Model/Register.js"));
var _notificationModel = _interopRequireDefault(require("../Model/notificationModel.js")); /* eslint-disable no-undef */ /* eslint-disable no-useless-escape */

_dotenv.default.config();

const vapidPublicKey = process.env.VAPID_PUBLIC_KEY;
const vapidPrivateKey = process.env.VAPID_PRIVATE_KEY;

_webPush.default.setVapidDetails(
  "mailto:kit10012003@gmail.com",
  vapidPublicKey,
  vapidPrivateKey
);

const sendPushNotification = async (userId, subscription, payload) => {
  try {
    if (!subscription || !subscription.endpoint)
    return { success: false, message: "Invalid subscription" };

    const notification = new _notificationModel.default({
      userId,
      title: payload.title,
      body: payload.body,
      data: payload.data,
      status: "pending"
    });
    await notification.save();

    const webPushPayload = {
      notification: {
        title: payload.title,
        body: payload.body,
        icon: payload.data?.icon || "/logo192.png",
        badge: "/badge-icon.png",
        vibrate: [100, 50, 100],
        tag: payload.data?.type || "general",
        actions: payload.data?.actions || [
        { action: "view", title: "Xem ngay" }],

        data: {
          ...payload.data,
          dateOfArrival: Date.now(),
          requireInteraction: true,
          renotify: true
        }
      }
    };

    const result = await _webPush.default.sendNotification(
      subscription,
      JSON.stringify(webPushPayload)
    );

    notification.status = "sent";
    await notification.save();

    return { success: true, result };
  } catch (error) {
    await _notificationModel.default.findOneAndUpdate(
      { userId, title: payload.title, body: payload.body, status: "pending" },
      { status: "failed", error: error.message }
    );
    return { success: false, error: error.message };
  }
};exports.sendPushNotification = sendPushNotification;

const sendNotificationToUser = async (userId, payload) => {
  try {
    const user = await _Register.default.findById(userId);
    if (!user) return { success: false, message: "User not found" };

    if (!user.pushSubscriptions || user.pushSubscriptions.length === 0) {
      const notification = new _notificationModel.default({
        userId,
        title: payload.title,
        body: payload.body,
        data: payload.data,
        status: "pending_view"
      });
      await notification.save();
      return {
        success: true,
        message: "Notification saved for in-app display"
      };
    }

    const results = await Promise.all(
      user.pushSubscriptions.map((subscription) =>
      sendPushNotification(userId, subscription, payload)
      )
    );

    const successCount = results.filter((r) => r.success).length;
    return {
      success: successCount > 0,
      message: `Sent to ${successCount}/${user.pushSubscriptions.length} devices`
    };
  } catch (error) {
    return { success: false, error: error.message };
  }
};exports.sendNotificationToUser = sendNotificationToUser;

const sendNewProductNotification = async (product) => {
  try {
    const users = await _Register.default.find({
      pushSubscriptions: { $exists: true, $not: { $size: 0 } }
    });
    if (!users.length) return;

    const payload = {
      title: "Sản phẩm mới!",
      body: `${product.productName} đã được thêm. Giá: ${product.productPrice}đ`,
      data: {
        url: `/san-pham/${product._id}`,
        productId: product._id,
        type: "new_product"
      }
    };

    await Promise.allSettled(
      users.map((user) => sendNotificationToUser(user._id, payload))
    );
    return true;
  } catch (error) {
    console.error("Lỗi khi gửi thông báo sản phẩm mới:", error);
    return false;
  }
};exports.sendNewProductNotification = sendNewProductNotification;

const sendNewCouponNotification = async (coupon) => {
  try {
    const users = await _Register.default.find({
      pushSubscriptions: { $exists: true, $not: { $size: 0 } }
    });
    if (!users.length) return;

    const payload = {
      title: "Mã giảm giá mới!",
      body: `Sử dụng mã ${coupon.code} để được giảm ${
      coupon.type === "percentage" ? `${coupon.value}%` : `${coupon.value}đ`}`,

      data: {
        url: "/voucher",
        couponCode: coupon.code,
        type: "new_coupon"
      }
    };

    await Promise.allSettled(
      users.map((user) => sendNotificationToUser(user._id, payload))
    );
    return true;
  } catch (error) {
    console.error("Lỗi khi gửi thông báo mã giảm giá:", error);
    return false;
  }
};exports.sendNewCouponNotification = sendNewCouponNotification;

const sendReviewReplyNotification = async (
userId,
review,
replyText) =>
{
  try {
    return await sendNotificationToUser(userId, {
      title: "Phản hồi đánh giá sản phẩm",
      body: `Admin: \"${replyText.slice(0, 120)}${
      replyText.length > 120 ? "..." : ""}\"`,

      data: {
        url: `/product/${review.productId}`,
        reviewId: review._id,
        type: "review_reply",
        productName: review.productName,
        replyContent: replyText,
        icon: "/review-icon.png"
      }
    });
  } catch (error) {
    return { success: false, error: error.message };
  }
};exports.sendReviewReplyNotification = sendReviewReplyNotification;

const sendOrderStatusNotification = async (
userId,
order,
statusText) =>
{
  try {
    const title = `Cập nhật đơn hàng #${
    order.orderNumber || order._id.toString().slice(0, 8)}`;

    let body = `Đơn hàng của bạn ${statusText}`;

    if (order.totalAmount) {
      body += ` - Giá trị: ${new Intl.NumberFormat("vi-VN", {
        style: "currency",
        currency: "VND"
      }).format(order.totalAmount)}`;
    }

    return await sendNotificationToUser(userId, {
      title,
      body,
      data: {
        url: `/tai-khoan/don-hang/${order._id}`,
        orderId: order._id,
        type: "order_update",
        status: order.status,
        orderItems:
        order.items?.map((item) => ({
          name: item.productName,
          quantity: item.quantity
        })) || [],
        icon: "/order-icon.png"
      }
    });
  } catch (error) {
    return { success: false, error: error.message };
  }
};exports.sendOrderStatusNotification = sendOrderStatusNotification;

const sendMessageNotification = async (
userId,
senderName,
messageText) =>
{
  try {
    return await sendNotificationToUser(userId, {
      title: `Tin nhắn mới từ ${senderName}`,
      body:
      messageText.length > 100 ?
      `${messageText.slice(0, 100)}...` :
      messageText,
      data: {
        url: "/tai-khoan/tin-nhan",
        type: "new_message",
        senderId: senderName,
        messageContent: messageText,
        icon: "/chat-icon.png",
        actions: [
        { action: "reply", title: "Trả lời" },
        { action: "view", title: "Xem tất cả" }]

      }
    });
  } catch (error) {
    return { success: false, error: error.message };
  }
};exports.sendMessageNotification = sendMessageNotification;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfd2ViUHVzaCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2RvdGVudiIsIl9SZWdpc3RlciIsIl9ub3RpZmljYXRpb25Nb2RlbCIsImRvdGVudiIsImNvbmZpZyIsInZhcGlkUHVibGljS2V5IiwicHJvY2VzcyIsImVudiIsIlZBUElEX1BVQkxJQ19LRVkiLCJ2YXBpZFByaXZhdGVLZXkiLCJWQVBJRF9QUklWQVRFX0tFWSIsIndlYnB1c2giLCJzZXRWYXBpZERldGFpbHMiLCJzZW5kUHVzaE5vdGlmaWNhdGlvbiIsInVzZXJJZCIsInN1YnNjcmlwdGlvbiIsInBheWxvYWQiLCJlbmRwb2ludCIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwibm90aWZpY2F0aW9uIiwiTm90aWZpY2F0aW9uIiwidGl0bGUiLCJib2R5IiwiZGF0YSIsInN0YXR1cyIsInNhdmUiLCJ3ZWJQdXNoUGF5bG9hZCIsImljb24iLCJiYWRnZSIsInZpYnJhdGUiLCJ0YWciLCJ0eXBlIiwiYWN0aW9ucyIsImFjdGlvbiIsImRhdGVPZkFycml2YWwiLCJEYXRlIiwibm93IiwicmVxdWlyZUludGVyYWN0aW9uIiwicmVub3RpZnkiLCJyZXN1bHQiLCJzZW5kTm90aWZpY2F0aW9uIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yIiwiZmluZE9uZUFuZFVwZGF0ZSIsImV4cG9ydHMiLCJzZW5kTm90aWZpY2F0aW9uVG9Vc2VyIiwidXNlciIsIlVzZXIiLCJmaW5kQnlJZCIsInB1c2hTdWJzY3JpcHRpb25zIiwibGVuZ3RoIiwicmVzdWx0cyIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJzdWNjZXNzQ291bnQiLCJmaWx0ZXIiLCJyIiwic2VuZE5ld1Byb2R1Y3ROb3RpZmljYXRpb24iLCJwcm9kdWN0IiwidXNlcnMiLCJmaW5kIiwiJGV4aXN0cyIsIiRub3QiLCIkc2l6ZSIsInByb2R1Y3ROYW1lIiwicHJvZHVjdFByaWNlIiwidXJsIiwiX2lkIiwicHJvZHVjdElkIiwiYWxsU2V0dGxlZCIsImNvbnNvbGUiLCJzZW5kTmV3Q291cG9uTm90aWZpY2F0aW9uIiwiY291cG9uIiwiY29kZSIsInZhbHVlIiwiY291cG9uQ29kZSIsInNlbmRSZXZpZXdSZXBseU5vdGlmaWNhdGlvbiIsInJldmlldyIsInJlcGx5VGV4dCIsInNsaWNlIiwicmV2aWV3SWQiLCJyZXBseUNvbnRlbnQiLCJzZW5kT3JkZXJTdGF0dXNOb3RpZmljYXRpb24iLCJvcmRlciIsInN0YXR1c1RleHQiLCJvcmRlck51bWJlciIsInRvU3RyaW5nIiwidG90YWxBbW91bnQiLCJJbnRsIiwiTnVtYmVyRm9ybWF0Iiwic3R5bGUiLCJjdXJyZW5jeSIsImZvcm1hdCIsIm9yZGVySWQiLCJvcmRlckl0ZW1zIiwiaXRlbXMiLCJpdGVtIiwibmFtZSIsInF1YW50aXR5Iiwic2VuZE1lc3NhZ2VOb3RpZmljYXRpb24iLCJzZW5kZXJOYW1lIiwibWVzc2FnZVRleHQiLCJzZW5kZXJJZCIsIm1lc3NhZ2VDb250ZW50Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL1NlcnZpY2VzL25vdGlmaWNhdGlvblNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cclxuLyogZXNsaW50LWRpc2FibGUgbm8tdXNlbGVzcy1lc2NhcGUgKi9cclxuaW1wb3J0IHdlYnB1c2ggZnJvbSBcIndlYi1wdXNoXCI7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5pbXBvcnQgVXNlciBmcm9tIFwiLi4vTW9kZWwvUmVnaXN0ZXIuanNcIjtcclxuaW1wb3J0IE5vdGlmaWNhdGlvbiBmcm9tIFwiLi4vTW9kZWwvbm90aWZpY2F0aW9uTW9kZWwuanNcIjtcclxuXHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbmNvbnN0IHZhcGlkUHVibGljS2V5ID0gcHJvY2Vzcy5lbnYuVkFQSURfUFVCTElDX0tFWTtcclxuY29uc3QgdmFwaWRQcml2YXRlS2V5ID0gcHJvY2Vzcy5lbnYuVkFQSURfUFJJVkFURV9LRVk7XHJcblxyXG53ZWJwdXNoLnNldFZhcGlkRGV0YWlscyhcclxuICBcIm1haWx0bzpraXQxMDAxMjAwM0BnbWFpbC5jb21cIixcclxuICB2YXBpZFB1YmxpY0tleSxcclxuICB2YXBpZFByaXZhdGVLZXlcclxuKTtcclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kUHVzaE5vdGlmaWNhdGlvbiA9IGFzeW5jICh1c2VySWQsIHN1YnNjcmlwdGlvbiwgcGF5bG9hZCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXN1YnNjcmlwdGlvbiB8fCAhc3Vic2NyaXB0aW9uLmVuZHBvaW50KVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJJbnZhbGlkIHN1YnNjcmlwdGlvblwiIH07XHJcblxyXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uID0gbmV3IE5vdGlmaWNhdGlvbih7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgdGl0bGU6IHBheWxvYWQudGl0bGUsXHJcbiAgICAgIGJvZHk6IHBheWxvYWQuYm9keSxcclxuICAgICAgZGF0YTogcGF5bG9hZC5kYXRhLFxyXG4gICAgICBzdGF0dXM6IFwicGVuZGluZ1wiLFxyXG4gICAgfSk7XHJcbiAgICBhd2FpdCBub3RpZmljYXRpb24uc2F2ZSgpO1xyXG5cclxuICAgIGNvbnN0IHdlYlB1c2hQYXlsb2FkID0ge1xyXG4gICAgICBub3RpZmljYXRpb246IHtcclxuICAgICAgICB0aXRsZTogcGF5bG9hZC50aXRsZSxcclxuICAgICAgICBib2R5OiBwYXlsb2FkLmJvZHksXHJcbiAgICAgICAgaWNvbjogcGF5bG9hZC5kYXRhPy5pY29uIHx8IFwiL2xvZ28xOTIucG5nXCIsXHJcbiAgICAgICAgYmFkZ2U6IFwiL2JhZGdlLWljb24ucG5nXCIsXHJcbiAgICAgICAgdmlicmF0ZTogWzEwMCwgNTAsIDEwMF0sXHJcbiAgICAgICAgdGFnOiBwYXlsb2FkLmRhdGE/LnR5cGUgfHwgXCJnZW5lcmFsXCIsXHJcbiAgICAgICAgYWN0aW9uczogcGF5bG9hZC5kYXRhPy5hY3Rpb25zIHx8IFtcclxuICAgICAgICAgIHsgYWN0aW9uOiBcInZpZXdcIiwgdGl0bGU6IFwiWGVtIG5nYXlcIiB9LFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgLi4ucGF5bG9hZC5kYXRhLFxyXG4gICAgICAgICAgZGF0ZU9mQXJyaXZhbDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgIHJlcXVpcmVJbnRlcmFjdGlvbjogdHJ1ZSxcclxuICAgICAgICAgIHJlbm90aWZ5OiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdlYnB1c2guc2VuZE5vdGlmaWNhdGlvbihcclxuICAgICAgc3Vic2NyaXB0aW9uLFxyXG4gICAgICBKU09OLnN0cmluZ2lmeSh3ZWJQdXNoUGF5bG9hZClcclxuICAgICk7XHJcblxyXG4gICAgbm90aWZpY2F0aW9uLnN0YXR1cyA9IFwic2VudFwiO1xyXG4gICAgYXdhaXQgbm90aWZpY2F0aW9uLnNhdmUoKTtcclxuXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZXN1bHQgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgYXdhaXQgTm90aWZpY2F0aW9uLmZpbmRPbmVBbmRVcGRhdGUoXHJcbiAgICAgIHsgdXNlcklkLCB0aXRsZTogcGF5bG9hZC50aXRsZSwgYm9keTogcGF5bG9hZC5ib2R5LCBzdGF0dXM6IFwicGVuZGluZ1wiIH0sXHJcbiAgICAgIHsgc3RhdHVzOiBcImZhaWxlZFwiLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmROb3RpZmljYXRpb25Ub1VzZXIgPSBhc3luYyAodXNlcklkLCBwYXlsb2FkKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCk7XHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIlVzZXIgbm90IGZvdW5kXCIgfTtcclxuXHJcbiAgICBpZiAoIXVzZXIucHVzaFN1YnNjcmlwdGlvbnMgfHwgdXNlci5wdXNoU3Vic2NyaXB0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gbmV3IE5vdGlmaWNhdGlvbih7XHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIHRpdGxlOiBwYXlsb2FkLnRpdGxlLFxyXG4gICAgICAgIGJvZHk6IHBheWxvYWQuYm9keSxcclxuICAgICAgICBkYXRhOiBwYXlsb2FkLmRhdGEsXHJcbiAgICAgICAgc3RhdHVzOiBcInBlbmRpbmdfdmlld1wiLFxyXG4gICAgICB9KTtcclxuICAgICAgYXdhaXQgbm90aWZpY2F0aW9uLnNhdmUoKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiTm90aWZpY2F0aW9uIHNhdmVkIGZvciBpbi1hcHAgZGlzcGxheVwiLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgICAgdXNlci5wdXNoU3Vic2NyaXB0aW9ucy5tYXAoKHN1YnNjcmlwdGlvbikgPT5cclxuICAgICAgICBzZW5kUHVzaE5vdGlmaWNhdGlvbih1c2VySWQsIHN1YnNjcmlwdGlvbiwgcGF5bG9hZClcclxuICAgICAgKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBzdWNjZXNzQ291bnQgPSByZXN1bHRzLmZpbHRlcigocikgPT4gci5zdWNjZXNzKS5sZW5ndGg7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBzdWNjZXNzQ291bnQgPiAwLFxyXG4gICAgICBtZXNzYWdlOiBgU2VudCB0byAke3N1Y2Nlc3NDb3VudH0vJHt1c2VyLnB1c2hTdWJzY3JpcHRpb25zLmxlbmd0aH0gZGV2aWNlc2AsXHJcbiAgICB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc2VuZE5ld1Byb2R1Y3ROb3RpZmljYXRpb24gPSBhc3luYyAocHJvZHVjdCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IFVzZXIuZmluZCh7XHJcbiAgICAgIHB1c2hTdWJzY3JpcHRpb25zOiB7ICRleGlzdHM6IHRydWUsICRub3Q6IHsgJHNpemU6IDAgfSB9LFxyXG4gICAgfSk7XHJcbiAgICBpZiAoIXVzZXJzLmxlbmd0aCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHBheWxvYWQgPSB7XHJcbiAgICAgIHRpdGxlOiBcIlPhuqNuIHBo4bqpbSBt4bubaSFcIixcclxuICAgICAgYm9keTogYCR7cHJvZHVjdC5wcm9kdWN0TmFtZX0gxJHDoyDEkcaw4bujYyB0aMOqbS4gR2nDoTogJHtwcm9kdWN0LnByb2R1Y3RQcmljZX3EkWAsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB1cmw6IGAvc2FuLXBoYW0vJHtwcm9kdWN0Ll9pZH1gLFxyXG4gICAgICAgIHByb2R1Y3RJZDogcHJvZHVjdC5faWQsXHJcbiAgICAgICAgdHlwZTogXCJuZXdfcHJvZHVjdFwiLFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuXHJcbiAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoXHJcbiAgICAgIHVzZXJzLm1hcCgodXNlcikgPT4gc2VuZE5vdGlmaWNhdGlvblRvVXNlcih1c2VyLl9pZCwgcGF5bG9hZCkpXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJM4buXaSBraGkgZ+G7rWkgdGjDtG5nIGLDoW8gc+G6o24gcGjhuqltIG3hu5tpOlwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmROZXdDb3Vwb25Ob3RpZmljYXRpb24gPSBhc3luYyAoY291cG9uKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgVXNlci5maW5kKHtcclxuICAgICAgcHVzaFN1YnNjcmlwdGlvbnM6IHsgJGV4aXN0czogdHJ1ZSwgJG5vdDogeyAkc2l6ZTogMCB9IH0sXHJcbiAgICB9KTtcclxuICAgIGlmICghdXNlcnMubGVuZ3RoKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgcGF5bG9hZCA9IHtcclxuICAgICAgdGl0bGU6IFwiTcOjIGdp4bqjbSBnacOhIG3hu5tpIVwiLFxyXG4gICAgICBib2R5OiBgU+G7rSBk4bulbmcgbcOjICR7Y291cG9uLmNvZGV9IMSR4buDIMSRxrDhu6NjIGdp4bqjbSAke1xyXG4gICAgICAgIGNvdXBvbi50eXBlID09PSBcInBlcmNlbnRhZ2VcIiA/IGAke2NvdXBvbi52YWx1ZX0lYCA6IGAke2NvdXBvbi52YWx1ZX3EkWBcclxuICAgICAgfWAsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB1cmw6IFwiL3ZvdWNoZXJcIixcclxuICAgICAgICBjb3Vwb25Db2RlOiBjb3Vwb24uY29kZSxcclxuICAgICAgICB0eXBlOiBcIm5ld19jb3Vwb25cIixcclxuICAgICAgfSxcclxuICAgIH07XHJcblxyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFxyXG4gICAgICB1c2Vycy5tYXAoKHVzZXIpID0+IHNlbmROb3RpZmljYXRpb25Ub1VzZXIodXNlci5faWQsIHBheWxvYWQpKVxyXG4gICAgKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiTOG7l2kga2hpIGfhu61pIHRow7RuZyBiw6FvIG3DoyBnaeG6o20gZ2nDoTpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kUmV2aWV3UmVwbHlOb3RpZmljYXRpb24gPSBhc3luYyAoXHJcbiAgdXNlcklkLFxyXG4gIHJldmlldyxcclxuICByZXBseVRleHRcclxuKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBhd2FpdCBzZW5kTm90aWZpY2F0aW9uVG9Vc2VyKHVzZXJJZCwge1xyXG4gICAgICB0aXRsZTogXCJQaOG6o24gaOG7k2kgxJHDoW5oIGdpw6Egc+G6o24gcGjhuqltXCIsXHJcbiAgICAgIGJvZHk6IGBBZG1pbjogXFxcIiR7cmVwbHlUZXh0LnNsaWNlKDAsIDEyMCl9JHtcclxuICAgICAgICByZXBseVRleHQubGVuZ3RoID4gMTIwID8gXCIuLi5cIiA6IFwiXCJcclxuICAgICAgfVxcXCJgLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdXJsOiBgL3Byb2R1Y3QvJHtyZXZpZXcucHJvZHVjdElkfWAsXHJcbiAgICAgICAgcmV2aWV3SWQ6IHJldmlldy5faWQsXHJcbiAgICAgICAgdHlwZTogXCJyZXZpZXdfcmVwbHlcIixcclxuICAgICAgICBwcm9kdWN0TmFtZTogcmV2aWV3LnByb2R1Y3ROYW1lLFxyXG4gICAgICAgIHJlcGx5Q29udGVudDogcmVwbHlUZXh0LFxyXG4gICAgICAgIGljb246IFwiL3Jldmlldy1pY29uLnBuZ1wiLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kT3JkZXJTdGF0dXNOb3RpZmljYXRpb24gPSBhc3luYyAoXHJcbiAgdXNlcklkLFxyXG4gIG9yZGVyLFxyXG4gIHN0YXR1c1RleHRcclxuKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRpdGxlID0gYEPhuq1wIG5o4bqtdCDEkcahbiBow6BuZyAjJHtcclxuICAgICAgb3JkZXIub3JkZXJOdW1iZXIgfHwgb3JkZXIuX2lkLnRvU3RyaW5nKCkuc2xpY2UoMCwgOClcclxuICAgIH1gO1xyXG4gICAgbGV0IGJvZHkgPSBgxJDGoW4gaMOgbmcgY+G7p2EgYuG6oW4gJHtzdGF0dXNUZXh0fWA7XHJcblxyXG4gICAgaWYgKG9yZGVyLnRvdGFsQW1vdW50KSB7XHJcbiAgICAgIGJvZHkgKz0gYCAtIEdpw6EgdHLhu4s6ICR7bmV3IEludGwuTnVtYmVyRm9ybWF0KFwidmktVk5cIiwge1xyXG4gICAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXHJcbiAgICAgICAgY3VycmVuY3k6IFwiVk5EXCIsXHJcbiAgICAgIH0pLmZvcm1hdChvcmRlci50b3RhbEFtb3VudCl9YDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYXdhaXQgc2VuZE5vdGlmaWNhdGlvblRvVXNlcih1c2VySWQsIHtcclxuICAgICAgdGl0bGUsXHJcbiAgICAgIGJvZHksXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB1cmw6IGAvdGFpLWtob2FuL2Rvbi1oYW5nLyR7b3JkZXIuX2lkfWAsXHJcbiAgICAgICAgb3JkZXJJZDogb3JkZXIuX2lkLFxyXG4gICAgICAgIHR5cGU6IFwib3JkZXJfdXBkYXRlXCIsXHJcbiAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMsXHJcbiAgICAgICAgb3JkZXJJdGVtczpcclxuICAgICAgICAgIG9yZGVyLml0ZW1zPy5tYXAoKGl0ZW0pID0+ICh7XHJcbiAgICAgICAgICAgIG5hbWU6IGl0ZW0ucHJvZHVjdE5hbWUsXHJcbiAgICAgICAgICAgIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5LFxyXG4gICAgICAgICAgfSkpIHx8IFtdLFxyXG4gICAgICAgIGljb246IFwiL29yZGVyLWljb24ucG5nXCIsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlTm90aWZpY2F0aW9uID0gYXN5bmMgKFxyXG4gIHVzZXJJZCxcclxuICBzZW5kZXJOYW1lLFxyXG4gIG1lc3NhZ2VUZXh0XHJcbikgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICByZXR1cm4gYXdhaXQgc2VuZE5vdGlmaWNhdGlvblRvVXNlcih1c2VySWQsIHtcclxuICAgICAgdGl0bGU6IGBUaW4gbmjhuq9uIG3hu5tpIHThu6sgJHtzZW5kZXJOYW1lfWAsXHJcbiAgICAgIGJvZHk6XHJcbiAgICAgICAgbWVzc2FnZVRleHQubGVuZ3RoID4gMTAwXHJcbiAgICAgICAgICA/IGAke21lc3NhZ2VUZXh0LnNsaWNlKDAsIDEwMCl9Li4uYFxyXG4gICAgICAgICAgOiBtZXNzYWdlVGV4dCxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHVybDogXCIvdGFpLWtob2FuL3Rpbi1uaGFuXCIsXHJcbiAgICAgICAgdHlwZTogXCJuZXdfbWVzc2FnZVwiLFxyXG4gICAgICAgIHNlbmRlcklkOiBzZW5kZXJOYW1lLFxyXG4gICAgICAgIG1lc3NhZ2VDb250ZW50OiBtZXNzYWdlVGV4dCxcclxuICAgICAgICBpY29uOiBcIi9jaGF0LWljb24ucG5nXCIsXHJcbiAgICAgICAgYWN0aW9uczogW1xyXG4gICAgICAgICAgeyBhY3Rpb246IFwicmVwbHlcIiwgdGl0bGU6IFwiVHLhuqMgbOG7nWlcIiB9LFxyXG4gICAgICAgICAgeyBhY3Rpb246IFwidmlld1wiLCB0aXRsZTogXCJYZW0gdOG6pXQgY+G6o1wiIH0sXHJcbiAgICAgICAgXSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICB9XHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFFQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxTQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxrQkFBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBLG1DQUF5RCxDQUx6RCw4QkFDQTs7QUFNQUksZUFBTSxDQUFDQyxNQUFNLENBQUMsQ0FBQzs7QUFFZixNQUFNQyxjQUFjLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxnQkFBZ0I7QUFDbkQsTUFBTUMsZUFBZSxHQUFHSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csaUJBQWlCOztBQUVyREMsZ0JBQU8sQ0FBQ0MsZUFBZTtFQUNyQiw4QkFBOEI7RUFDOUJQLGNBQWM7RUFDZEk7QUFDRixDQUFDOztBQUVNLE1BQU1JLG9CQUFvQixHQUFHLE1BQUFBLENBQU9DLE1BQU0sRUFBRUMsWUFBWSxFQUFFQyxPQUFPLEtBQUs7RUFDM0UsSUFBSTtJQUNGLElBQUksQ0FBQ0QsWUFBWSxJQUFJLENBQUNBLFlBQVksQ0FBQ0UsUUFBUTtJQUN6QyxPQUFPLEVBQUVDLE9BQU8sRUFBRSxLQUFLLEVBQUVDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDOztJQUU1RCxNQUFNQyxZQUFZLEdBQUcsSUFBSUMsMEJBQVksQ0FBQztNQUNwQ1AsTUFBTTtNQUNOUSxLQUFLLEVBQUVOLE9BQU8sQ0FBQ00sS0FBSztNQUNwQkMsSUFBSSxFQUFFUCxPQUFPLENBQUNPLElBQUk7TUFDbEJDLElBQUksRUFBRVIsT0FBTyxDQUFDUSxJQUFJO01BQ2xCQyxNQUFNLEVBQUU7SUFDVixDQUFDLENBQUM7SUFDRixNQUFNTCxZQUFZLENBQUNNLElBQUksQ0FBQyxDQUFDOztJQUV6QixNQUFNQyxj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