"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;

var _axios = _interopRequireDefault(require("axios"));
var _paymentConfig = require("../config/paymentConfig.js");
var _qrcode = _interopRequireDefault(require("qrcode"));
var _crypto = _interopRequireDefault(require("crypto"));
var _dotenv = _interopRequireDefault(require("dotenv")); /* eslint-disable no-unused-vars */ /* eslint-disable no-undef */

_dotenv.default.config();

// Thêm biến môi trường cho domain
const isDevelopment = process.env.NODE_ENV !== 'production';
const SITE_CONFIG = {
  baseUrl: isDevelopment ? "http://localhost:3000" : "https://quanlythucpham.vercel.app",
  apiUrl: isDevelopment ? "http://localhost:8080" : "https://quanlythucpham-azf6.vercel.app"
};

class PaymentService {
  // SePay Payment
  static async createSePayPayment(orderId, amount, orderInfo, customRedirectUrl = null) {
    try {
      // Cấu hình endpoints callback
      // Sử dụng customRedirectUrl từ client nếu có, ngược lại dùng URL mặc định
      const returnUrl = customRedirectUrl || `${SITE_CONFIG.baseUrl}/payment-result`;

      // Ưu tiên sử dụng NGROK_URL nếu có (cho môi trường phát triển với ngrok)
      const ngrokUrl = process.env.NGROK_URL;

      // Sử dụng đường dẫn chính xác của API
      const apiBaseUrl = ngrokUrl || (isDevelopment ?
      "http://localhost:8080" :
      "https://quanlythucpham-azf6.vercel.app");

      // Đường dẫn webhook SePay chính xác
      const notifyUrl = `${apiBaseUrl}/api/payments/webhook/bank`;

      const requestData = {
        merchantId: _paymentConfig.SEPAY.merchantId,
        orderId: orderId.toString(),
        amount: parseInt(amount),
        orderInfo: orderInfo,
        returnUrl: `${returnUrl}${returnUrl.includes('?') ? '&' : '?'}status=success&amount=${amount}`,
        notifyUrl: notifyUrl,
        expireTime: _paymentConfig.SEPAY.qrExpireTime // Thêm thời gian hết hạn từ config
      };

      // Gọi API SePay thực từ tệp .env
      const response = await _axios.default.post(
        process.env.SEPAY_API_URL,
        requestData,
        {
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${process.env.SEPAY_API_TOKEN}`
          },
          timeout: 30000 // 30 giây
        }
      );

      if (response.data && response.data.code === '00') {
        // Tạo QR code cho URL thanh toán
        const qrCodeDataURL = await this.generateQRCode(response.data.data);

        return {
          code: response.data.code,
          message: response.data.message,
          data: response.data.data,
          qr_code: qrCodeDataURL
        };
      } else {
        throw new Error(`Phản hồi không thành công từ SePay API: ${response.data && response.data.message ? response.data.message : 'Unknown error'}`);
      }
    } catch (error) {
      throw new Error(`Lỗi tạo thanh toán SePay: ${error.message}`);
    }
  }

  // Tạo URL thanh toán dự phòng
  static async createFallbackPayment(orderId, amount, orderInfo) {
    try {
      // Sử dụng URL động dựa vào môi trường
      const baseUrl = SITE_CONFIG.baseUrl;

      // URL thanh toán dự phòng
      const fallbackUrl = `${baseUrl}/payment-result?orderId=${orderId}&status=success&amount=${amount}`;

      // Tạo QR code cho URL thanh toán
      const qrCodeDataURL = await this.generateQRCode(fallbackUrl);

      return {
        code: '01', // Dùng code "01" cho thanh toán dự phòng
        message: 'Sử dụng URL thanh toán dự phòng',
        data: fallbackUrl,
        qr_code: qrCodeDataURL
      };
    } catch (error) {
      // Đảm bảo luôn trả về kết quả hợp lệ
      const baseUrl = SITE_CONFIG.baseUrl;
      const emergencyUrl = `${baseUrl}/payment-result?orderId=${orderId}&status=success&amount=${amount}`;

      return {
        code: '01',
        message: 'Sử dụng URL thanh toán dự phòng khẩn cấp',
        data: emergencyUrl,
        qr_code: null
      };
    }
  }

  // Tạo mã QR cho URL thanh toán
  static async generateQRCode(text) {
    try {
      if (!text) {
        return null;
      }

      // Tạo QR code dạng data URL
      const qrCodeDataURL = await _qrcode.default.toDataURL(text, {
        width: 300,
        margin: 2,
        errorCorrectionLevel: 'H'
      });
      return qrCodeDataURL;
    } catch (error) {
      // Tiếp tục mà không ném lỗi - chỉ trả về null nếu không thể tạo QR
      return null;
    }
  }

  // Xử lý callback từ SePay
  static verifySePayCallback(callbackData) {
    try {
      if (!callbackData) {
        return false;
      }

      // Xác thực thông tin callback từ SePay
      const { resultCode, amount, orderId, signature } = callbackData;

      // Kiểm tra các trường bắt buộc
      if (!orderId || !resultCode) {
        return false;
      }

      // Kiểm tra chữ ký nếu SePay cung cấp
      if (signature) {
        // Tạo chuỗi dữ liệu cần xác thực
        const dataToVerify = `${orderId}|${amount}|${resultCode}`;

        // Tạo chữ ký dựa trên secret key SePay
        const expectedSignature = _crypto.default.
        createHmac('sha256', process.env.SEPAY_API_TOKEN).
        update(dataToVerify).
        digest('hex');

        // So sánh chữ ký
        if (signature !== expectedSignature) {
          return false;
        }
      }

      // Nếu không có lỗi và kiểm tra chữ ký thành công, trả về true
      return true;
    } catch (error) {
      // Trong trường hợp có lỗi, trả về false
      return false;
    }
  }

  // Hàm hỗ trợ sắp xếp object
  static sortObject(obj) {
    return Object.keys(obj).sort().reduce((result, key) => {
      result[key] = obj[key];
      return result;
    }, {});
  }

  // Lưu lại lịch sử webhook
  static logWebhook(data) {
    try {
      // Nếu có order_id hoặc orderId, kiểm tra và cập nhật đơn hàng
      const orderId = data.order_id || data.orderId;
      if (orderId) {
        // Trong triển khai thực tế, bạn sẽ lưu webhook vào database
        // Ví dụ: Lưu vào bảng PaymentLogs, WebhookLogs...

        // Lưu trữ tạm thời vào bộ nhớ (chỉ cho phát triển)
        if (!global.webhookHistory) {
          global.webhookHistory = [];
        }

        global.webhookHistory.push({
          timestamp: new Date(),
          orderId: orderId,
          data: data
        });

        // Giới hạn số lượng webhook lưu trong bộ nhớ
        if (global.webhookHistory.length > 100) {
          global.webhookHistory.shift();
        }
      }
    } catch (error) {
      console.error("Error logging webhook:", error);
    }
  }

  // Tạo QR Code thanh toán ngân hàng sử dụng SePay
  static generateBankQRCode(accountNumber, bankCode, amount, description) {
    try {
      // Validate input
      if (!accountNumber || !bankCode) {
        return null;
      }

      // Chuẩn hóa mã ngân hàng để đảm bảo tương thích với Napas 247
      const normalizedBankCode = this.normalizeBankCode(bankCode);

      // Trích xuất orderId từ description
      let orderId = '';
      if (description) {
        const idMatch = description.match(/([a-f0-9]{24})/i);
        if (idMatch && idMatch[1]) {
          orderId = idMatch[1];
        }
      }

      // Tạo nội dung chuyển khoản cực kỳ đơn giản - CHỈ CÓ ID
      // Bỏ qua "TT DH" và các text khác để đảm bảo không có vấn đề khi nhận diện
      const simpleDescription = orderId || description;

      // Tạo URL QR Code với định dạng tương thích Napas 247
      let qrUrl = `https://qr.sepay.vn/img?acc=${accountNumber}&bank=${normalizedBankCode}`;

      // Thêm số tiền nếu có
      if (amount && amount > 0) {
        qrUrl += `&amount=${amount}`;
      }

      // Thêm nội dung chuyển khoản - CHỈ LÀ ID không thêm bất kỳ prefix nào
      qrUrl += `&des=${simpleDescription}`;

      return qrUrl;
    } catch (error) {
      console.error("Lỗi tạo QR code ngân hàng:", error);
      return null;
    }
  }

  // Hàm chuẩn hóa mã ngân hàng cho Napas 247
  static normalizeBankCode(bankCode) {
    // Bảng ánh xạ mã ngân hàng thường gặp sang mã Napas 247
    const bankMapping = {
      'MBBank': 'MB',
      'Techcombank': 'TCB',
      'Vietcombank': 'VCB',
      'VietinBank': 'CTG',
      'BIDV': 'BIDV',
      'Agribank': 'AGR',
      'TPBank': 'TPB',
      'VPBank': 'VPB',
      'ACB': 'ACB',
      'OCB': 'OCB',
      'SHB': 'SHB'
    };

    // Kiểm tra nếu bankCode cần được ánh xạ
    if (bankMapping[bankCode]) {
      return bankMapping[bankCode];
    }

    // Nếu không tìm thấy trong bảng ánh xạ, trả về mã gốc
    return bankCode;
  }
}var _default = exports.default =

PaymentService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wYXltZW50Q29uZmlnIiwiX3FyY29kZSIsIl9jcnlwdG8iLCJfZG90ZW52IiwiZG90ZW52IiwiY29uZmlnIiwiaXNEZXZlbG9wbWVudCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlNJVEVfQ09ORklHIiwiYmFzZVVybCIsImFwaVVybCIsIlBheW1lbnRTZXJ2aWNlIiwiY3JlYXRlU2VQYXlQYXltZW50Iiwib3JkZXJJZCIsImFtb3VudCIsIm9yZGVySW5mbyIsImN1c3RvbVJlZGlyZWN0VXJsIiwicmV0dXJuVXJsIiwibmdyb2tVcmwiLCJOR1JPS19VUkwiLCJhcGlCYXNlVXJsIiwibm90aWZ5VXJsIiwicmVxdWVzdERhdGEiLCJtZXJjaGFudElkIiwiU0VQQVkiLCJ0b1N0cmluZyIsInBhcnNlSW50IiwiaW5jbHVkZXMiLCJleHBpcmVUaW1lIiwicXJFeHBpcmVUaW1lIiwicmVzcG9uc2UiLCJheGlvcyIsInBvc3QiLCJTRVBBWV9BUElfVVJMIiwiaGVhZGVycyIsIlNFUEFZX0FQSV9UT0tFTiIsInRpbWVvdXQiLCJkYXRhIiwiY29kZSIsInFyQ29kZURhdGFVUkwiLCJnZW5lcmF0ZVFSQ29kZSIsIm1lc3NhZ2UiLCJxcl9jb2RlIiwiRXJyb3IiLCJlcnJvciIsImNyZWF0ZUZhbGxiYWNrUGF5bWVudCIsImZhbGxiYWNrVXJsIiwiZW1lcmdlbmN5VXJsIiwidGV4dCIsIlFSQ29kZSIsInRvRGF0YVVSTCIsIndpZHRoIiwibWFyZ2luIiwiZXJyb3JDb3JyZWN0aW9uTGV2ZWwiLCJ2ZXJpZnlTZVBheUNhbGxiYWNrIiwiY2FsbGJhY2tEYXRhIiwicmVzdWx0Q29kZSIsInNpZ25hdHVyZSIsImRhdGFUb1ZlcmlmeSIsImV4cGVjdGVkU2lnbmF0dXJlIiwiY3J5cHRvIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsInNvcnRPYmplY3QiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwic29ydCIsInJlZHVjZSIsInJlc3VsdCIsImtleSIsImxvZ1dlYmhvb2siLCJvcmRlcl9pZCIsImdsb2JhbCIsIndlYmhvb2tIaXN0b3J5IiwicHVzaCIsInRpbWVzdGFtcCIsIkRhdGUiLCJsZW5ndGgiLCJzaGlmdCIsImNvbnNvbGUiLCJnZW5lcmF0ZUJhbmtRUkNvZGUiLCJhY2NvdW50TnVtYmVyIiwiYmFua0NvZGUiLCJkZXNjcmlwdGlvbiIsIm5vcm1hbGl6ZWRCYW5rQ29kZSIsIm5vcm1hbGl6ZUJhbmtDb2RlIiwiaWRNYXRjaCIsIm1hdGNoIiwic2ltcGxlRGVzY3JpcHRpb24iLCJxclVybCIsImJhbmtNYXBwaW5nIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TZXJ2aWNlcy9wYXltZW50U2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xyXG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xyXG5pbXBvcnQgeyBTRVBBWSB9IGZyb20gJy4uL2NvbmZpZy9wYXltZW50Q29uZmlnLmpzJztcclxuaW1wb3J0IFFSQ29kZSBmcm9tICdxcmNvZGUnO1xyXG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSAnZG90ZW52JztcclxuXHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbi8vIFRow6ptIGJp4bq/biBtw7RpIHRyxrDhu51uZyBjaG8gZG9tYWluXHJcbmNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nO1xyXG5jb25zdCBTSVRFX0NPTkZJRyA9IHtcclxuICAgIGJhc2VVcmw6IGlzRGV2ZWxvcG1lbnQgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiIDogXCJodHRwczovL3F1YW5seXRodWNwaGFtLnZlcmNlbC5hcHBcIixcclxuICAgIGFwaVVybDogaXNEZXZlbG9wbWVudCA/IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwXCIgOiBcImh0dHBzOi8vcXVhbmx5dGh1Y3BoYW0tYXpmNi52ZXJjZWwuYXBwXCJcclxufTtcclxuXHJcbmNsYXNzIFBheW1lbnRTZXJ2aWNlIHtcclxuICAgIC8vIFNlUGF5IFBheW1lbnRcclxuICAgIHN0YXRpYyBhc3luYyBjcmVhdGVTZVBheVBheW1lbnQob3JkZXJJZCwgYW1vdW50LCBvcmRlckluZm8sIGN1c3RvbVJlZGlyZWN0VXJsID0gbnVsbCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIEPhuqV1IGjDrG5oIGVuZHBvaW50cyBjYWxsYmFja1xyXG4gICAgICAgICAgICAvLyBT4butIGThu6VuZyBjdXN0b21SZWRpcmVjdFVybCB04burIGNsaWVudCBu4bq/dSBjw7MsIG5nxrDhu6NjIGzhuqFpIGTDuW5nIFVSTCBt4bq3YyDEkeG7i25oXHJcbiAgICAgICAgICAgIGNvbnN0IHJldHVyblVybCA9IGN1c3RvbVJlZGlyZWN0VXJsIHx8IGAke1NJVEVfQ09ORklHLmJhc2VVcmx9L3BheW1lbnQtcmVzdWx0YDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIMavdSB0acOqbiBz4butIGThu6VuZyBOR1JPS19VUkwgbuG6v3UgY8OzIChjaG8gbcO0aSB0csaw4budbmcgcGjDoXQgdHJp4buDbiB24bubaSBuZ3JvaylcclxuICAgICAgICAgICAgY29uc3Qgbmdyb2tVcmwgPSBwcm9jZXNzLmVudi5OR1JPS19VUkw7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBT4butIGThu6VuZyDEkcaw4budbmcgZOG6q24gY2jDrW5oIHjDoWMgY+G7p2EgQVBJXHJcbiAgICAgICAgICAgIGNvbnN0IGFwaUJhc2VVcmwgPSBuZ3Jva1VybCB8fCAoaXNEZXZlbG9wbWVudCBcclxuICAgICAgICAgICAgICAgID8gXCJodHRwOi8vbG9jYWxob3N0OjgwODBcIiBcclxuICAgICAgICAgICAgICAgIDogXCJodHRwczovL3F1YW5seXRodWNwaGFtLWF6ZjYudmVyY2VsLmFwcFwiKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIMSQxrDhu51uZyBk4bqrbiB3ZWJob29rIFNlUGF5IGNow61uaCB4w6FjXHJcbiAgICAgICAgICAgIGNvbnN0IG5vdGlmeVVybCA9IGAke2FwaUJhc2VVcmx9L2FwaS9wYXltZW50cy93ZWJob29rL2JhbmtgO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBtZXJjaGFudElkOiBTRVBBWS5tZXJjaGFudElkLFxyXG4gICAgICAgICAgICAgICAgb3JkZXJJZDogb3JkZXJJZC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgYW1vdW50OiBwYXJzZUludChhbW91bnQpLFxyXG4gICAgICAgICAgICAgICAgb3JkZXJJbmZvOiBvcmRlckluZm8sXHJcbiAgICAgICAgICAgICAgICByZXR1cm5Vcmw6IGAke3JldHVyblVybH0ke3JldHVyblVybC5pbmNsdWRlcygnPycpID8gJyYnIDogJz8nfXN0YXR1cz1zdWNjZXNzJmFtb3VudD0ke2Ftb3VudH1gLFxyXG4gICAgICAgICAgICAgICAgbm90aWZ5VXJsOiBub3RpZnlVcmwsXHJcbiAgICAgICAgICAgICAgICBleHBpcmVUaW1lOiBTRVBBWS5xckV4cGlyZVRpbWUgLy8gVGjDqm0gdGjhu51pIGdpYW4gaOG6v3QgaOG6oW4gdOG7qyBjb25maWdcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEfhu41pIEFQSSBTZVBheSB0aOG7sWMgdOG7qyB04buHcCAuZW52XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52LlNFUEFZX0FQSV9VUkwsXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3Byb2Nlc3MuZW52LlNFUEFZX0FQSV9UT0tFTn1gXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwMCAvLyAzMCBnacOieVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5jb2RlID09PSAnMDAnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBU4bqhbyBRUiBjb2RlIGNobyBVUkwgdGhhbmggdG/DoW5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHFyQ29kZURhdGFVUkwgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUVJDb2RlKHJlc3BvbnNlLmRhdGEuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZTogcmVzcG9uc2UuZGF0YS5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLmRhdGEubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNwb25zZS5kYXRhLmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgcXJfY29kZTogcXJDb2RlRGF0YVVSTFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUGjhuqNuIGjhu5NpIGtow7RuZyB0aMOgbmggY8O0bmcgdOG7qyBTZVBheSBBUEk6ICR7cmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPyByZXNwb25zZS5kYXRhLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEzhu5dpIHThuqFvIHRoYW5oIHRvw6FuIFNlUGF5OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFThuqFvIFVSTCB0aGFuaCB0b8OhbiBk4buxIHBow7JuZ1xyXG4gICAgc3RhdGljIGFzeW5jIGNyZWF0ZUZhbGxiYWNrUGF5bWVudChvcmRlcklkLCBhbW91bnQsIG9yZGVySW5mbykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFPhu60gZOG7pW5nIFVSTCDEkeG7mW5nIGThu7FhIHbDoG8gbcO0aSB0csaw4budbmdcclxuICAgICAgICAgICAgY29uc3QgYmFzZVVybCA9IFNJVEVfQ09ORklHLmJhc2VVcmw7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVVJMIHRoYW5oIHRvw6FuIGThu7EgcGjDsm5nXHJcbiAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrVXJsID0gYCR7YmFzZVVybH0vcGF5bWVudC1yZXN1bHQ/b3JkZXJJZD0ke29yZGVySWR9JnN0YXR1cz1zdWNjZXNzJmFtb3VudD0ke2Ftb3VudH1gO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVOG6oW8gUVIgY29kZSBjaG8gVVJMIHRoYW5oIHRvw6FuXHJcbiAgICAgICAgICAgIGNvbnN0IHFyQ29kZURhdGFVUkwgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUVJDb2RlKGZhbGxiYWNrVXJsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBjb2RlOiAnMDEnLCAvLyBEw7luZyBjb2RlIFwiMDFcIiBjaG8gdGhhbmggdG/DoW4gZOG7sSBwaMOybmdcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdT4butIGThu6VuZyBVUkwgdGhhbmggdG/DoW4gZOG7sSBwaMOybmcnLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZmFsbGJhY2tVcmwsIFxyXG4gICAgICAgICAgICAgICAgcXJfY29kZTogcXJDb2RlRGF0YVVSTFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vIMSQ4bqjbSBi4bqjbyBsdcO0biB0cuG6oyB24buBIGvhur90IHF14bqjIGjhu6NwIGzhu4dcclxuICAgICAgICAgICAgY29uc3QgYmFzZVVybCA9IFNJVEVfQ09ORklHLmJhc2VVcmw7XHJcbiAgICAgICAgICAgIGNvbnN0IGVtZXJnZW5jeVVybCA9IGAke2Jhc2VVcmx9L3BheW1lbnQtcmVzdWx0P29yZGVySWQ9JHtvcmRlcklkfSZzdGF0dXM9c3VjY2VzcyZhbW91bnQ9JHthbW91bnR9YDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBjb2RlOiAnMDEnLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1Phu60gZOG7pW5nIFVSTCB0aGFuaCB0b8OhbiBk4buxIHBow7JuZyBraOG6qW4gY+G6pXAnLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZW1lcmdlbmN5VXJsLFxyXG4gICAgICAgICAgICAgICAgcXJfY29kZTogbnVsbFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBU4bqhbyBtw6MgUVIgY2hvIFVSTCB0aGFuaCB0b8OhblxyXG4gICAgc3RhdGljIGFzeW5jIGdlbmVyYXRlUVJDb2RlKHRleHQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBU4bqhbyBRUiBjb2RlIGThuqFuZyBkYXRhIFVSTFxyXG4gICAgICAgICAgICBjb25zdCBxckNvZGVEYXRhVVJMID0gYXdhaXQgUVJDb2RlLnRvRGF0YVVSTCh0ZXh0LCB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMzAwLFxyXG4gICAgICAgICAgICAgICAgbWFyZ2luOiAyLFxyXG4gICAgICAgICAgICAgICAgZXJyb3JDb3JyZWN0aW9uTGV2ZWw6ICdIJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHFyQ29kZURhdGFVUkw7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgLy8gVGnhur9wIHThu6VjIG3DoCBraMO0bmcgbsOpbSBs4buXaSAtIGNo4buJIHRy4bqjIHbhu4EgbnVsbCBu4bq/dSBraMO0bmcgdGjhu4MgdOG6oW8gUVJcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFjhu60gbMO9IGNhbGxiYWNrIHThu6sgU2VQYXlcclxuICAgIHN0YXRpYyB2ZXJpZnlTZVBheUNhbGxiYWNrKGNhbGxiYWNrRGF0YSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmICghY2FsbGJhY2tEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFjDoWMgdGjhu7FjIHRow7RuZyB0aW4gY2FsbGJhY2sgdOG7qyBTZVBheVxyXG4gICAgICAgICAgICBjb25zdCB7IHJlc3VsdENvZGUsIGFtb3VudCwgb3JkZXJJZCwgc2lnbmF0dXJlIH0gPSBjYWxsYmFja0RhdGE7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBLaeG7g20gdHJhIGPDoWMgdHLGsOG7nW5nIGLhuq90IGJ14buZY1xyXG4gICAgICAgICAgICBpZiAoIW9yZGVySWQgfHwgIXJlc3VsdENvZGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gS2nhu4NtIHRyYSBjaOG7ryBrw70gbuG6v3UgU2VQYXkgY3VuZyBj4bqlcFxyXG4gICAgICAgICAgICBpZiAoc2lnbmF0dXJlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBU4bqhbyBjaHXhu5dpIGThu68gbGnhu4d1IGPhuqduIHjDoWMgdGjhu7FjXHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhVG9WZXJpZnkgPSBgJHtvcmRlcklkfXwke2Ftb3VudH18JHtyZXN1bHRDb2RlfWA7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFThuqFvIGNo4buvIGvDvSBk4buxYSB0csOqbiBzZWNyZXQga2V5IFNlUGF5XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZFNpZ25hdHVyZSA9IGNyeXB0b1xyXG4gICAgICAgICAgICAgICAgICAgIC5jcmVhdGVIbWFjKCdzaGEyNTYnLCBwcm9jZXNzLmVudi5TRVBBWV9BUElfVE9LRU4pXHJcbiAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZShkYXRhVG9WZXJpZnkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmRpZ2VzdCgnaGV4Jyk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIFNvIHPDoW5oIGNo4buvIGvDvVxyXG4gICAgICAgICAgICAgICAgaWYgKHNpZ25hdHVyZSAhPT0gZXhwZWN0ZWRTaWduYXR1cmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIE7hur91IGtow7RuZyBjw7MgbOG7l2kgdsOgIGtp4buDbSB0cmEgY2jhu68ga8O9IHRow6BuaCBjw7RuZywgdHLhuqMgduG7gSB0cnVlXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vIFRyb25nIHRyxrDhu51uZyBo4bujcCBjw7MgbOG7l2ksIHRy4bqjIHbhu4EgZmFsc2VcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBIw6BtIGjhu5cgdHLhu6Mgc+G6r3AgeOG6v3Agb2JqZWN0XHJcbiAgICBzdGF0aWMgc29ydE9iamVjdChvYmopIHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5zb3J0KCkucmVkdWNlKChyZXN1bHQsIGtleSkgPT4ge1xyXG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IG9ialtrZXldO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0sIHt9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBMxrB1IGzhuqFpIGzhu4tjaCBz4butIHdlYmhvb2tcclxuICAgIHN0YXRpYyBsb2dXZWJob29rKGRhdGEpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBO4bq/dSBjw7Mgb3JkZXJfaWQgaG/hurdjIG9yZGVySWQsIGtp4buDbSB0cmEgdsOgIGPhuq1wIG5o4bqtdCDEkcahbiBow6BuZ1xyXG4gICAgICAgICAgICBjb25zdCBvcmRlcklkID0gZGF0YS5vcmRlcl9pZCB8fCBkYXRhLm9yZGVySWQ7XHJcbiAgICAgICAgICAgIGlmIChvcmRlcklkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUcm9uZyB0cmnhu4NuIGtoYWkgdGjhu7FjIHThur8sIGLhuqFuIHPhur0gbMawdSB3ZWJob29rIHbDoG8gZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgIC8vIFbDrSBk4bulOiBMxrB1IHbDoG8gYuG6o25nIFBheW1lbnRMb2dzLCBXZWJob29rTG9ncy4uLlxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBMxrB1IHRy4buvIHThuqFtIHRo4budaSB2w6BvIGLhu5kgbmjhu5sgKGNo4buJIGNobyBwaMOhdCB0cmnhu4NuKVxyXG4gICAgICAgICAgICAgICAgaWYgKCFnbG9iYWwud2ViaG9va0hpc3RvcnkpIHtcclxuICAgICAgICAgICAgICAgICAgICBnbG9iYWwud2ViaG9va0hpc3RvcnkgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZ2xvYmFsLndlYmhvb2tIaXN0b3J5LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgICAgICBvcmRlcklkOiBvcmRlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBHaeG7m2kgaOG6oW4gc+G7kSBsxrDhu6NuZyB3ZWJob29rIGzGsHUgdHJvbmcgYuG7mSBuaOG7m1xyXG4gICAgICAgICAgICAgICAgaWYgKGdsb2JhbC53ZWJob29rSGlzdG9yeS5sZW5ndGggPiAxMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBnbG9iYWwud2ViaG9va0hpc3Rvcnkuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2dnaW5nIHdlYmhvb2s6XCIsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVOG6oW8gUVIgQ29kZSB0aGFuaCB0b8OhbiBuZ8OibiBow6BuZyBz4butIGThu6VuZyBTZVBheVxyXG4gICAgc3RhdGljIGdlbmVyYXRlQmFua1FSQ29kZShhY2NvdW50TnVtYmVyLCBiYW5rQ29kZSwgYW1vdW50LCBkZXNjcmlwdGlvbikge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIGlucHV0XHJcbiAgICAgICAgICAgIGlmICghYWNjb3VudE51bWJlciB8fCAhYmFua0NvZGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDaHXhuqluIGjDs2EgbcOjIG5nw6JuIGjDoG5nIMSR4buDIMSR4bqjbSBi4bqjbyB0xrDGoW5nIHRow61jaCB24bubaSBOYXBhcyAyNDdcclxuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZEJhbmtDb2RlID0gdGhpcy5ub3JtYWxpemVCYW5rQ29kZShiYW5rQ29kZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUcsOtY2ggeHXhuqV0IG9yZGVySWQgdOG7qyBkZXNjcmlwdGlvblxyXG4gICAgICAgICAgICBsZXQgb3JkZXJJZCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAoZGVzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkTWF0Y2ggPSBkZXNjcmlwdGlvbi5tYXRjaCgvKFthLWYwLTldezI0fSkvaSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaWRNYXRjaCAmJiBpZE1hdGNoWzFdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJJZCA9IGlkTWF0Y2hbMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFThuqFvIG7hu5lpIGR1bmcgY2h1eeG7g24ga2hv4bqjbiBj4buxYyBr4buzIMSRxqFuIGdp4bqjbiAtIENI4buIIEPDkyBJRFxyXG4gICAgICAgICAgICAvLyBC4buPIHF1YSBcIlRUIERIXCIgdsOgIGPDoWMgdGV4dCBraMOhYyDEkeG7gyDEkeG6o20gYuG6o28ga2jDtG5nIGPDsyB24bqlbiDEkeG7gSBraGkgbmjhuq1uIGRp4buHblxyXG4gICAgICAgICAgICBjb25zdCBzaW1wbGVEZXNjcmlwdGlvbiA9IG9yZGVySWQgfHwgZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBU4bqhbyBVUkwgUVIgQ29kZSB24bubaSDEkeG7i25oIGThuqFuZyB0xrDGoW5nIHRow61jaCBOYXBhcyAyNDdcclxuICAgICAgICAgICAgbGV0IHFyVXJsID0gYGh0dHBzOi8vcXIuc2VwYXkudm4vaW1nP2FjYz0ke2FjY291bnROdW1iZXJ9JmJhbms9JHtub3JtYWxpemVkQmFua0NvZGV9YDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFRow6ptIHPhu5EgdGnhu4FuIG7hur91IGPDs1xyXG4gICAgICAgICAgICBpZiAoYW1vdW50ICYmIGFtb3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHFyVXJsICs9IGAmYW1vdW50PSR7YW1vdW50fWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFRow6ptIG7hu5lpIGR1bmcgY2h1eeG7g24ga2hv4bqjbiAtIENI4buIIEzDgCBJRCBraMO0bmcgdGjDqm0gYuG6pXQga+G7syBwcmVmaXggbsOgb1xyXG4gICAgICAgICAgICBxclVybCArPSBgJmRlcz0ke3NpbXBsZURlc2NyaXB0aW9ufWA7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gcXJVcmw7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkzhu5dpIHThuqFvIFFSIGNvZGUgbmfDom4gaMOgbmc6XCIsIGVycm9yKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEjDoG0gY2h14bqpbiBow7NhIG3DoyBuZ8OibiBow6BuZyBjaG8gTmFwYXMgMjQ3XHJcbiAgICBzdGF0aWMgbm9ybWFsaXplQmFua0NvZGUoYmFua0NvZGUpIHtcclxuICAgICAgICAvLyBC4bqjbmcgw6FuaCB44bqhIG3DoyBuZ8OibiBow6BuZyB0aMaw4budbmcgZ+G6t3Agc2FuZyBtw6MgTmFwYXMgMjQ3XHJcbiAgICAgICAgY29uc3QgYmFua01hcHBpbmcgPSB7XHJcbiAgICAgICAgICAgICdNQkJhbmsnOiAnTUInLFxyXG4gICAgICAgICAgICAnVGVjaGNvbWJhbmsnOiAnVENCJyxcclxuICAgICAgICAgICAgJ1ZpZXRjb21iYW5rJzogJ1ZDQicsXHJcbiAgICAgICAgICAgICdWaWV0aW5CYW5rJzogJ0NURycsXHJcbiAgICAgICAgICAgICdCSURWJzogJ0JJRFYnLFxyXG4gICAgICAgICAgICAnQWdyaWJhbmsnOiAnQUdSJyxcclxuICAgICAgICAgICAgJ1RQQmFuayc6ICdUUEInLFxyXG4gICAgICAgICAgICAnVlBCYW5rJzogJ1ZQQicsXHJcbiAgICAgICAgICAgICdBQ0InOiAnQUNCJyxcclxuICAgICAgICAgICAgJ09DQic6ICdPQ0InLFxyXG4gICAgICAgICAgICAnU0hCJzogJ1NIQidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBLaeG7g20gdHJhIG7hur91IGJhbmtDb2RlIGPhuqduIMSRxrDhu6NjIMOhbmggeOG6oVxyXG4gICAgICAgIGlmIChiYW5rTWFwcGluZ1tiYW5rQ29kZV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIGJhbmtNYXBwaW5nW2JhbmtDb2RlXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0cm9uZyBi4bqjbmcgw6FuaCB44bqhLCB0cuG6oyB24buBIG3DoyBn4buRY1xyXG4gICAgICAgIHJldHVybiBiYW5rQ29kZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUGF5bWVudFNlcnZpY2U7Il0sIm1hcHBpbmdzIjoiOztBQUVBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLGNBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE9BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLE9BQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQSxZQUE0QixDQU41QixvQ0FDQTs7QUFPQUssZUFBTSxDQUFDQyxNQUFNLENBQUMsQ0FBQzs7QUFFZjtBQUNBLE1BQU1DLGFBQWEsR0FBR0MsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxZQUFZO0FBQzNELE1BQU1DLFdBQVcsR0FBRztFQUNoQkMsT0FBTyxFQUFFTCxhQUFhLEdBQUcsdUJBQXVCLEdBQUcsbUNBQW1DO0VBQ3RGTSxNQUFNLEVBQUVOLGFBQWEsR0FBRyx1QkFBdUIsR0FBRztBQUN0RCxDQUFDOztBQUVELE1BQU1PLGNBQWMsQ0FBQztFQUNqQjtFQUNBLGFBQWFDLGtCQUFrQkEsQ0FBQ0MsT0FBTyxFQUFFQyxNQUFNLEVBQUVDLFNBQVMsRUFBRUMsaUJBQWlCLEdBQUcsSUFBSSxFQUFFO0lBQ2xGLElBQUk7TUFDQTtNQUNBO01BQ0EsTUFBTUMsU0FBUyxHQUFHRCxpQkFBaUIsSUFBSSxHQUFHUixXQUFXLENBQUNDLE9BQU8saUJBQWlCOztNQUU5RTtNQUNBLE1BQU1TLFFBQVEsR0FBR2IsT0FBTyxDQUFDQyxHQUFHLENBQUNhLFNBQVM7O01BRXRDO01BQ0EsTUFBTUMsVUFBVSxHQUFHRixRQUFRLEtBQUtkLGFBQWE7TUFDdkMsdUJBQXVCO01BQ3ZCLHdDQUF3QyxDQUFDOztNQUUvQztNQUNBLE1BQU1pQixTQUFTLEdBQUcs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