"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;

var _axios = _interopRequireDefault(require("axios"));
var _paymentConfig = require("../config/paymentConfig.js");
var _qrcode = _interopRequireDefault(require("qrcode"));
var _crypto = _interopRequireDefault(require("crypto"));
var _dotenv = _interopRequireDefault(require("dotenv"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };} /* eslint-disable no-unused-vars */ /* eslint-disable no-undef */

_dotenv.default.config();

// Thêm biến môi trường cho domain
const isDevelopment = process.env.NODE_ENV !== 'production';
const SITE_CONFIG = {
  baseUrl: isDevelopment ? "http://localhost:3000" : "https://quanlythucpham.vercel.app",
  apiUrl: isDevelopment ? "http://localhost:8080" : "https://quanlythucpham-azf6.vercel.app"
};

class PaymentService {
  // SePay Payment
  static async createSePayPayment(orderId, amount, orderInfo, customRedirectUrl = null) {
    try {
      // Cấu hình endpoints callback
      // Sử dụng customRedirectUrl từ client nếu có, ngược lại dùng URL mặc định
      const returnUrl = customRedirectUrl || `${SITE_CONFIG.baseUrl}/payment-result`;

      // Ưu tiên sử dụng NGROK_URL nếu có (cho môi trường phát triển với ngrok)
      const ngrokUrl = process.env.NGROK_URL;

      // Sử dụng đường dẫn chính xác của API
      const apiBaseUrl = ngrokUrl || (isDevelopment ?
      "http://localhost:8080" :
      "https://quanlythucpham-azf6.vercel.app");

      // Đường dẫn webhook SePay chính xác
      const notifyUrl = `${apiBaseUrl}/api/payments/webhook/bank`;

      const requestData = {
        merchantId: _paymentConfig.SEPAY.merchantId,
        orderId: orderId.toString(),
        amount: parseInt(amount),
        orderInfo: orderInfo,
        returnUrl: `${returnUrl}${returnUrl.includes('?') ? '&' : '?'}status=success&amount=${amount}`,
        notifyUrl: notifyUrl,
        expireTime: _paymentConfig.SEPAY.qrExpireTime // Thêm thời gian hết hạn từ config
      };

      // Gọi API SePay thực từ tệp .env
      const response = await _axios.default.post(
        process.env.SEPAY_API_URL,
        requestData,
        {
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${process.env.SEPAY_API_TOKEN}`
          },
          timeout: 30000 // 30 giây
        }
      );

      if (response.data && response.data.code === '00') {
        // Tạo QR code cho URL thanh toán
        const qrCodeDataURL = await this.generateQRCode(response.data.data);

        return {
          code: response.data.code,
          message: response.data.message,
          data: response.data.data,
          qr_code: qrCodeDataURL
        };
      } else {
        throw new Error(`Phản hồi không thành công từ SePay API: ${response.data && response.data.message ? response.data.message : 'Unknown error'}`);
      }
    } catch (error) {
      throw new Error(`Lỗi tạo thanh toán SePay: ${error.message}`);
    }
  }

  // Tạo URL thanh toán dự phòng
  static async createFallbackPayment(orderId, amount, orderInfo) {
    try {
      // Sử dụng URL động dựa vào môi trường
      const baseUrl = SITE_CONFIG.baseUrl;

      // URL thanh toán dự phòng
      const fallbackUrl = `${baseUrl}/payment-result?orderId=${orderId}&status=success&amount=${amount}`;

      // Tạo QR code cho URL thanh toán
      const qrCodeDataURL = await this.generateQRCode(fallbackUrl);

      return {
        code: '01', // Dùng code "01" cho thanh toán dự phòng
        message: 'Sử dụng URL thanh toán dự phòng',
        data: fallbackUrl,
        qr_code: qrCodeDataURL
      };
    } catch (error) {
      // Đảm bảo luôn trả về kết quả hợp lệ
      const baseUrl = SITE_CONFIG.baseUrl;
      const emergencyUrl = `${baseUrl}/payment-result?orderId=${orderId}&status=success&amount=${amount}`;

      return {
        code: '01',
        message: 'Sử dụng URL thanh toán dự phòng khẩn cấp',
        data: emergencyUrl,
        qr_code: null
      };
    }
  }

  // Tạo mã QR cho URL thanh toán
  static async generateQRCode(text) {
    try {
      if (!text) {
        return null;
      }

      // Tạo QR code dạng data URL
      const qrCodeDataURL = await _qrcode.default.toDataURL(text, {
        width: 300,
        margin: 2,
        errorCorrectionLevel: 'H'
      });
      return qrCodeDataURL;
    } catch (error) {
      // Tiếp tục mà không ném lỗi - chỉ trả về null nếu không thể tạo QR
      return null;
    }
  }

  // Xử lý callback từ SePay
  static verifySePayCallback(callbackData) {
    try {
      if (!callbackData) {
        return false;
      }

      // Xác thực thông tin callback từ SePay
      const { resultCode, amount, orderId, signature } = callbackData;

      // Kiểm tra các trường bắt buộc
      if (!orderId || !resultCode) {
        return false;
      }

      // Kiểm tra chữ ký nếu SePay cung cấp
      if (signature) {
        // Tạo chuỗi dữ liệu cần xác thực
        const dataToVerify = `${orderId}|${amount}|${resultCode}`;

        // Tạo chữ ký dựa trên secret key SePay
        const expectedSignature = _crypto.default.
        createHmac('sha256', process.env.SEPAY_API_TOKEN).
        update(dataToVerify).
        digest('hex');

        // So sánh chữ ký
        if (signature !== expectedSignature) {
          return false;
        }
      }

      // Nếu không có lỗi và kiểm tra chữ ký thành công, trả về true
      return true;
    } catch (error) {
      // Trong trường hợp có lỗi, trả về false
      return false;
    }
  }

  // Hàm hỗ trợ sắp xếp object
  static sortObject(obj) {
    return Object.keys(obj).sort().reduce((result, key) => {
      result[key] = obj[key];
      return result;
    }, {});
  }

  // Lưu lại lịch sử webhook
  static logWebhook(data) {
    try {
      // Nếu có order_id hoặc orderId, kiểm tra và cập nhật đơn hàng
      const orderId = data.order_id || data.orderId;
      if (orderId) {
        // Trong triển khai thực tế, bạn sẽ lưu webhook vào database
        // Ví dụ: Lưu vào bảng PaymentLogs, WebhookLogs...

        // Lưu trữ tạm thời vào bộ nhớ (chỉ cho phát triển)
        if (!global.webhookHistory) {
          global.webhookHistory = [];
        }

        global.webhookHistory.push({
          timestamp: new Date(),
          orderId: orderId,
          data: data
        });

        // Giới hạn số lượng webhook lưu trong bộ nhớ
        if (global.webhookHistory.length > 100) {
          global.webhookHistory.shift();
        }
      }
    } catch (error) {
      console.error("Error logging webhook:", error);
    }
  }

  // Tạo QR Code thanh toán ngân hàng sử dụng SePay
  static generateBankQRCode(accountNumber, bankCode, amount, description) {
    try {
      // Validate input
      if (!accountNumber || !bankCode) {
        return null;
      }

      // Chuẩn hóa mã ngân hàng để đảm bảo tương thích với Napas 247
      const normalizedBankCode = this.normalizeBankCode(bankCode);

      // Trích xuất orderId từ description
      let orderId = '';
      if (description) {
        const idMatch = description.match(/([a-f0-9]{24})/i);
        if (idMatch && idMatch[1]) {
          orderId = idMatch[1];
        }
      }

      // Tạo nội dung chuyển khoản cực kỳ đơn giản - CHỈ CÓ ID
      // Bỏ qua "TT DH" và các text khác để đảm bảo không có vấn đề khi nhận diện
      const simpleDescription = orderId || description;

      // Tạo URL QR Code với định dạng tương thích Napas 247
      let qrUrl = `https://qr.sepay.vn/img?acc=${accountNumber}&bank=${normalizedBankCode}`;

      // Thêm số tiền nếu có
      if (amount && amount > 0) {
        qrUrl += `&amount=${amount}`;
      }

      // Thêm nội dung chuyển khoản - CHỈ LÀ ID không thêm bất kỳ prefix nào
      qrUrl += `&des=${simpleDescription}`;

      return qrUrl;
    } catch (error) {
      console.error("Lỗi tạo QR code ngân hàng:", error);
      return null;
    }
  }

  // Hàm chuẩn hóa mã ngân hàng cho Napas 247
  static normalizeBankCode(bankCode) {
    // Bảng ánh xạ mã ngân hàng thường gặp sang mã Napas 247
    const bankMapping = {
      'MBBank': 'MB',
      'Techcombank': 'TCB',
      'Vietcombank': 'VCB',
      'VietinBank': 'CTG',
      'BIDV': 'BIDV',
      'Agribank': 'AGR',
      'TPBank': 'TPB',
      'VPBank': 'VPB',
      'ACB': 'ACB',
      'OCB': 'OCB',
      'SHB': 'SHB'
    };

    // Kiểm tra nếu bankCode cần được ánh xạ
    if (bankMapping[bankCode]) {
      return bankMapping[bankCode];
    }

    // Nếu không tìm thấy trong bảng ánh xạ, trả về mã gốc
    return bankCode;
  }
}var _default = exports.default =

PaymentService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wYXltZW50Q29uZmlnIiwiX3FyY29kZSIsIl9jcnlwdG8iLCJfZG90ZW52IiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiZG90ZW52IiwiY29uZmlnIiwiaXNEZXZlbG9wbWVudCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlNJVEVfQ09ORklHIiwiYmFzZVVybCIsImFwaVVybCIsIlBheW1lbnRTZXJ2aWNlIiwiY3JlYXRlU2VQYXlQYXltZW50Iiwib3JkZXJJZCIsImFtb3VudCIsIm9yZGVySW5mbyIsImN1c3RvbVJlZGlyZWN0VXJsIiwicmV0dXJuVXJsIiwibmdyb2tVcmwiLCJOR1JPS19VUkwiLCJhcGlCYXNlVXJsIiwibm90aWZ5VXJsIiwicmVxdWVzdERhdGEiLCJtZXJjaGFudElkIiwiU0VQQVkiLCJ0b1N0cmluZyIsInBhcnNlSW50IiwiaW5jbHVkZXMiLCJleHBpcmVUaW1lIiwicXJFeHBpcmVUaW1lIiwicmVzcG9uc2UiLCJheGlvcyIsInBvc3QiLCJTRVBBWV9BUElfVVJMIiwiaGVhZGVycyIsIlNFUEFZX0FQSV9UT0tFTiIsInRpbWVvdXQiLCJkYXRhIiwiY29kZSIsInFyQ29kZURhdGFVUkwiLCJnZW5lcmF0ZVFSQ29kZSIsIm1lc3NhZ2UiLCJxcl9jb2RlIiwiRXJyb3IiLCJlcnJvciIsImNyZWF0ZUZhbGxiYWNrUGF5bWVudCIsImZhbGxiYWNrVXJsIiwiZW1lcmdlbmN5VXJsIiwidGV4dCIsIlFSQ29kZSIsInRvRGF0YVVSTCIsIndpZHRoIiwibWFyZ2luIiwiZXJyb3JDb3JyZWN0aW9uTGV2ZWwiLCJ2ZXJpZnlTZVBheUNhbGxiYWNrIiwiY2FsbGJhY2tEYXRhIiwicmVzdWx0Q29kZSIsInNpZ25hdHVyZSIsImRhdGFUb1ZlcmlmeSIsImV4cGVjdGVkU2lnbmF0dXJlIiwiY3J5cHRvIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsInNvcnRPYmplY3QiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwic29ydCIsInJlZHVjZSIsInJlc3VsdCIsImtleSIsImxvZ1dlYmhvb2siLCJvcmRlcl9pZCIsImdsb2JhbCIsIndlYmhvb2tIaXN0b3J5IiwicHVzaCIsInRpbWVzdGFtcCIsIkRhdGUiLCJsZW5ndGgiLCJzaGlmdCIsImNvbnNvbGUiLCJnZW5lcmF0ZUJhbmtRUkNvZGUiLCJhY2NvdW50TnVtYmVyIiwiYmFua0NvZGUiLCJkZXNjcmlwdGlvbiIsIm5vcm1hbGl6ZWRCYW5rQ29kZSIsIm5vcm1hbGl6ZUJhbmtDb2RlIiwiaWRNYXRjaCIsIm1hdGNoIiwic2ltcGxlRGVzY3JpcHRpb24iLCJxclVybCIsImJhbmtNYXBwaW5nIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL1NlcnZpY2VzL3BheW1lbnRTZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IFNFUEFZIH0gZnJvbSAnLi4vY29uZmlnL3BheW1lbnRDb25maWcuanMnO1xuaW1wb3J0IFFSQ29kZSBmcm9tICdxcmNvZGUnO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IGRvdGVudiBmcm9tICdkb3RlbnYnO1xuXG5kb3RlbnYuY29uZmlnKCk7XG5cbi8vIFRow6ptIGJp4bq/biBtw7RpIHRyxrDhu51uZyBjaG8gZG9tYWluXG5jb25zdCBpc0RldmVsb3BtZW50ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJztcbmNvbnN0IFNJVEVfQ09ORklHID0ge1xuICAgIGJhc2VVcmw6IGlzRGV2ZWxvcG1lbnQgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiIDogXCJodHRwczovL3F1YW5seXRodWNwaGFtLnZlcmNlbC5hcHBcIixcbiAgICBhcGlVcmw6IGlzRGV2ZWxvcG1lbnQgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MFwiIDogXCJodHRwczovL3F1YW5seXRodWNwaGFtLWF6ZjYudmVyY2VsLmFwcFwiXG59O1xuXG5jbGFzcyBQYXltZW50U2VydmljZSB7XG4gICAgLy8gU2VQYXkgUGF5bWVudFxuICAgIHN0YXRpYyBhc3luYyBjcmVhdGVTZVBheVBheW1lbnQob3JkZXJJZCwgYW1vdW50LCBvcmRlckluZm8sIGN1c3RvbVJlZGlyZWN0VXJsID0gbnVsbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ+G6pXUgaMOsbmggZW5kcG9pbnRzIGNhbGxiYWNrXG4gICAgICAgICAgICAvLyBT4butIGThu6VuZyBjdXN0b21SZWRpcmVjdFVybCB04burIGNsaWVudCBu4bq/dSBjw7MsIG5nxrDhu6NjIGzhuqFpIGTDuW5nIFVSTCBt4bq3YyDEkeG7i25oXG4gICAgICAgICAgICBjb25zdCByZXR1cm5VcmwgPSBjdXN0b21SZWRpcmVjdFVybCB8fCBgJHtTSVRFX0NPTkZJRy5iYXNlVXJsfS9wYXltZW50LXJlc3VsdGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIMavdSB0acOqbiBz4butIGThu6VuZyBOR1JPS19VUkwgbuG6v3UgY8OzIChjaG8gbcO0aSB0csaw4budbmcgcGjDoXQgdHJp4buDbiB24bubaSBuZ3JvaylcbiAgICAgICAgICAgIGNvbnN0IG5ncm9rVXJsID0gcHJvY2Vzcy5lbnYuTkdST0tfVVJMO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBT4butIGThu6VuZyDEkcaw4budbmcgZOG6q24gY2jDrW5oIHjDoWMgY+G7p2EgQVBJXG4gICAgICAgICAgICBjb25zdCBhcGlCYXNlVXJsID0gbmdyb2tVcmwgfHwgKGlzRGV2ZWxvcG1lbnQgXG4gICAgICAgICAgICAgICAgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MFwiIFxuICAgICAgICAgICAgICAgIDogXCJodHRwczovL3F1YW5seXRodWNwaGFtLWF6ZjYudmVyY2VsLmFwcFwiKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gxJDGsOG7nW5nIGThuqtuIHdlYmhvb2sgU2VQYXkgY2jDrW5oIHjDoWNcbiAgICAgICAgICAgIGNvbnN0IG5vdGlmeVVybCA9IGAke2FwaUJhc2VVcmx9L2FwaS9wYXltZW50cy93ZWJob29rL2JhbmtgO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHtcbiAgICAgICAgICAgICAgICBtZXJjaGFudElkOiBTRVBBWS5tZXJjaGFudElkLFxuICAgICAgICAgICAgICAgIG9yZGVySWQ6IG9yZGVySWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBhbW91bnQ6IHBhcnNlSW50KGFtb3VudCksXG4gICAgICAgICAgICAgICAgb3JkZXJJbmZvOiBvcmRlckluZm8sXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsOiBgJHtyZXR1cm5Vcmx9JHtyZXR1cm5VcmwuaW5jbHVkZXMoJz8nKSA/ICcmJyA6ICc/J31zdGF0dXM9c3VjY2VzcyZhbW91bnQ9JHthbW91bnR9YCxcbiAgICAgICAgICAgICAgICBub3RpZnlVcmw6IG5vdGlmeVVybCxcbiAgICAgICAgICAgICAgICBleHBpcmVUaW1lOiBTRVBBWS5xckV4cGlyZVRpbWUgLy8gVGjDqm0gdGjhu51pIGdpYW4gaOG6v3QgaOG6oW4gdOG7qyBjb25maWdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEfhu41pIEFQSSBTZVBheSB0aOG7sWMgdOG7qyB04buHcCAuZW52XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuU0VQQVlfQVBJX1VSTCxcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtwcm9jZXNzLmVudi5TRVBBWV9BUElfVE9LRU59YFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwMCAvLyAzMCBnacOieVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gJzAwJykge1xuICAgICAgICAgICAgICAgIC8vIFThuqFvIFFSIGNvZGUgY2hvIFVSTCB0aGFuaCB0b8OhblxuICAgICAgICAgICAgICAgIGNvbnN0IHFyQ29kZURhdGFVUkwgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUVJDb2RlKHJlc3BvbnNlLmRhdGEuZGF0YSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogcmVzcG9uc2UuZGF0YS5jb2RlLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLmRhdGEuZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgcXJfY29kZTogcXJDb2RlRGF0YVVSTFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUGjhuqNuIGjhu5NpIGtow7RuZyB0aMOgbmggY8O0bmcgdOG7qyBTZVBheSBBUEk6ICR7cmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPyByZXNwb25zZS5kYXRhLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEzhu5dpIHThuqFvIHRoYW5oIHRvw6FuIFNlUGF5OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBU4bqhbyBVUkwgdGhhbmggdG/DoW4gZOG7sSBwaMOybmdcbiAgICBzdGF0aWMgYXN5bmMgY3JlYXRlRmFsbGJhY2tQYXltZW50KG9yZGVySWQsIGFtb3VudCwgb3JkZXJJbmZvKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBT4butIGThu6VuZyBVUkwgxJHhu5luZyBk4buxYSB2w6BvIG3DtGkgdHLGsOG7nW5nXG4gICAgICAgICAgICBjb25zdCBiYXNlVXJsID0gU0lURV9DT05GSUcuYmFzZVVybDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFVSTCB0aGFuaCB0b8OhbiBk4buxIHBow7JuZ1xuICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tVcmwgPSBgJHtiYXNlVXJsfS9wYXltZW50LXJlc3VsdD9vcmRlcklkPSR7b3JkZXJJZH0mc3RhdHVzPXN1Y2Nlc3MmYW1vdW50PSR7YW1vdW50fWA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFThuqFvIFFSIGNvZGUgY2hvIFVSTCB0aGFuaCB0b8OhblxuICAgICAgICAgICAgY29uc3QgcXJDb2RlRGF0YVVSTCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVRUkNvZGUoZmFsbGJhY2tVcmwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGNvZGU6ICcwMScsIC8vIETDuW5nIGNvZGUgXCIwMVwiIGNobyB0aGFuaCB0b8OhbiBk4buxIHBow7JuZ1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdT4butIGThu6VuZyBVUkwgdGhhbmggdG/DoW4gZOG7sSBwaMOybmcnLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZhbGxiYWNrVXJsLCBcbiAgICAgICAgICAgICAgICBxcl9jb2RlOiBxckNvZGVEYXRhVVJMXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgLy8gxJDhuqNtIGLhuqNvIGx1w7RuIHRy4bqjIHbhu4Ega+G6v3QgcXXhuqMgaOG7o3AgbOG7h1xuICAgICAgICAgICAgY29uc3QgYmFzZVVybCA9IFNJVEVfQ09ORklHLmJhc2VVcmw7XG4gICAgICAgICAgICBjb25zdCBlbWVyZ2VuY3lVcmwgPSBgJHtiYXNlVXJsfS9wYXltZW50LXJlc3VsdD9vcmRlcklkPSR7b3JkZXJJZH0mc3RhdHVzPXN1Y2Nlc3MmYW1vdW50PSR7YW1vdW50fWA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgY29kZTogJzAxJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU+G7rSBk4bulbmcgVVJMIHRoYW5oIHRvw6FuIGThu7EgcGjDsm5nIGto4bqpbiBj4bqlcCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZW1lcmdlbmN5VXJsLFxuICAgICAgICAgICAgICAgIHFyX2NvZGU6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBU4bqhbyBtw6MgUVIgY2hvIFVSTCB0aGFuaCB0b8OhblxuICAgIHN0YXRpYyBhc3luYyBnZW5lcmF0ZVFSQ29kZSh0ZXh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVOG6oW8gUVIgY29kZSBk4bqhbmcgZGF0YSBVUkxcbiAgICAgICAgICAgIGNvbnN0IHFyQ29kZURhdGFVUkwgPSBhd2FpdCBRUkNvZGUudG9EYXRhVVJMKHRleHQsIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogMzAwLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogMixcbiAgICAgICAgICAgICAgICBlcnJvckNvcnJlY3Rpb25MZXZlbDogJ0gnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBxckNvZGVEYXRhVVJMO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgLy8gVGnhur9wIHThu6VjIG3DoCBraMO0bmcgbsOpbSBs4buXaSAtIGNo4buJIHRy4bqjIHbhu4EgbnVsbCBu4bq/dSBraMO0bmcgdGjhu4MgdOG6oW8gUVJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gWOG7rSBsw70gY2FsbGJhY2sgdOG7qyBTZVBheVxuICAgIHN0YXRpYyB2ZXJpZnlTZVBheUNhbGxiYWNrKGNhbGxiYWNrRGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCFjYWxsYmFja0RhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFjDoWMgdGjhu7FjIHRow7RuZyB0aW4gY2FsbGJhY2sgdOG7qyBTZVBheVxuICAgICAgICAgICAgY29uc3QgeyByZXN1bHRDb2RlLCBhbW91bnQsIG9yZGVySWQsIHNpZ25hdHVyZSB9ID0gY2FsbGJhY2tEYXRhO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBLaeG7g20gdHJhIGPDoWMgdHLGsOG7nW5nIGLhuq90IGJ14buZY1xuICAgICAgICAgICAgaWYgKCFvcmRlcklkIHx8ICFyZXN1bHRDb2RlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBLaeG7g20gdHJhIGNo4buvIGvDvSBu4bq/dSBTZVBheSBjdW5nIGPhuqVwXG4gICAgICAgICAgICBpZiAoc2lnbmF0dXJlKSB7XG4gICAgICAgICAgICAgICAgLy8gVOG6oW8gY2h14buXaSBk4buvIGxp4buHdSBj4bqnbiB4w6FjIHRo4buxY1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFUb1ZlcmlmeSA9IGAke29yZGVySWR9fCR7YW1vdW50fXwke3Jlc3VsdENvZGV9YDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBU4bqhbyBjaOG7ryBrw70gZOG7sWEgdHLDqm4gc2VjcmV0IGtleSBTZVBheVxuICAgICAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlID0gY3J5cHRvXG4gICAgICAgICAgICAgICAgICAgIC5jcmVhdGVIbWFjKCdzaGEyNTYnLCBwcm9jZXNzLmVudi5TRVBBWV9BUElfVE9LRU4pXG4gICAgICAgICAgICAgICAgICAgIC51cGRhdGUoZGF0YVRvVmVyaWZ5KVxuICAgICAgICAgICAgICAgICAgICAuZGlnZXN0KCdoZXgnKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBTbyBzw6FuaCBjaOG7ryBrw71cbiAgICAgICAgICAgICAgICBpZiAoc2lnbmF0dXJlICE9PSBleHBlY3RlZFNpZ25hdHVyZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBO4bq/dSBraMO0bmcgY8OzIGzhu5dpIHbDoCBraeG7g20gdHJhIGNo4buvIGvDvSB0aMOgbmggY8O0bmcsIHRy4bqjIHbhu4EgdHJ1ZVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBUcm9uZyB0csaw4budbmcgaOG7o3AgY8OzIGzhu5dpLCB0cuG6oyB24buBIGZhbHNlXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBIw6BtIGjhu5cgdHLhu6Mgc+G6r3AgeOG6v3Agb2JqZWN0XG4gICAgc3RhdGljIHNvcnRPYmplY3Qob2JqKSB7XG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopLnNvcnQoKS5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IG9ialtrZXldO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSwge30pO1xuICAgIH1cblxuICAgIC8vIEzGsHUgbOG6oWkgbOG7i2NoIHPhu60gd2ViaG9va1xuICAgIHN0YXRpYyBsb2dXZWJob29rKGRhdGEpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIE7hur91IGPDsyBvcmRlcl9pZCBob+G6t2Mgb3JkZXJJZCwga2nhu4NtIHRyYSB2w6AgY+G6rXAgbmjhuq10IMSRxqFuIGjDoG5nXG4gICAgICAgICAgICBjb25zdCBvcmRlcklkID0gZGF0YS5vcmRlcl9pZCB8fCBkYXRhLm9yZGVySWQ7XG4gICAgICAgICAgICBpZiAob3JkZXJJZCkge1xuICAgICAgICAgICAgICAgIC8vIFRyb25nIHRyaeG7g24ga2hhaSB0aOG7sWMgdOG6vywgYuG6oW4gc+G6vSBsxrB1IHdlYmhvb2sgdsOgbyBkYXRhYmFzZVxuICAgICAgICAgICAgICAgIC8vIFbDrSBk4bulOiBMxrB1IHbDoG8gYuG6o25nIFBheW1lbnRMb2dzLCBXZWJob29rTG9ncy4uLlxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEzGsHUgdHLhu68gdOG6oW0gdGjhu51pIHbDoG8gYuG7mSBuaOG7myAoY2jhu4kgY2hvIHBow6F0IHRyaeG7g24pXG4gICAgICAgICAgICAgICAgaWYgKCFnbG9iYWwud2ViaG9va0hpc3RvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLndlYmhvb2tIaXN0b3J5ID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGdsb2JhbC53ZWJob29rSGlzdG9yeS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBvcmRlcklkOiBvcmRlcklkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gR2nhu5tpIGjhuqFuIHPhu5EgbMaw4bujbmcgd2ViaG9vayBsxrB1IHRyb25nIGLhu5kgbmjhu5tcbiAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLndlYmhvb2tIaXN0b3J5Lmxlbmd0aCA+IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICBnbG9iYWwud2ViaG9va0hpc3Rvcnkuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9nZ2luZyB3ZWJob29rOlwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBU4bqhbyBRUiBDb2RlIHRoYW5oIHRvw6FuIG5nw6JuIGjDoG5nIHPhu60gZOG7pW5nIFNlUGF5XG4gICAgc3RhdGljIGdlbmVyYXRlQmFua1FSQ29kZShhY2NvdW50TnVtYmVyLCBiYW5rQ29kZSwgYW1vdW50LCBkZXNjcmlwdGlvbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gVmFsaWRhdGUgaW5wdXRcbiAgICAgICAgICAgIGlmICghYWNjb3VudE51bWJlciB8fCAhYmFua0NvZGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2h14bqpbiBow7NhIG3DoyBuZ8OibiBow6BuZyDEkeG7gyDEkeG6o20gYuG6o28gdMawxqFuZyB0aMOtY2ggduG7m2kgTmFwYXMgMjQ3XG4gICAgICAgICAgICBjb25zdCBub3JtYWxpemVkQmFua0NvZGUgPSB0aGlzLm5vcm1hbGl6ZUJhbmtDb2RlKGJhbmtDb2RlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVHLDrWNoIHh14bqldCBvcmRlcklkIHThu6sgZGVzY3JpcHRpb25cbiAgICAgICAgICAgIGxldCBvcmRlcklkID0gJyc7XG4gICAgICAgICAgICBpZiAoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpZE1hdGNoID0gZGVzY3JpcHRpb24ubWF0Y2goLyhbYS1mMC05XXsyNH0pL2kpO1xuICAgICAgICAgICAgICAgIGlmIChpZE1hdGNoICYmIGlkTWF0Y2hbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJJZCA9IGlkTWF0Y2hbMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBU4bqhbyBu4buZaSBkdW5nIGNodXnhu4NuIGtob+G6o24gY+G7sWMga+G7syDEkcahbiBnaeG6o24gLSBDSOG7iCBDw5MgSURcbiAgICAgICAgICAgIC8vIELhu48gcXVhIFwiVFQgREhcIiB2w6AgY8OhYyB0ZXh0IGtow6FjIMSR4buDIMSR4bqjbSBi4bqjbyBraMO0bmcgY8OzIHbhuqVuIMSR4buBIGtoaSBuaOG6rW4gZGnhu4duXG4gICAgICAgICAgICBjb25zdCBzaW1wbGVEZXNjcmlwdGlvbiA9IG9yZGVySWQgfHwgZGVzY3JpcHRpb247XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFThuqFvIFVSTCBRUiBDb2RlIHbhu5tpIMSR4buLbmggZOG6oW5nIHTGsMahbmcgdGjDrWNoIE5hcGFzIDI0N1xuICAgICAgICAgICAgbGV0IHFyVXJsID0gYGh0dHBzOi8vcXIuc2VwYXkudm4vaW1nP2FjYz0ke2FjY291bnROdW1iZXJ9JmJhbms9JHtub3JtYWxpemVkQmFua0NvZGV9YDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVGjDqm0gc+G7kSB0aeG7gW4gbuG6v3UgY8OzXG4gICAgICAgICAgICBpZiAoYW1vdW50ICYmIGFtb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICBxclVybCArPSBgJmFtb3VudD0ke2Ftb3VudH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBUaMOqbSBu4buZaSBkdW5nIGNodXnhu4NuIGtob+G6o24gLSBDSOG7iCBMw4AgSUQga2jDtG5nIHRow6ptIGLhuqV0IGvhu7MgcHJlZml4IG7DoG9cbiAgICAgICAgICAgIHFyVXJsICs9IGAmZGVzPSR7c2ltcGxlRGVzY3JpcHRpb259YDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHFyVXJsO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkzhu5dpIHThuqFvIFFSIGNvZGUgbmfDom4gaMOgbmc6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gSMOgbSBjaHXhuqluIGjDs2EgbcOjIG5nw6JuIGjDoG5nIGNobyBOYXBhcyAyNDdcbiAgICBzdGF0aWMgbm9ybWFsaXplQmFua0NvZGUoYmFua0NvZGUpIHtcbiAgICAgICAgLy8gQuG6o25nIMOhbmggeOG6oSBtw6MgbmfDom4gaMOgbmcgdGjGsOG7nW5nIGfhurdwIHNhbmcgbcOjIE5hcGFzIDI0N1xuICAgICAgICBjb25zdCBiYW5rTWFwcGluZyA9IHtcbiAgICAgICAgICAgICdNQkJhbmsnOiAnTUInLFxuICAgICAgICAgICAgJ1RlY2hjb21iYW5rJzogJ1RDQicsXG4gICAgICAgICAgICAnVmlldGNvbWJhbmsnOiAnVkNCJyxcbiAgICAgICAgICAgICdWaWV0aW5CYW5rJzogJ0NURycsXG4gICAgICAgICAgICAnQklEVic6ICdCSURWJyxcbiAgICAgICAgICAgICdBZ3JpYmFuayc6ICdBR1InLFxuICAgICAgICAgICAgJ1RQQmFuayc6ICdUUEInLFxuICAgICAgICAgICAgJ1ZQQmFuayc6ICdWUEInLFxuICAgICAgICAgICAgJ0FDQic6ICdBQ0InLFxuICAgICAgICAgICAgJ09DQic6ICdPQ0InLFxuICAgICAgICAgICAgJ1NIQic6ICdTSEInXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gS2nhu4NtIHRyYSBu4bq/dSBiYW5rQ29kZSBj4bqnbiDEkcaw4bujYyDDoW5oIHjhuqFcbiAgICAgICAgaWYgKGJhbmtNYXBwaW5nW2JhbmtDb2RlXSkge1xuICAgICAgICAgICAgcmV0dXJuIGJhbmtNYXBwaW5nW2JhbmtDb2RlXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE7hur91IGtow7RuZyB0w6xtIHRo4bqleSB0cm9uZyBi4bqjbmcgw6FuaCB44bqhLCB0cuG6oyB24buBIG3DoyBn4buRY1xuICAgICAgICByZXR1cm4gYmFua0NvZGU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQYXltZW50U2VydmljZTsiXSwibWFwcGluZ3MiOiI7O0FBRUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsY0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsT0FBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsT0FBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBLFlBQTRCLFNBQUFELHVCQUFBTSxDQUFBLFVBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBLEtBTjVCLG9DQUNBOztBQU9BRyxlQUFNLENBQUNDLE1BQU0sQ0FBQyxDQUFDOztBQUVmO0FBQ0EsTUFBTUMsYUFBYSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLLFlBQVk7QUFDM0QsTUFBTUMsV0FBVyxHQUFHO0VB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