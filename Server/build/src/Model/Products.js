"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _mongoose = _interopRequireDefault(require("mongoose"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

const productSchema = new _mongoose.default.Schema(
  {
    productName: { type: String, required: true, trim: true },
    productPrice: { type: Number, required: true },
    productImages: { type: [String], default: [] },
    productCategory: { type: String, required: true, trim: true },
    productDescription: { type: [String], required: true },
    productBrand: { type: String, trim: true },
    productBrandId: { type: _mongoose.default.Schema.Types.ObjectId, ref: "Brand" },
    productSupplier: { type: String, trim: true },
    productSupplierId: { type: _mongoose.default.Schema.Types.ObjectId, ref: "Supplier" },
    productStatus: { type: String, trim: true },
    productDiscount: { type: Number, default: 0 },
    productInfo: { type: String, trim: true },
    productDetails: { type: String, trim: true },
    productStock: { type: Number, default: 0 },
    productCode: { type: String, trim: true },
    productWeight: { type: Number, default: 0 },
    productPromoPrice: { type: Number, default: 0 },
    productWarranty: { type: Number, default: 0 },
    productOrigin: { type: String, trim: true },
    productIntroduction: { type: String, trim: true },
    productUnit: { type: String, default: "gram", trim: true },
    discountStartDate: { type: Date, default: null },
    discountEndDate: { type: Date, default: null },
    expiryDate: { type: Date, default: null },
    soldCount: { type: Number, default: 0 },
    averageRating: { type: Number, default: 0 },
    numOfReviews: { type: Number, default: 0 }
  },
  { timestamps: true }
);

productSchema.methods.isDiscountActive = function () {
  if (!this.discountStartDate || !this.discountEndDate) {
    return this.productDiscount > 0;
  }

  const now = new Date();
  return (
    this.productDiscount > 0 &&
    now >= this.discountStartDate &&
    now <= this.discountEndDate);

};

productSchema.methods.toJSON = function () {
  const productObject = this.toObject();

  if (!this.isDiscountActive()) {
    productObject.productDiscount = 0;
    productObject.productPromoPrice = 0;
  }

  return productObject;
};

productSchema.methods.updateSoldCount = async function (quantity) {
  this.soldCount += quantity;
  await this.save();
};

productSchema.index({
  productName: "text",
  productInfo: "text",
  productCategory: "text",
  productBrand: "text",
  productCode: "text",
  productDescription: "text",
  productDetails: "text",
  productOrigin: "text"
});

const Product = _mongoose.default.model("Product", productSchema);var _default = exports.default =

Product;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInByb2R1Y3RTY2hlbWEiLCJtb25nb29zZSIsIlNjaGVtYSIsInByb2R1Y3ROYW1lIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsInByb2R1Y3RQcmljZSIsIk51bWJlciIsInByb2R1Y3RJbWFnZXMiLCJwcm9kdWN0Q2F0ZWdvcnkiLCJwcm9kdWN0RGVzY3JpcHRpb24iLCJwcm9kdWN0QnJhbmQiLCJwcm9kdWN0QnJhbmRJZCIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJwcm9kdWN0U3VwcGxpZXIiLCJwcm9kdWN0U3VwcGxpZXJJZCIsInByb2R1Y3RTdGF0dXMiLCJwcm9kdWN0RGlzY291bnQiLCJwcm9kdWN0SW5mbyIsInByb2R1Y3REZXRhaWxzIiwicHJvZHVjdFN0b2NrIiwicHJvZHVjdENvZGUiLCJwcm9kdWN0V2VpZ2h0IiwicHJvZHVjdFByb21vUHJpY2UiLCJwcm9kdWN0V2FycmFudHkiLCJwcm9kdWN0T3JpZ2luIiwicHJvZHVjdEludHJvZHVjdGlvbiIsInByb2R1Y3RVbml0IiwiZGlzY291bnRTdGFydERhdGUiLCJEYXRlIiwiZGlzY291bnRFbmREYXRlIiwiZXhwaXJ5RGF0ZSIsInNvbGRDb3VudCIsImF2ZXJhZ2VSYXRpbmciLCJudW1PZlJldmlld3MiLCJ0aW1lc3RhbXBzIiwibWV0aG9kcyIsImlzRGlzY291bnRBY3RpdmUiLCJub3ciLCJ0b0pTT04iLCJwcm9kdWN0T2JqZWN0IiwidG9PYmplY3QiLCJ1cGRhdGVTb2xkQ291bnQiLCJxdWFudGl0eSIsInNhdmUiLCJpbmRleCIsIlByb2R1Y3QiLCJtb2RlbCIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9Nb2RlbC9Qcm9kdWN0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5cbmNvbnN0IHByb2R1Y3RTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKFxuICB7XG4gICAgcHJvZHVjdE5hbWU6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSwgdHJpbTogdHJ1ZSB9LFxuICAgIHByb2R1Y3RQcmljZTogeyB0eXBlOiBOdW1iZXIsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgcHJvZHVjdEltYWdlczogeyB0eXBlOiBbU3RyaW5nXSwgZGVmYXVsdDogW10gfSxcbiAgICBwcm9kdWN0Q2F0ZWdvcnk6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSwgdHJpbTogdHJ1ZSB9LFxuICAgIHByb2R1Y3REZXNjcmlwdGlvbjogeyB0eXBlOiBbU3RyaW5nXSwgcmVxdWlyZWQ6IHRydWUgfSxcbiAgICBwcm9kdWN0QnJhbmQ6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgcHJvZHVjdEJyYW5kSWQ6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6IFwiQnJhbmRcIiB9LFxuICAgIHByb2R1Y3RTdXBwbGllcjogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBwcm9kdWN0U3VwcGxpZXJJZDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogXCJTdXBwbGllclwiIH0sXG4gICAgcHJvZHVjdFN0YXR1czogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBwcm9kdWN0RGlzY291bnQ6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gICAgcHJvZHVjdEluZm86IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgcHJvZHVjdERldGFpbHM6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgcHJvZHVjdFN0b2NrOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxuICAgIHByb2R1Y3RDb2RlOiB7IHR5cGU6IFN0cmluZywgdHJpbTogdHJ1ZSB9LFxuICAgIHByb2R1Y3RXZWlnaHQ6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gICAgcHJvZHVjdFByb21vUHJpY2U6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gICAgcHJvZHVjdFdhcnJhbnR5OiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxuICAgIHByb2R1Y3RPcmlnaW46IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgcHJvZHVjdEludHJvZHVjdGlvbjogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBwcm9kdWN0VW5pdDogeyB0eXBlOiBTdHJpbmcsIGRlZmF1bHQ6IFwiZ3JhbVwiLCB0cmltOiB0cnVlIH0sXG4gICAgZGlzY291bnRTdGFydERhdGU6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogbnVsbCB9LFxuICAgIGRpc2NvdW50RW5kRGF0ZTogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBudWxsIH0sXG4gICAgZXhwaXJ5RGF0ZTogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBudWxsIH0sXG4gICAgc29sZENvdW50OiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxuICAgIGF2ZXJhZ2VSYXRpbmc6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gICAgbnVtT2ZSZXZpZXdzOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxuICB9LFxuICB7IHRpbWVzdGFtcHM6IHRydWUgfVxuKTtcblxucHJvZHVjdFNjaGVtYS5tZXRob2RzLmlzRGlzY291bnRBY3RpdmUgPSBmdW5jdGlvbigpIHtcbiAgaWYgKCF0aGlzLmRpc2NvdW50U3RhcnREYXRlIHx8ICF0aGlzLmRpc2NvdW50RW5kRGF0ZSkge1xuICAgIHJldHVybiB0aGlzLnByb2R1Y3REaXNjb3VudCA+IDA7XG4gIH1cbiAgXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gIHJldHVybiAoXG4gICAgdGhpcy5wcm9kdWN0RGlzY291bnQgPiAwICYmIFxuICAgIG5vdyA+PSB0aGlzLmRpc2NvdW50U3RhcnREYXRlICYmIFxuICAgIG5vdyA8PSB0aGlzLmRpc2NvdW50RW5kRGF0ZVxuICApO1xufTtcblxucHJvZHVjdFNjaGVtYS5tZXRob2RzLnRvSlNPTiA9IGZ1bmN0aW9uKCkge1xuICBjb25zdCBwcm9kdWN0T2JqZWN0ID0gdGhpcy50b09iamVjdCgpO1xuICBcbiAgaWYgKCF0aGlzLmlzRGlzY291bnRBY3RpdmUoKSkge1xuICAgIHByb2R1Y3RPYmplY3QucHJvZHVjdERpc2NvdW50ID0gMDtcbiAgICBwcm9kdWN0T2JqZWN0LnByb2R1Y3RQcm9tb1ByaWNlID0gMDtcbiAgfVxuICBcbiAgcmV0dXJuIHByb2R1Y3RPYmplY3Q7XG59O1xuXG5wcm9kdWN0U2NoZW1hLm1ldGhvZHMudXBkYXRlU29sZENvdW50ID0gYXN5bmMgZnVuY3Rpb24ocXVhbnRpdHkpIHtcbiAgdGhpcy5zb2xkQ291bnQgKz0gcXVhbnRpdHk7XG4gIGF3YWl0IHRoaXMuc2F2ZSgpO1xufTtcblxucHJvZHVjdFNjaGVtYS5pbmRleCh7XG4gIHByb2R1Y3ROYW1lOiBcInRleHRcIixcbiAgcHJvZHVjdEluZm86IFwidGV4dFwiLFxuICBwcm9kdWN0Q2F0ZWdvcnk6IFwidGV4dFwiLFxuICBwcm9kdWN0QnJhbmQ6IFwidGV4dFwiLFxuICBwcm9kdWN0Q29kZTogXCJ0ZXh0XCIsXG4gIHByb2R1Y3REZXNjcmlwdGlvbjogXCJ0ZXh0XCIsXG4gIHByb2R1Y3REZXRhaWxzOiBcInRleHRcIixcbiAgcHJvZHVjdE9yaWdpbjogXCJ0ZXh0XCIsXG59KTtcblxuY29uc3QgUHJvZHVjdCA9IG1vbmdvb3NlLm1vZGVsKFwiUHJvZHVjdFwiLCBwcm9kdWN0U2NoZW1hKTtcblxuZXhwb3J0IGRlZmF1bHQgUHJvZHVjdDtcbiJdLCJtYXBwaW5ncyI6Im9HQUFBLElBQUFBLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQSxjQUFnQyxT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