"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _mongoose = _interopRequireDefault(require("mongoose"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}
const { Schema } = _mongoose.default;

// Schema cho một tin nhắn đơn lẻ trong cuộc hội thoại
const MessageItemSchema = new Schema({
  text: {
    type: String,
    required: true
  },
  sender: {
    type: String,
    enum: ['user', 'admin'],
    required: true
  },
  read: {
    type: Boolean,
    default: false
  },
  timestamp: {
    type: Date,
    default: Date.now
  }
});

// Schema chính cho cuộc hội thoại
const ConversationSchema = new Schema({
  userId: {
    type: Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  adminId: {
    type: Schema.Types.ObjectId,
    ref: 'User',
    default: null
  },
  messages: [MessageItemSchema],
  lastUpdated: {
    type: Date,
    default: Date.now
  },
  unreadCount: {
    type: Number,
    default: 0
  }
});

// Tự động cập nhật lastUpdated khi có tin nhắn mới
ConversationSchema.pre('save', function (next) {
  this.lastUpdated = new Date();
  next();
});

// Tạo model từ schema với tên collection cụ thể (để tránh xung đột)
const Conversation = _mongoose.default.model("Conversation", ConversationSchema, "conversations");var _default = exports.default =

Conversation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIlNjaGVtYSIsIm1vbmdvb3NlIiwiTWVzc2FnZUl0ZW1TY2hlbWEiLCJ0ZXh0IiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwic2VuZGVyIiwiZW51bSIsInJlYWQiLCJCb29sZWFuIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsIkNvbnZlcnNhdGlvblNjaGVtYSIsInVzZXJJZCIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJhZG1pbklkIiwibWVzc2FnZXMiLCJsYXN0VXBkYXRlZCIsInVucmVhZENvdW50IiwiTnVtYmVyIiwicHJlIiwibmV4dCIsIkNvbnZlcnNhdGlvbiIsIm1vZGVsIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL01vZGVsL01lc3NhZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlIGZyb20gXCJtb25nb29zZVwiO1xuY29uc3QgeyBTY2hlbWEgfSA9IG1vbmdvb3NlO1xuXG4vLyBTY2hlbWEgY2hvIG3hu5l0IHRpbiBuaOG6r24gxJHGoW4gbOG6uyB0cm9uZyBjdeG7mWMgaOG7mWkgdGhv4bqhaVxuY29uc3QgTWVzc2FnZUl0ZW1TY2hlbWEgPSBuZXcgU2NoZW1hKHtcbiAgdGV4dDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICBzZW5kZXI6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZW51bTogWyd1c2VyJywgJ2FkbWluJ10sXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgcmVhZDoge1xuICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgZGVmYXVsdDogZmFsc2VcbiAgfSxcbiAgdGltZXN0YW1wOiB7XG4gICAgdHlwZTogRGF0ZSxcbiAgICBkZWZhdWx0OiBEYXRlLm5vd1xuICB9XG59KTtcblxuLy8gU2NoZW1hIGNow61uaCBjaG8gY3Xhu5ljIGjhu5lpIHRob+G6oWlcbmNvbnN0IENvbnZlcnNhdGlvblNjaGVtYSA9IG5ldyBTY2hlbWEoe1xuICB1c2VySWQ6IHtcbiAgICB0eXBlOiBTY2hlbWEuVHlwZXMuT2JqZWN0SWQsXG4gICAgcmVmOiAnVXNlcicsXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgYWRtaW5JZDoge1xuICAgIHR5cGU6IFNjaGVtYS5UeXBlcy5PYmplY3RJZCxcbiAgICByZWY6ICdVc2VyJyxcbiAgICBkZWZhdWx0OiBudWxsXG4gIH0sXG4gIG1lc3NhZ2VzOiBbTWVzc2FnZUl0ZW1TY2hlbWFdLFxuICBsYXN0VXBkYXRlZDoge1xuICAgIHR5cGU6IERhdGUsXG4gICAgZGVmYXVsdDogRGF0ZS5ub3dcbiAgfSxcbiAgdW5yZWFkQ291bnQ6IHtcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgZGVmYXVsdDogMFxuICB9XG59KTtcblxuLy8gVOG7sSDEkeG7mW5nIGPhuq1wIG5o4bqtdCBsYXN0VXBkYXRlZCBraGkgY8OzIHRpbiBuaOG6r24gbeG7m2lcbkNvbnZlcnNhdGlvblNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7XG4gIHRoaXMubGFzdFVwZGF0ZWQgPSBuZXcgRGF0ZSgpO1xuICBuZXh0KCk7XG59KTtcblxuLy8gVOG6oW8gbW9kZWwgdOG7qyBzY2hlbWEgduG7m2kgdMOqbiBjb2xsZWN0aW9uIGPhu6UgdGjhu4MgKMSR4buDIHRyw6FuaCB4dW5nIMSR4buZdClcbmNvbnN0IENvbnZlcnNhdGlvbiA9IG1vbmdvb3NlLm1vZGVsKFwiQ29udmVyc2F0aW9uXCIsIENvbnZlcnNhdGlvblNjaGVtYSwgXCJjb252ZXJzYXRpb25zXCIpO1xuXG5leHBvcnQgZGVmYXVsdCBDb252ZXJzYXRpb247ICJdLCJtYXBwaW5ncyI6Im9HQUFBLElBQUFBLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQSxjQUFnQyxTQUFBRCx1QkFBQUUsQ0FBQSxVQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUMsVUFBQSxHQUFBRCxDQUFBLEtBQUFFLE9BQUEsRUFBQUYsQ0FBQTtBQUNoQyxNQUFNLEVBQUVHLE1BQU0sQ0FBQyxDQUFDLEdBQUdDLGlCQUFROztBQUUzQjtBQUNBLE1BQU1DLGlCQUFpQixHQUFHLElBQUlGLE1BQU0sQ0FBQztFQUNuQ0csSUFBSSxFQUFFO0lBQ0pDLElBQUksRUFBRUMsTUFBTTtJQUNaQyxRQUFRLEVBQUU7RUFDWixDQUFDO0VBQ0RDLE1BQU0sRUFBRTtJQUNOSCxJQUFJLEVBQUVDLE1BQU07SUFDWkcsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztJQUN2QkYsUUFBUSxFQUFFO0VBQ1osQ0FBQztFQUNERyxJQUFJLEVBQUU7SUFDSkwsSUFBSSxFQUFFTSxPQUFPO0lBQ2JYLE9BQU8sRUFBRTtFQUNYLENBQUM7RUFDRFksU0FBUyxFQUFFO0lBQ1RQLElBQUksRUFBRVEsSUFBSTtJQUNWYixPQUFPLEVBQUVhLElBQUksQ0FBQ0M7RUFDaEI7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRyxJQUFJZCxNQUFNLENBQUM7RUFDcENlLE1BQU0sRUFBRTtJQUNOWCxJQUFJLEVBQUVKLE1BQU0sQ0FBQ2dCLEtBQUssQ0FBQ0MsUUFBUTtJQUMzQkMsR0FBRyxFQUFFLE1BQU07SUFDWFosUUFBUSxFQUFFO0VBQ1osQ0FBQztFQUNEYSxPQUFPLEVBQUU7SUFDUGYsSUFBSSxFQUFFSixNQUFNLENBQUNnQixLQUFLLENBQUNDLFFBQVE7SUFDM0JDLEdBQUcsRUFBRSxNQUFNO0lBQ1huQixPQUFPLEVBQUU7RUFDWCxDQUFDO0VBQ0RxQixRQUFRLEVBQUUsQ0FBQ2xCLGlCQUFpQixDQUFDO0VBQzdCbUIsV0FBVyxFQUFFO0lBQ1hqQixJQUFJLEVBQUVRLElBQUk7SUFDVmIsT0FBTyxFQUFFYSxJQUFJLENBQUNDO0VBQ2hCLENBQUM7RUFDRFMsV0FBVyxFQUFFO0lBQ1hsQixJQUFJLEVBQUVtQixNQUFNO0lBQ1p4QixPQUFPLEVBQUU7RUFDWDtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBZSxrQkFBa0IsQ0FBQ1UsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFTQyxJQUFJLEVBQUU7RUFDNUMsSUFBSSxDQUFDSixXQUFXLEdBQUcsSUFBSVQsSUFBSSxDQUFDLENBQUM7RUFDN0JhLElBQUksQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxDQUFDOztBQUVGO0FBQ0EsTUFBTUMsWUFBWSxHQUFHekIsaUJBQVEsQ0FBQzBCLEtBQUssQ0FBQyxjQUFjLEVBQUViLGtCQUFrQixFQUFFLGVBQWUsQ0FBQyxDQUFDLElBQUFjLFFBQUEsR0FBQUMsT0FBQSxDQUFBOUIsT0FBQTs7QUFFMUUyQixZQUFZIiwiaWdub3JlTGlzdCI6W119