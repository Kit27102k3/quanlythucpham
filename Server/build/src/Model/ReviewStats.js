"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _mongoose = _interopRequireDefault(require("mongoose"));

const ReviewStatsSchema = new _mongoose.default.Schema(
  {
    productId: {
      type: _mongoose.default.Schema.Types.ObjectId,
      ref: "Product",
      required: true,
      unique: true
    },
    averageRating: {
      type: Number,
      default: 0,
      min: 0,
      max: 5
    },
    ratingDistribution: {
      1: { type: Number, default: 0 }, // 1 star count
      2: { type: Number, default: 0 }, // 2 star count
      3: { type: Number, default: 0 }, // 3 star count
      4: { type: Number, default: 0 }, // 4 star count
      5: { type: Number, default: 0 } // 5 star count
    },
    totalReviews: {
      type: Number,
      default: 0
    },
    verifiedReviews: {
      type: Number,
      default: 0
    },
    lastUpdated: {
      type: Date,
      default: Date.now
    }
  },
  { timestamps: true }
);

// Tạo index cho việc tìm kiếm nhanh hơn
ReviewStatsSchema.index({ productId: 1 });
ReviewStatsSchema.index({ averageRating: -1 });
ReviewStatsSchema.index({ totalReviews: -1 });

// Static method để cập nhật thống kê đánh giá cho một sản phẩm
ReviewStatsSchema.statics.updateReviewStats = async function (productId) {
  try {
    // Lấy thông tin từ model Review
    const Review = _mongoose.default.model("Review");

    // Tìm tất cả đánh giá đã công khai cho sản phẩm này
    const reviews = await Review.find({
      productId: productId,
      isPublished: true
    });

    // Nếu không có đánh giá nào, xóa thống kê nếu tồn tại
    if (!reviews || reviews.length === 0) {
      await this.findOneAndDelete({ productId });
      // Cập nhật Product với averageRating = 0
      await _mongoose.default.model("Product").findByIdAndUpdate(productId, {
        averageRating: 0,
        numOfReviews: 0
      });
      return;
    }

    // Tính toán thống kê
    const totalReviews = reviews.length;
    const ratingSum = reviews.reduce((sum, review) => sum + review.rating, 0);
    const averageRating = ratingSum / totalReviews;
    const verifiedReviews = reviews.filter((review) => review.isVerified).length;

    // Tạo phân phối đánh giá
    const ratingDistribution = {
      1: 0, 2: 0, 3: 0, 4: 0, 5: 0
    };

    reviews.forEach((review) => {
      if (review.rating >= 1 && review.rating <= 5) {
        ratingDistribution[Math.floor(review.rating)]++;
      }
    });

    // Cập nhật hoặc tạo mới thống kê
    const stats = await this.findOneAndUpdate(
      { productId },
      {
        averageRating,
        ratingDistribution,
        totalReviews,
        verifiedReviews,
        lastUpdated: new Date()
      },
      { new: true, upsert: true }
    );

    // Cập nhật trực tiếp vào model Product
    await _mongoose.default.model("Product").findByIdAndUpdate(productId, {
      averageRating: averageRating,
      numOfReviews: totalReviews
    });

    return stats;
  } catch (error) {
    console.error("Lỗi khi cập nhật thống kê đánh giá:", error);
    throw error;
  }
};

// Tính toán thống kê theo thang điểm 5 sao
ReviewStatsSchema.methods.getStarPercentages = function () {
  const total = this.totalReviews || 1; // Tránh chia cho 0

  return {
    oneStar: Math.round(this.ratingDistribution[1] / total * 100),
    twoStar: Math.round(this.ratingDistribution[2] / total * 100),
    threeStar: Math.round(this.ratingDistribution[3] / total * 100),
    fourStar: Math.round(this.ratingDistribution[4] / total * 100),
    fiveStar: Math.round(this.ratingDistribution[5] / total * 100)
  };
};

// Middleware để tính toán đánh giá khi có sự thay đổi trong Review
ReviewStatsSchema.statics.recalculateStats = async function (productId) {
  return await this.updateReviewStats(productId);
};

const ReviewStats = _mongoose.default.model("ReviewStats", ReviewStatsSchema);var _default = exports.default =

ReviewStats;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIlJldmlld1N0YXRzU2NoZW1hIiwibW9uZ29vc2UiLCJTY2hlbWEiLCJwcm9kdWN0SWQiLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJlcXVpcmVkIiwidW5pcXVlIiwiYXZlcmFnZVJhdGluZyIsIk51bWJlciIsImRlZmF1bHQiLCJtaW4iLCJtYXgiLCJyYXRpbmdEaXN0cmlidXRpb24iLCJ0b3RhbFJldmlld3MiLCJ2ZXJpZmllZFJldmlld3MiLCJsYXN0VXBkYXRlZCIsIkRhdGUiLCJub3ciLCJ0aW1lc3RhbXBzIiwiaW5kZXgiLCJzdGF0aWNzIiwidXBkYXRlUmV2aWV3U3RhdHMiLCJSZXZpZXciLCJtb2RlbCIsInJldmlld3MiLCJmaW5kIiwiaXNQdWJsaXNoZWQiLCJsZW5ndGgiLCJmaW5kT25lQW5kRGVsZXRlIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJudW1PZlJldmlld3MiLCJyYXRpbmdTdW0iLCJyZWR1Y2UiLCJzdW0iLCJyZXZpZXciLCJyYXRpbmciLCJmaWx0ZXIiLCJpc1ZlcmlmaWVkIiwiZm9yRWFjaCIsIk1hdGgiLCJmbG9vciIsInN0YXRzIiwiZmluZE9uZUFuZFVwZGF0ZSIsIm5ldyIsInVwc2VydCIsImVycm9yIiwiY29uc29sZSIsIm1ldGhvZHMiLCJnZXRTdGFyUGVyY2VudGFnZXMiLCJ0b3RhbCIsIm9uZVN0YXIiLCJyb3VuZCIsInR3b1N0YXIiLCJ0aHJlZVN0YXIiLCJmb3VyU3RhciIsImZpdmVTdGFyIiwicmVjYWxjdWxhdGVTdGF0cyIsIlJldmlld1N0YXRzIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL01vZGVsL1Jldmlld1N0YXRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tIFwibW9uZ29vc2VcIjtcclxuXHJcbmNvbnN0IFJldmlld1N0YXRzU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYShcclxuICB7XHJcbiAgICBwcm9kdWN0SWQ6IHtcclxuICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICByZWY6IFwiUHJvZHVjdFwiLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgdW5pcXVlOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgYXZlcmFnZVJhdGluZzoge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIGRlZmF1bHQ6IDAsXHJcbiAgICAgIG1pbjogMCxcclxuICAgICAgbWF4OiA1XHJcbiAgICB9LFxyXG4gICAgcmF0aW5nRGlzdHJpYnV0aW9uOiB7XHJcbiAgICAgIDE6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sIC8vIDEgc3RhciBjb3VudFxyXG4gICAgICAyOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LCAvLyAyIHN0YXIgY291bnRcclxuICAgICAgMzogeyB0eXBlOiBOdW1iZXIsIGRlZmF1bHQ6IDAgfSwgLy8gMyBzdGFyIGNvdW50XHJcbiAgICAgIDQ6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sIC8vIDQgc3RhciBjb3VudFxyXG4gICAgICA1OiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9ICAvLyA1IHN0YXIgY291bnRcclxuICAgIH0sXHJcbiAgICB0b3RhbFJldmlld3M6IHtcclxuICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICBkZWZhdWx0OiAwXHJcbiAgICB9LFxyXG4gICAgdmVyaWZpZWRSZXZpZXdzOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgZGVmYXVsdDogMFxyXG4gICAgfSxcclxuICAgIGxhc3RVcGRhdGVkOiB7XHJcbiAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgICB9XHJcbiAgfSxcclxuICB7IHRpbWVzdGFtcHM6IHRydWUgfVxyXG4pO1xyXG5cclxuLy8gVOG6oW8gaW5kZXggY2hvIHZp4buHYyB0w6xtIGtp4bq/bSBuaGFuaCBoxqFuXHJcblJldmlld1N0YXRzU2NoZW1hLmluZGV4KHsgcHJvZHVjdElkOiAxIH0pO1xyXG5SZXZpZXdTdGF0c1NjaGVtYS5pbmRleCh7IGF2ZXJhZ2VSYXRpbmc6IC0xIH0pO1xyXG5SZXZpZXdTdGF0c1NjaGVtYS5pbmRleCh7IHRvdGFsUmV2aWV3czogLTEgfSk7XHJcblxyXG4vLyBTdGF0aWMgbWV0aG9kIMSR4buDIGPhuq1wIG5o4bqtdCB0aOG7kW5nIGvDqiDEkcOhbmggZ2nDoSBjaG8gbeG7mXQgc+G6o24gcGjhuqltXHJcblJldmlld1N0YXRzU2NoZW1hLnN0YXRpY3MudXBkYXRlUmV2aWV3U3RhdHMgPSBhc3luYyBmdW5jdGlvbihwcm9kdWN0SWQpIHtcclxuICB0cnkge1xyXG4gICAgLy8gTOG6pXkgdGjDtG5nIHRpbiB04burIG1vZGVsIFJldmlld1xyXG4gICAgY29uc3QgUmV2aWV3ID0gbW9uZ29vc2UubW9kZWwoXCJSZXZpZXdcIik7XHJcbiAgICBcclxuICAgIC8vIFTDrG0gdOG6pXQgY+G6oyDEkcOhbmggZ2nDoSDEkcOjIGPDtG5nIGtoYWkgY2hvIHPhuqNuIHBo4bqpbSBuw6B5XHJcbiAgICBjb25zdCByZXZpZXdzID0gYXdhaXQgUmV2aWV3LmZpbmQoe1xyXG4gICAgICBwcm9kdWN0SWQ6IHByb2R1Y3RJZCxcclxuICAgICAgaXNQdWJsaXNoZWQ6IHRydWVcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyBO4bq/dSBraMO0bmcgY8OzIMSRw6FuaCBnacOhIG7DoG8sIHjDs2EgdGjhu5FuZyBrw6ogbuG6v3UgdOG7k24gdOG6oWlcclxuICAgIGlmICghcmV2aWV3cyB8fCByZXZpZXdzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBhd2FpdCB0aGlzLmZpbmRPbmVBbmREZWxldGUoeyBwcm9kdWN0SWQgfSk7XHJcbiAgICAgIC8vIEPhuq1wIG5o4bqtdCBQcm9kdWN0IHbhu5tpIGF2ZXJhZ2VSYXRpbmcgPSAwXHJcbiAgICAgIGF3YWl0IG1vbmdvb3NlLm1vZGVsKFwiUHJvZHVjdFwiKS5maW5kQnlJZEFuZFVwZGF0ZShwcm9kdWN0SWQsIHtcclxuICAgICAgICBhdmVyYWdlUmF0aW5nOiAwLFxyXG4gICAgICAgIG51bU9mUmV2aWV3czogMFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBUw61uaCB0b8OhbiB0aOG7kW5nIGvDqlxyXG4gICAgY29uc3QgdG90YWxSZXZpZXdzID0gcmV2aWV3cy5sZW5ndGg7XHJcbiAgICBjb25zdCByYXRpbmdTdW0gPSByZXZpZXdzLnJlZHVjZSgoc3VtLCByZXZpZXcpID0+IHN1bSArIHJldmlldy5yYXRpbmcsIDApO1xyXG4gICAgY29uc3QgYXZlcmFnZVJhdGluZyA9IHJhdGluZ1N1bSAvIHRvdGFsUmV2aWV3cztcclxuICAgIGNvbnN0IHZlcmlmaWVkUmV2aWV3cyA9IHJldmlld3MuZmlsdGVyKHJldmlldyA9PiByZXZpZXcuaXNWZXJpZmllZCkubGVuZ3RoO1xyXG4gICAgXHJcbiAgICAvLyBU4bqhbyBwaMOibiBwaOG7kWkgxJHDoW5oIGdpw6FcclxuICAgIGNvbnN0IHJhdGluZ0Rpc3RyaWJ1dGlvbiA9IHtcclxuICAgICAgMTogMCwgMjogMCwgMzogMCwgNDogMCwgNTogMFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgIGlmIChyZXZpZXcucmF0aW5nID49IDEgJiYgcmV2aWV3LnJhdGluZyA8PSA1KSB7XHJcbiAgICAgICAgcmF0aW5nRGlzdHJpYnV0aW9uW01hdGguZmxvb3IocmV2aWV3LnJhdGluZyldKys7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvLyBD4bqtcCBuaOG6rXQgaG/hurdjIHThuqFvIG3hu5tpIHRo4buRbmcga8OqXHJcbiAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHRoaXMuZmluZE9uZUFuZFVwZGF0ZShcclxuICAgICAgeyBwcm9kdWN0SWQgfSxcclxuICAgICAge1xyXG4gICAgICAgIGF2ZXJhZ2VSYXRpbmcsXHJcbiAgICAgICAgcmF0aW5nRGlzdHJpYnV0aW9uLFxyXG4gICAgICAgIHRvdGFsUmV2aWV3cyxcclxuICAgICAgICB2ZXJpZmllZFJldmlld3MsXHJcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKClcclxuICAgICAgfSxcclxuICAgICAgeyBuZXc6IHRydWUsIHVwc2VydDogdHJ1ZSB9XHJcbiAgICApO1xyXG4gICAgXHJcbiAgICAvLyBD4bqtcCBuaOG6rXQgdHLhu7FjIHRp4bq/cCB2w6BvIG1vZGVsIFByb2R1Y3RcclxuICAgIGF3YWl0IG1vbmdvb3NlLm1vZGVsKFwiUHJvZHVjdFwiKS5maW5kQnlJZEFuZFVwZGF0ZShwcm9kdWN0SWQsIHtcclxuICAgICAgYXZlcmFnZVJhdGluZzogYXZlcmFnZVJhdGluZyxcclxuICAgICAgbnVtT2ZSZXZpZXdzOiB0b3RhbFJldmlld3NcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICByZXR1cm4gc3RhdHM7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJM4buXaSBraGkgY+G6rXAgbmjhuq10IHRo4buRbmcga8OqIMSRw6FuaCBnacOhOlwiLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBUw61uaCB0b8OhbiB0aOG7kW5nIGvDqiB0aGVvIHRoYW5nIMSRaeG7g20gNSBzYW9cclxuUmV2aWV3U3RhdHNTY2hlbWEubWV0aG9kcy5nZXRTdGFyUGVyY2VudGFnZXMgPSBmdW5jdGlvbigpIHtcclxuICBjb25zdCB0b3RhbCA9IHRoaXMudG90YWxSZXZpZXdzIHx8IDE7IC8vIFRyw6FuaCBjaGlhIGNobyAwXHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIG9uZVN0YXI6IE1hdGgucm91bmQoKHRoaXMucmF0aW5nRGlzdHJpYnV0aW9uWzFdIC8gdG90YWwpICogMTAwKSxcclxuICAgIHR3b1N0YXI6IE1hdGgucm91bmQoKHRoaXMucmF0aW5nRGlzdHJpYnV0aW9uWzJdIC8gdG90YWwpICogMTAwKSxcclxuICAgIHRocmVlU3RhcjogTWF0aC5yb3VuZCgodGhpcy5yYXRpbmdEaXN0cmlidXRpb25bM10gLyB0b3RhbCkgKiAxMDApLFxyXG4gICAgZm91clN0YXI6IE1hdGgucm91bmQoKHRoaXMucmF0aW5nRGlzdHJpYnV0aW9uWzRdIC8gdG90YWwpICogMTAwKSxcclxuICAgIGZpdmVTdGFyOiBNYXRoLnJvdW5kKCh0aGlzLnJhdGluZ0Rpc3RyaWJ1dGlvbls1XSAvIHRvdGFsKSAqIDEwMClcclxuICB9O1xyXG59O1xyXG5cclxuLy8gTWlkZGxld2FyZSDEkeG7gyB0w61uaCB0b8OhbiDEkcOhbmggZ2nDoSBraGkgY8OzIHPhu7EgdGhheSDEkeG7lWkgdHJvbmcgUmV2aWV3XHJcblJldmlld1N0YXRzU2NoZW1hLnN0YXRpY3MucmVjYWxjdWxhdGVTdGF0cyA9IGFzeW5jIGZ1bmN0aW9uKHByb2R1Y3RJZCkge1xyXG4gIHJldHVybiBhd2FpdCB0aGlzLnVwZGF0ZVJldmlld1N0YXRzKHByb2R1Y3RJZCk7XHJcbn07XHJcblxyXG5jb25zdCBSZXZpZXdTdGF0cyA9IG1vbmdvb3NlLm1vZGVsKFwiUmV2aWV3U3RhdHNcIiwgUmV2aWV3U3RhdHNTY2hlbWEpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUmV2aWV3U3RhdHM7ICJdLCJtYXBwaW5ncyI6InlMQUFBLElBQUFBLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTs7QUFFQSxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJQyxpQkFBUSxDQUFDQyxNQUFNO0VBQzNDO0lBQ0VDLFNBQVMsRUFBRTtNQUNUQyxJQUFJLEVBQUVILGlCQUFRLENBQUNDLE1BQU0sQ0FBQ0csS0FBSyxDQUFDQyxRQUFRO01BQ3BDQyxHQUFHLEVBQUUsU0FBUztNQUNkQyxRQUFRLEVBQUUsSUFBSTtNQUNkQyxNQUFN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