"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _mongoose = _interopRequireDefault(require("mongoose"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

// Schema cho phản hồi đánh giá
const ReplySchema = new _mongoose.default.Schema({
  userId: {
    type: _mongoose.default.Schema.Types.ObjectId,
    ref: "User",
    required: true
  },
  adminId: {
    type: _mongoose.default.Schema.Types.ObjectId,
    ref: "Admin"
  },
  userName: {
    type: String,
    required: true
  },
  text: {
    type: String,
    required: true,
    trim: true
  },
  isAdmin: {
    type: Boolean,
    default: false
  }
}, { timestamps: true });

const ReviewSchema = new _mongoose.default.Schema(
  {
    userId: {
      type: _mongoose.default.Schema.Types.ObjectId,
      ref: "User",
      required: true
    },
    productId: {
      type: _mongoose.default.Schema.Types.ObjectId,
      ref: "Product",
      required: true
    },
    rating: {
      type: Number,
      required: true,
      min: 1,
      max: 5,
      default: 5
    },
    comment: {
      type: String,
      required: true,
      trim: true
    },
    userName: {
      type: String,
      required: true
    },
    userImage: {
      type: String,
      default: ""
    },
    isVerified: {
      type: Boolean,
      default: false
    }, // Người dùng đã mua sản phẩm chưa
    isPublished: {
      type: Boolean,
      default: true
    }, // Admin có thể ẩn đánh giá không phù hợp
    replies: [ReplySchema] // Mảng các phản hồi cho đánh giá này
  },
  { timestamps: true }
);

// Static method để tính điểm đánh giá trung bình cho một sản phẩm
ReviewSchema.statics.calculateAverageRating = async function (productId) {
  const result = await this.aggregate([
  {
    $match: {
      productId: new _mongoose.default.Types.ObjectId(productId),
      isPublished: true
    }
  },
  {
    $group: {
      _id: "$productId",
      averageRating: { $avg: "$rating" },
      numOfReviews: { $sum: 1 }
    }
  }]
  );

  try {
    if (result.length > 0) {
      await _mongoose.default.model("Product").findByIdAndUpdate(productId, {
        averageRating: result[0].averageRating,
        numOfReviews: result[0].numOfReviews
      });
    } else {
      await _mongoose.default.model("Product").findByIdAndUpdate(productId, {
        averageRating: 0,
        numOfReviews: 0
      });
    }

    // Cập nhật thống kê chi tiết trong ReviewStats
    // Sử dụng setTimeout để đảm bảo mô hình ReviewStats đã được đăng ký
    setTimeout(async () => {
      try {
        const ReviewStats = _mongoose.default.model("ReviewStats");
        await ReviewStats.recalculateStats(productId);
      } catch (err) {
        console.error("Không thể cập nhật ReviewStats:", err.message);
      }
    }, 0);
  } catch (error) {
    console.error("Lỗi khi cập nhật đánh giá trung bình:", error);
  }
};

// Middleware để tự động tính lại điểm đánh giá sau khi lưu review
ReviewSchema.post("save", function () {
  this.constructor.calculateAverageRating(this.productId);
});

// Middleware để tự động tính lại điểm đánh giá sau khi xóa review
ReviewSchema.post("remove", function () {
  this.constructor.calculateAverageRating(this.productId);
});

// Middleware để tự động tính lại điểm đánh giá sau khi cập nhật review
ReviewSchema.post("findOneAndUpdate", async function (doc) {
  if (doc) {
    await _mongoose.default.model("Review").calculateAverageRating(doc.productId);
  }
});

// Middleware để tự động tính lại điểm đánh giá sau khi thay đổi trạng thái public/private
ReviewSchema.pre("updateOne", async function () {
  const docToUpdate = await this.model.findOne(this.getQuery());
  if (docToUpdate) {
    // Lưu lại productId để sử dụng sau khi cập nhật
    this._productId = docToUpdate.productId;
  }
});

ReviewSchema.post("updateOne", async function () {
  if (this._productId) {
    await _mongoose.default.model("Review").calculateAverageRating(this._productId);
  }
});

const Review = _mongoose.default.model("Review", ReviewSchema);var _default = exports.default =

Review;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIlJlcGx5U2NoZW1hIiwibW9uZ29vc2UiLCJTY2hlbWEiLCJ1c2VySWQiLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJlcXVpcmVkIiwiYWRtaW5JZCIsInVzZXJOYW1lIiwiU3RyaW5nIiwidGV4dCIsInRyaW0iLCJpc0FkbWluIiwiQm9vbGVhbiIsInRpbWVzdGFtcHMiLCJSZXZpZXdTY2hlbWEiLCJwcm9kdWN0SWQiLCJyYXRpbmciLCJOdW1iZXIiLCJtaW4iLCJtYXgiLCJjb21tZW50IiwidXNlckltYWdlIiwiaXNWZXJpZmllZCIsImlzUHVibGlzaGVkIiwicmVwbGllcyIsInN0YXRpY3MiLCJjYWxjdWxhdGVBdmVyYWdlUmF0aW5nIiwicmVzdWx0IiwiYWdncmVnYXRlIiwiJG1hdGNoIiwiJGdyb3VwIiwiX2lkIiwiYXZlcmFnZVJhdGluZyIsIiRhdmciLCJudW1PZlJldmlld3MiLCIkc3VtIiwibGVuZ3RoIiwibW9kZWwiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsInNldFRpbWVvdXQiLCJSZXZpZXdTdGF0cyIsInJlY2FsY3VsYXRlU3RhdHMiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJtZXNzYWdlIiwicG9zdCIsImNvbnN0cnVjdG9yIiwiZG9jIiwicHJlIiwiZG9jVG9VcGRhdGUiLCJmaW5kT25lIiwiZ2V0UXVlcnkiLCJfcHJvZHVjdElkIiwiUmV2aWV3IiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL01vZGVsL1Jldmlldy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5cbi8vIFNjaGVtYSBjaG8gcGjhuqNuIGjhu5NpIMSRw6FuaCBnacOhXG5jb25zdCBSZXBseVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICB1c2VySWQ6IHsgXG4gICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCBcbiAgICByZWY6IFwiVXNlclwiLFxuICAgIHJlcXVpcmVkOiB0cnVlXG4gIH0sXG4gIGFkbWluSWQ6IHsgXG4gICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCBcbiAgICByZWY6IFwiQWRtaW5cIlxuICB9LFxuICB1c2VyTmFtZTogeyBcbiAgICB0eXBlOiBTdHJpbmcsIFxuICAgIHJlcXVpcmVkOiB0cnVlIFxuICB9LFxuICB0ZXh0OiB7IFxuICAgIHR5cGU6IFN0cmluZywgXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgdHJpbTogdHJ1ZSBcbiAgfSxcbiAgaXNBZG1pbjoge1xuICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgZGVmYXVsdDogZmFsc2VcbiAgfVxufSwgeyB0aW1lc3RhbXBzOiB0cnVlIH0pO1xuXG5jb25zdCBSZXZpZXdTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKFxuICB7XG4gICAgdXNlcklkOiB7IFxuICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCBcbiAgICAgIHJlZjogXCJVc2VyXCIsIFxuICAgICAgcmVxdWlyZWQ6IHRydWUgXG4gICAgfSxcbiAgICBwcm9kdWN0SWQ6IHsgXG4gICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIFxuICAgICAgcmVmOiBcIlByb2R1Y3RcIiwgXG4gICAgICByZXF1aXJlZDogdHJ1ZSBcbiAgICB9LFxuICAgIHJhdGluZzogeyBcbiAgICAgIHR5cGU6IE51bWJlciwgXG4gICAgICByZXF1aXJlZDogdHJ1ZSwgXG4gICAgICBtaW46IDEsIFxuICAgICAgbWF4OiA1LFxuICAgICAgZGVmYXVsdDogNVxuICAgIH0sXG4gICAgY29tbWVudDogeyBcbiAgICAgIHR5cGU6IFN0cmluZywgXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIHRyaW06IHRydWUgXG4gICAgfSxcbiAgICB1c2VyTmFtZTogeyBcbiAgICAgIHR5cGU6IFN0cmluZywgXG4gICAgICByZXF1aXJlZDogdHJ1ZSBcbiAgICB9LFxuICAgIHVzZXJJbWFnZTogeyBcbiAgICAgIHR5cGU6IFN0cmluZywgXG4gICAgICBkZWZhdWx0OiBcIlwiIFxuICAgIH0sXG4gICAgaXNWZXJpZmllZDogeyBcbiAgICAgIHR5cGU6IEJvb2xlYW4sIFxuICAgICAgZGVmYXVsdDogZmFsc2UgXG4gICAgfSwgLy8gTmfGsOG7nWkgZMO5bmcgxJHDoyBtdWEgc+G6o24gcGjhuqltIGNoxrBhXG4gICAgaXNQdWJsaXNoZWQ6IHsgXG4gICAgICB0eXBlOiBCb29sZWFuLCBcbiAgICAgIGRlZmF1bHQ6IHRydWUgXG4gICAgfSwgLy8gQWRtaW4gY8OzIHRo4buDIOG6qW4gxJHDoW5oIGdpw6Ega2jDtG5nIHBow7kgaOG7o3BcbiAgICByZXBsaWVzOiBbUmVwbHlTY2hlbWFdLCAvLyBN4bqjbmcgY8OhYyBwaOG6o24gaOG7k2kgY2hvIMSRw6FuaCBnacOhIG7DoHlcbiAgfSxcbiAgeyB0aW1lc3RhbXBzOiB0cnVlIH1cbik7XG5cbi8vIFN0YXRpYyBtZXRob2QgxJHhu4MgdMOtbmggxJFp4buDbSDEkcOhbmggZ2nDoSB0cnVuZyBiw6xuaCBjaG8gbeG7mXQgc+G6o24gcGjhuqltXG5SZXZpZXdTY2hlbWEuc3RhdGljcy5jYWxjdWxhdGVBdmVyYWdlUmF0aW5nID0gYXN5bmMgZnVuY3Rpb24gKHByb2R1Y3RJZCkge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFnZ3JlZ2F0ZShbXG4gICAge1xuICAgICAgJG1hdGNoOiB7IFxuICAgICAgICBwcm9kdWN0SWQ6IG5ldyBtb25nb29zZS5UeXBlcy5PYmplY3RJZChwcm9kdWN0SWQpLFxuICAgICAgICBpc1B1Ymxpc2hlZDogdHJ1ZVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgJGdyb3VwOiB7XG4gICAgICAgIF9pZDogXCIkcHJvZHVjdElkXCIsXG4gICAgICAgIGF2ZXJhZ2VSYXRpbmc6IHsgJGF2ZzogXCIkcmF0aW5nXCIgfSxcbiAgICAgICAgbnVtT2ZSZXZpZXdzOiB7ICRzdW06IDEgfVxuICAgICAgfVxuICAgIH1cbiAgXSk7XG5cbiAgdHJ5IHtcbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGF3YWl0IG1vbmdvb3NlLm1vZGVsKFwiUHJvZHVjdFwiKS5maW5kQnlJZEFuZFVwZGF0ZShwcm9kdWN0SWQsIHtcbiAgICAgICAgYXZlcmFnZVJhdGluZzogcmVzdWx0WzBdLmF2ZXJhZ2VSYXRpbmcsXG4gICAgICAgIG51bU9mUmV2aWV3czogcmVzdWx0WzBdLm51bU9mUmV2aWV3c1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IG1vbmdvb3NlLm1vZGVsKFwiUHJvZHVjdFwiKS5maW5kQnlJZEFuZFVwZGF0ZShwcm9kdWN0SWQsIHtcbiAgICAgICAgYXZlcmFnZVJhdGluZzogMCxcbiAgICAgICAgbnVtT2ZSZXZpZXdzOiAwXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ+G6rXAgbmjhuq10IHRo4buRbmcga8OqIGNoaSB0aeG6v3QgdHJvbmcgUmV2aWV3U3RhdHNcbiAgICAvLyBT4butIGThu6VuZyBzZXRUaW1lb3V0IMSR4buDIMSR4bqjbSBi4bqjbyBtw7QgaMOsbmggUmV2aWV3U3RhdHMgxJHDoyDEkcaw4bujYyDEkcSDbmcga8O9XG4gICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBSZXZpZXdTdGF0cyA9IG1vbmdvb3NlLm1vZGVsKFwiUmV2aWV3U3RhdHNcIik7XG4gICAgICAgIGF3YWl0IFJldmlld1N0YXRzLnJlY2FsY3VsYXRlU3RhdHMocHJvZHVjdElkKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiS2jDtG5nIHRo4buDIGPhuq1wIG5o4bqtdCBSZXZpZXdTdGF0czpcIiwgZXJyLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH0sIDApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJM4buXaSBraGkgY+G6rXAgbmjhuq10IMSRw6FuaCBnacOhIHRydW5nIGLDrG5oOlwiLCBlcnJvcik7XG4gIH1cbn07XG5cbi8vIE1pZGRsZXdhcmUgxJHhu4MgdOG7sSDEkeG7mW5nIHTDrW5oIGzhuqFpIMSRaeG7g20gxJHDoW5oIGdpw6Egc2F1IGtoaSBsxrB1IHJldmlld1xuUmV2aWV3U2NoZW1hLnBvc3QoXCJzYXZlXCIsIGZ1bmN0aW9uKCkge1xuICB0aGlzLmNvbnN0cnVjdG9yLmNhbGN1bGF0ZUF2ZXJhZ2VSYXRpbmcodGhpcy5wcm9kdWN0SWQpO1xufSk7XG5cbi8vIE1pZGRsZXdhcmUgxJHhu4MgdOG7sSDEkeG7mW5nIHTDrW5oIGzhuqFpIMSRaeG7g20gxJHDoW5oIGdpw6Egc2F1IGtoaSB4w7NhIHJldmlld1xuUmV2aWV3U2NoZW1hLnBvc3QoXCJyZW1vdmVcIiwgZnVuY3Rpb24oKSB7XG4gIHRoaXMuY29uc3RydWN0b3IuY2FsY3VsYXRlQXZlcmFnZVJhdGluZyh0aGlzLnByb2R1Y3RJZCk7XG59KTtcblxuLy8gTWlkZGxld2FyZSDEkeG7gyB04buxIMSR4buZbmcgdMOtbmggbOG6oWkgxJFp4buDbSDEkcOhbmggZ2nDoSBzYXUga2hpIGPhuq1wIG5o4bqtdCByZXZpZXdcblJldmlld1NjaGVtYS5wb3N0KFwiZmluZE9uZUFuZFVwZGF0ZVwiLCBhc3luYyBmdW5jdGlvbihkb2MpIHtcbiAgaWYgKGRvYykge1xuICAgIGF3YWl0IG1vbmdvb3NlLm1vZGVsKFwiUmV2aWV3XCIpLmNhbGN1bGF0ZUF2ZXJhZ2VSYXRpbmcoZG9jLnByb2R1Y3RJZCk7XG4gIH1cbn0pO1xuXG4vLyBNaWRkbGV3YXJlIMSR4buDIHThu7EgxJHhu5luZyB0w61uaCBs4bqhaSDEkWnhu4NtIMSRw6FuaCBnacOhIHNhdSBraGkgdGhheSDEkeG7lWkgdHLhuqFuZyB0aMOhaSBwdWJsaWMvcHJpdmF0ZVxuUmV2aWV3U2NoZW1hLnByZShcInVwZGF0ZU9uZVwiLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgY29uc3QgZG9jVG9VcGRhdGUgPSBhd2FpdCB0aGlzLm1vZGVsLmZpbmRPbmUodGhpcy5nZXRRdWVyeSgpKTtcbiAgaWYgKGRvY1RvVXBkYXRlKSB7XG4gICAgLy8gTMawdSBs4bqhaSBwcm9kdWN0SWQgxJHhu4Mgc+G7rSBk4bulbmcgc2F1IGtoaSBj4bqtcCBuaOG6rXRcbiAgICB0aGlzLl9wcm9kdWN0SWQgPSBkb2NUb1VwZGF0ZS5wcm9kdWN0SWQ7XG4gIH1cbn0pO1xuXG5SZXZpZXdTY2hlbWEucG9zdChcInVwZGF0ZU9uZVwiLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuX3Byb2R1Y3RJZCkge1xuICAgIGF3YWl0IG1vbmdvb3NlLm1vZGVsKFwiUmV2aWV3XCIpLmNhbGN1bGF0ZUF2ZXJhZ2VSYXRpbmcodGhpcy5fcHJvZHVjdElkKTtcbiAgfVxufSk7XG5cbmNvbnN0IFJldmlldyA9IG1vbmdvb3NlLm1vZGVsKFwiUmV2aWV3XCIsIFJldmlld1NjaGVtYSk7XG5cbmV4cG9ydCBkZWZhdWx0IFJldmlldzsgIl0sIm1hcHBpbmdzIjoib0dBQUEsSUFBQUEsU0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBLGNBQWdDLFNBQUFELHVCQUFBRSxDQUFBLFVBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBOztBQUVoQztBQUNBLE1BQU1HLFdBQVcsR0FBRyxJQUFJQyxpQkFBUSxDQUFDQyxNQUFNLENBQUM7RUFDdENDLE1BQU0sRUFBRTtJQUNOQyxJQUFJLEVBQUVILGlCQUFRLENBQUNDLE1BQU0sQ0FBQ0csS0FBSyxDQUFDQyxRQUFRO0lBQ3BDQyxHQUFHLEVBQUUsTUFBTTtJQUNYQyxRQUFRLEVBQUU7RUFDWixDQUFDO0VBQ0RDLE9BQU8sRUFBRTtJQUNQTCxJQUFJLEVBQUVILGlCQUFR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