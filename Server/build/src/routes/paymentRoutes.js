"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _express = _interopRequireDefault(require("express"));
var _paymentController = require("../Controller/paymentController.js");












var _Order = _interopRequireDefault(require("../Model/Order.js"));

const router = _express.default.Router();

// Route CRUD cơ bản
router.post("/", _paymentController.createPayment);
router.get("/", _paymentController.getAllPayments);
router.get("/:id", _paymentController.getPaymentById);
router.patch("/:id/status", _paymentController.updatePaymentStatus);
router.patch("/:id", _paymentController.updatePayment);
router.delete("/:id", _paymentController.deletePayment);

// Routes thanh toán
router.post("/sepay/create-payment-url", _paymentController.createSepayPaymentUrl);
router.post("/sepay/callback", _paymentController.handleSepayCallback);
router.post("/vnpay/create-payment-url", _paymentController.createVnpayPaymentUrl);

// Route cho QR code ngân hàng
router.post("/bank-qr", _paymentController.createBankQRCode);

// Route kiểm tra trạng thái thanh toán
router.get("/status/:orderId", _paymentController.checkPaymentStatus);

// Route cập nhật trạng thái thủ công
router.post("/update-status/:orderId", async (req, res) => {
  try {
    const { orderId } = req.params;
    const { status } = req.body;

    if (!orderId) {
      return res.status(400).json({
        success: false,
        message: "Missing orderId parameter"
      });
    }

    // Tìm đơn hàng
    const order = await _Order.default.findOne({
      $or: [
      { _id: orderId },
      { orderId: orderId }]

    });

    if (!order) {
      return res.status(404).json({
        success: false,
        message: "Order not found"
      });
    }

    // Cập nhật trạng thái
    order.paymentStatus = 'completed';
    order.isPaid = true;
    if (status) {
      order.status = status;
    } else if (order.status === 'pending') {
      order.status = 'processing';
    }

    await order.save();

    return res.json({
      success: true,
      message: "Order payment status updated successfully",
      data: { orderId: order._id, status: order.status, paymentStatus: order.paymentStatus }
    });
  } catch (error) {
    console.error("Error updating order status:", error);
    return res.status(500).json({
      success: false,
      message: "Error updating order status",
      error: error.message
    });
  }
});var _default = exports.default =

router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3BheW1lbnRDb250cm9sbGVyIiwiX09yZGVyIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJjcmVhdGVQYXltZW50IiwiZ2V0IiwiZ2V0QWxsUGF5bWVudHMiLCJnZXRQYXltZW50QnlJZCIsInBhdGNoIiwidXBkYXRlUGF5bWVudFN0YXR1cyIsInVwZGF0ZVBheW1lbnQiLCJkZWxldGUiLCJkZWxldGVQYXltZW50IiwiY3JlYXRlU2VwYXlQYXltZW50VXJsIiwiaGFuZGxlU2VwYXlDYWxsYmFjayIsImNyZWF0ZVZucGF5UGF5bWVudFVybCIsImNyZWF0ZUJhbmtRUkNvZGUiLCJjaGVja1BheW1lbnRTdGF0dXMiLCJyZXEiLCJyZXMiLCJvcmRlcklkIiwicGFyYW1zIiwic3RhdHVzIiwiYm9keSIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsIm9yZGVyIiwiT3JkZXIiLCJmaW5kT25lIiwiJG9yIiwiX2lkIiwicGF5bWVudFN0YXR1cyIsImlzUGFpZCIsInNhdmUiLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9yb3V0ZXMvcGF5bWVudFJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xyXG5pbXBvcnQge1xyXG4gIGNyZWF0ZVNlcGF5UGF5bWVudFVybCxcclxuICBoYW5kbGVTZXBheUNhbGxiYWNrLFxyXG4gIGNyZWF0ZVBheW1lbnQsXHJcbiAgZ2V0QWxsUGF5bWVudHMsXHJcbiAgZ2V0UGF5bWVudEJ5SWQsXHJcbiAgdXBkYXRlUGF5bWVudFN0YXR1cyxcclxuICBkZWxldGVQYXltZW50LFxyXG4gIGNyZWF0ZVZucGF5UGF5bWVudFVybCxcclxuICBjcmVhdGVCYW5rUVJDb2RlLFxyXG4gIGNoZWNrUGF5bWVudFN0YXR1cyxcclxuICB1cGRhdGVQYXltZW50XHJcbn0gZnJvbSBcIi4uL0NvbnRyb2xsZXIvcGF5bWVudENvbnRyb2xsZXIuanNcIjtcclxuaW1wb3J0IE9yZGVyIGZyb20gXCIuLi9Nb2RlbC9PcmRlci5qc1wiO1xyXG5cclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuXHJcbi8vIFJvdXRlIENSVUQgY8ahIGLhuqNuXHJcbnJvdXRlci5wb3N0KFwiL1wiLCBjcmVhdGVQYXltZW50KTtcclxucm91dGVyLmdldChcIi9cIiwgZ2V0QWxsUGF5bWVudHMpO1xyXG5yb3V0ZXIuZ2V0KFwiLzppZFwiLCBnZXRQYXltZW50QnlJZCk7XHJcbnJvdXRlci5wYXRjaChcIi86aWQvc3RhdHVzXCIsIHVwZGF0ZVBheW1lbnRTdGF0dXMpO1xyXG5yb3V0ZXIucGF0Y2goXCIvOmlkXCIsIHVwZGF0ZVBheW1lbnQpO1xyXG5yb3V0ZXIuZGVsZXRlKFwiLzppZFwiLCBkZWxldGVQYXltZW50KTtcclxuXHJcbi8vIFJvdXRlcyB0aGFuaCB0b8OhblxyXG5yb3V0ZXIucG9zdChcIi9zZXBheS9jcmVhdGUtcGF5bWVudC11cmxcIiwgY3JlYXRlU2VwYXlQYXltZW50VXJsKTtcclxucm91dGVyLnBvc3QoXCIvc2VwYXkvY2FsbGJhY2tcIiwgaGFuZGxlU2VwYXlDYWxsYmFjayk7XHJcbnJvdXRlci5wb3N0KFwiL3ZucGF5L2NyZWF0ZS1wYXltZW50LXVybFwiLCBjcmVhdGVWbnBheVBheW1lbnRVcmwpO1xyXG5cclxuLy8gUm91dGUgY2hvIFFSIGNvZGUgbmfDom4gaMOgbmdcclxucm91dGVyLnBvc3QoXCIvYmFuay1xclwiLCBjcmVhdGVCYW5rUVJDb2RlKTtcclxuXHJcbi8vIFJvdXRlIGtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSB0aGFuaCB0b8OhblxyXG5yb3V0ZXIuZ2V0KFwiL3N0YXR1cy86b3JkZXJJZFwiLCBjaGVja1BheW1lbnRTdGF0dXMpO1xyXG5cclxuLy8gUm91dGUgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgdGjhu6cgY8O0bmdcclxucm91dGVyLnBvc3QoXCIvdXBkYXRlLXN0YXR1cy86b3JkZXJJZFwiLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBvcmRlcklkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgeyBzdGF0dXMgfSA9IHJlcS5ib2R5O1xyXG4gICAgXHJcbiAgICBpZiAoIW9yZGVySWQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiTWlzc2luZyBvcmRlcklkIHBhcmFtZXRlclwiIFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVMOsbSDEkcahbiBow6BuZ1xyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kT25lKHtcclxuICAgICAgJG9yOiBbXHJcbiAgICAgICAgeyBfaWQ6IG9yZGVySWQgfSxcclxuICAgICAgICB7IG9yZGVySWQ6IG9yZGVySWQgfVxyXG4gICAgICBdXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaWYgKCFvcmRlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiT3JkZXIgbm90IGZvdW5kXCJcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpXHJcbiAgICBvcmRlci5wYXltZW50U3RhdHVzID0gJ2NvbXBsZXRlZCc7XHJcbiAgICBvcmRlci5pc1BhaWQgPSB0cnVlO1xyXG4gICAgaWYgKHN0YXR1cykge1xyXG4gICAgICBvcmRlci5zdGF0dXMgPSBzdGF0dXM7XHJcbiAgICB9IGVsc2UgaWYgKG9yZGVyLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XHJcbiAgICAgIG9yZGVyLnN0YXR1cyA9ICdwcm9jZXNzaW5nJztcclxuICAgIH1cclxuICAgIFxyXG4gICAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBtZXNzYWdlOiBcIk9yZGVyIHBheW1lbnQgc3RhdHVzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCIsXHJcbiAgICAgIGRhdGE6IHsgb3JkZXJJZDogb3JkZXIuX2lkLCBzdGF0dXM6IG9yZGVyLnN0YXR1cywgcGF5bWVudFN0YXR1czogb3JkZXIucGF5bWVudFN0YXR1cyB9XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIG9yZGVyIHN0YXR1czpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIG1lc3NhZ2U6IFwiRXJyb3IgdXBkYXRpbmcgb3JkZXIgc3RhdHVzXCIsXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xyXG4iXSwibWFwcGluZ3MiOiJ5TEFBQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxrQkFBQSxHQUFBRCxPQUFBOzs7Ozs7Ozs7Ozs7O0FBYUEsSUFBQUUsTUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBOztBQUVBLE1BQU1HLE1BQU0sR0FBR0MsZ0JBQU8sQ0FBQ0MsTUFBTSxDQUFDLENBQUM7O0FBRS9CO0FBQ0FGLE1BQU0sQ0FBQ0csSUFBSSxDQUFDLEdBQUcsRUFBRUMsZ0NBQWEsQ0FBQztBQUMvQkosTUFBTSxDQUFDSyxHQUFHLENBQUMsR0FBRyxFQUFFQyxpQ0FB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