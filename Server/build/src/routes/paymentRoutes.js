"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _express = _interopRequireDefault(require("express"));
var _paymentController = require("../Controller/paymentController.js");












var _Order = _interopRequireDefault(require("../Model/Order.js"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

const router = _express.default.Router();

// Route CRUD cơ bản
router.post("/", _paymentController.createPayment);
router.get("/", _paymentController.getAllPayments);
router.get("/:id", _paymentController.getPaymentById);
router.patch("/:id/status", _paymentController.updatePaymentStatus);
router.patch("/:id", _paymentController.updatePayment);
router.delete("/:id", _paymentController.deletePayment);

// Routes thanh toán
router.post("/sepay/create-payment-url", _paymentController.createSepayPaymentUrl);
router.post("/sepay/callback", _paymentController.handleSepayCallback);
router.post("/vnpay/create-payment-url", _paymentController.createVnpayPaymentUrl);

// Route cho QR code ngân hàng
router.post("/bank-qr", _paymentController.createBankQRCode);

// Route kiểm tra trạng thái thanh toán
router.get("/status/:orderId", _paymentController.checkPaymentStatus);

// Route cập nhật trạng thái thủ công
router.post("/update-status/:orderId", async (req, res) => {
  try {
    const { orderId } = req.params;
    const { status } = req.body;

    if (!orderId) {
      return res.status(400).json({
        success: false,
        message: "Missing orderId parameter"
      });
    }

    // Tìm đơn hàng
    const order = await _Order.default.findOne({
      $or: [
      { _id: orderId },
      { orderId: orderId }]

    });

    if (!order) {
      return res.status(404).json({
        success: false,
        message: "Order not found"
      });
    }

    // Cập nhật trạng thái
    order.paymentStatus = 'completed';
    order.isPaid = true;
    if (status) {
      order.status = status;
    } else if (order.status === 'pending') {
      order.status = 'processing';
    }

    await order.save();

    return res.json({
      success: true,
      message: "Order payment status updated successfully",
      data: { orderId: order._id, status: order.status, paymentStatus: order.paymentStatus }
    });
  } catch (error) {
    console.error("Error updating order status:", error);
    return res.status(500).json({
      success: false,
      message: "Error updating order status",
      error: error.message
    });
  }
});var _default = exports.default =

router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3BheW1lbnRDb250cm9sbGVyIiwiX09yZGVyIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0Iiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJjcmVhdGVQYXltZW50IiwiZ2V0IiwiZ2V0QWxsUGF5bWVudHMiLCJnZXRQYXltZW50QnlJZCIsInBhdGNoIiwidXBkYXRlUGF5bWVudFN0YXR1cyIsInVwZGF0ZVBheW1lbnQiLCJkZWxldGUiLCJkZWxldGVQYXltZW50IiwiY3JlYXRlU2VwYXlQYXltZW50VXJsIiwiaGFuZGxlU2VwYXlDYWxsYmFjayIsImNyZWF0ZVZucGF5UGF5bWVudFVybCIsImNyZWF0ZUJhbmtRUkNvZGUiLCJjaGVja1BheW1lbnRTdGF0dXMiLCJyZXEiLCJyZXMiLCJvcmRlcklkIiwicGFyYW1zIiwic3RhdHVzIiwiYm9keSIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsIm9yZGVyIiwiT3JkZXIiLCJmaW5kT25lIiwiJG9yIiwiX2lkIiwicGF5bWVudFN0YXR1cyIsImlzUGFpZCIsInNhdmUiLCJkYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3JvdXRlcy9wYXltZW50Um91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQge1xuICBjcmVhdGVTZXBheVBheW1lbnRVcmwsXG4gIGhhbmRsZVNlcGF5Q2FsbGJhY2ssXG4gIGNyZWF0ZVBheW1lbnQsXG4gIGdldEFsbFBheW1lbnRzLFxuICBnZXRQYXltZW50QnlJZCxcbiAgdXBkYXRlUGF5bWVudFN0YXR1cyxcbiAgZGVsZXRlUGF5bWVudCxcbiAgY3JlYXRlVm5wYXlQYXltZW50VXJsLFxuICBjcmVhdGVCYW5rUVJDb2RlLFxuICBjaGVja1BheW1lbnRTdGF0dXMsXG4gIHVwZGF0ZVBheW1lbnRcbn0gZnJvbSBcIi4uL0NvbnRyb2xsZXIvcGF5bWVudENvbnRyb2xsZXIuanNcIjtcbmltcG9ydCBPcmRlciBmcm9tIFwiLi4vTW9kZWwvT3JkZXIuanNcIjtcblxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuLy8gUm91dGUgQ1JVRCBjxqEgYuG6o25cbnJvdXRlci5wb3N0KFwiL1wiLCBjcmVhdGVQYXltZW50KTtcbnJvdXRlci5nZXQoXCIvXCIsIGdldEFsbFBheW1lbnRzKTtcbnJvdXRlci5nZXQoXCIvOmlkXCIsIGdldFBheW1lbnRCeUlkKTtcbnJvdXRlci5wYXRjaChcIi86aWQvc3RhdHVzXCIsIHVwZGF0ZVBheW1lbnRTdGF0dXMpO1xucm91dGVyLnBhdGNoKFwiLzppZFwiLCB1cGRhdGVQYXltZW50KTtcbnJvdXRlci5kZWxldGUoXCIvOmlkXCIsIGRlbGV0ZVBheW1lbnQpO1xuXG4vLyBSb3V0ZXMgdGhhbmggdG/DoW5cbnJvdXRlci5wb3N0KFwiL3NlcGF5L2NyZWF0ZS1wYXltZW50LXVybFwiLCBjcmVhdGVTZXBheVBheW1lbnRVcmwpO1xucm91dGVyLnBvc3QoXCIvc2VwYXkvY2FsbGJhY2tcIiwgaGFuZGxlU2VwYXlDYWxsYmFjayk7XG5yb3V0ZXIucG9zdChcIi92bnBheS9jcmVhdGUtcGF5bWVudC11cmxcIiwgY3JlYXRlVm5wYXlQYXltZW50VXJsKTtcblxuLy8gUm91dGUgY2hvIFFSIGNvZGUgbmfDom4gaMOgbmdcbnJvdXRlci5wb3N0KFwiL2JhbmstcXJcIiwgY3JlYXRlQmFua1FSQ29kZSk7XG5cbi8vIFJvdXRlIGtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSB0aGFuaCB0b8Ohblxucm91dGVyLmdldChcIi9zdGF0dXMvOm9yZGVySWRcIiwgY2hlY2tQYXltZW50U3RhdHVzKTtcblxuLy8gUm91dGUgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgdGjhu6cgY8O0bmdcbnJvdXRlci5wb3N0KFwiL3VwZGF0ZS1zdGF0dXMvOm9yZGVySWRcIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBvcmRlcklkIH0gPSByZXEucGFyYW1zO1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXEuYm9keTtcbiAgICBcbiAgICBpZiAoIW9yZGVySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICAgIG1lc3NhZ2U6IFwiTWlzc2luZyBvcmRlcklkIHBhcmFtZXRlclwiIFxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIFTDrG0gxJHGoW4gaMOgbmdcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRPbmUoe1xuICAgICAgJG9yOiBbXG4gICAgICAgIHsgX2lkOiBvcmRlcklkIH0sXG4gICAgICAgIHsgb3JkZXJJZDogb3JkZXJJZCB9XG4gICAgICBdXG4gICAgfSk7XG4gICAgXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IFwiT3JkZXIgbm90IGZvdW5kXCJcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaVxuICAgIG9yZGVyLnBheW1lbnRTdGF0dXMgPSAnY29tcGxldGVkJztcbiAgICBvcmRlci5pc1BhaWQgPSB0cnVlO1xuICAgIGlmIChzdGF0dXMpIHtcbiAgICAgIG9yZGVyLnN0YXR1cyA9IHN0YXR1cztcbiAgICB9IGVsc2UgaWYgKG9yZGVyLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XG4gICAgICBvcmRlci5zdGF0dXMgPSAncHJvY2Vzc2luZyc7XG4gICAgfVxuICAgIFxuICAgIGF3YWl0IG9yZGVyLnNhdmUoKTtcbiAgICBcbiAgICByZXR1cm4gcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6IFwiT3JkZXIgcGF5bWVudCBzdGF0dXMgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgIGRhdGE6IHsgb3JkZXJJZDogb3JkZXIuX2lkLCBzdGF0dXM6IG9yZGVyLnN0YXR1cywgcGF5bWVudFN0YXR1czogb3JkZXIucGF5bWVudFN0YXR1cyB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIG9yZGVyIHN0YXR1czpcIiwgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6IFwiRXJyb3IgdXBkYXRpbmcgb3JkZXIgc3RhdHVzXCIsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgIH0pO1xuICB9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xuIl0sIm1hcHBpbmdzIjoib0dBQUEsSUFBQUEsUUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsa0JBQUEsR0FBQUQsT0FBQTs7Ozs7Ozs7Ozs7OztBQWFBLElBQUFFLE1BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQSx1QkFBc0MsU0FBQUQsdUJBQUFJLENBQUEsVUFBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7O0FBRXRDLE1BQU1HLE1BQU0sR0FBR0MsZ0JBQU8sQ0FBQ0MsTUFBTSxDQUFDLENBQUM7O0FBRS9CO0FBQ0FGLE1BQU0sQ0FBQ0csSUFBSSxDQUFDLEdBQUcsRUFBRUMsZ0NBQWEsQ0FBQztBQUMvQkosTUFBTSxDQUFDSyxHQUFHLENBQUMsR0FBRyxFQUFFQyxpQ0FBYyxDQUFDO0FBQy9CTixNQUFNLENBQUNLLEdBQUcsQ0FBQyxNQUFNLEVBQUVFLGlDQUFjLENBQUM7QUFDbENQLE1BQU0sQ0FBQ1Es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